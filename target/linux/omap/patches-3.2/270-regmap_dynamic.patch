diff -urN a/drivers/base/regmap/Kconfig b/drivers/base/regmap/Kconfig
--- a/drivers/base/regmap/Kconfig	2019-03-15 14:36:14.504674544 +0800
+++ b/drivers/base/regmap/Kconfig	2019-03-15 14:38:27.687308980 +0800
@@ -3,13 +3,14 @@
 # subsystems should select the appropriate symbols.
 
 config REGMAP
-	default y if (REGMAP_I2C || REGMAP_SPI)
 	select LZO_COMPRESS
 	select LZO_DECOMPRESS
-	bool
+	tristate
 
 config REGMAP_I2C
+	select REGMAP
 	tristate
 
 config REGMAP_SPI
+	select REGMAP
 	tristate
diff -urN a/drivers/base/regmap/Makefile b/drivers/base/regmap/Makefile
--- a/drivers/base/regmap/Makefile	2019-03-15 14:36:34.633072698 +0800
+++ b/drivers/base/regmap/Makefile	2019-03-15 14:40:16.485461079 +0800
@@ -1,4 +1,7 @@
-obj-$(CONFIG_REGMAP) += regmap.o regcache.o regcache-indexed.o regcache-rbtree.o regcache-lzo.o
-obj-$(CONFIG_DEBUG_FS) += regmap-debugfs.o
+regmap-core-objs = regmap.o regcache.o regcache-indexed.o regcache-rbtree.o regcache-lzo.o
+ifdef CONFIG_DEBUG_FS
+regmap-core-objs += regmap-debugfs.o
+endif
+obj-$(CONFIG_REGMAP) += regmap-core.o
 obj-$(CONFIG_REGMAP_I2C) += regmap-i2c.o
 obj-$(CONFIG_REGMAP_SPI) += regmap-spi.o
