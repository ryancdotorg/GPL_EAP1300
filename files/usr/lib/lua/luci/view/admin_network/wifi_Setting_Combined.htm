<%
local uci = require "luci.model.uci".cursor()
local ntm = require "luci.model.network".init()
local sys = require "luci.sys"
local redir_page = 0
local devices  = ntm:get_wifidevs()
local changes = uci:changes("wireless")
local iface_num = uci:get('functionlist','vendorlist','AP_WIFI_IFACE_NUM')
local HWMODE_AX = uci:get('functionlist','functionlist','HWMODE_AX')
local RSSI_THRESHOLD_MAX = uci:get('functionlist','vendorlist','RSSI_THRESHOLD_MAX') or -60
local RSSI_THRESHOLD_MIN = uci:get('functionlist','vendorlist','RSSI_THRESHOLD_MIN') or -100
local JAPAN_COUNTRY_ID
if uci:get("functionlist","functionlist","SUPPORT_JAPAN_BANDWIDTH_HT80") == '1' then
    JAPAN_COUNTRY_ID = 4015
else
    JAPAN_COUNTRY_ID = 392
end

if changes.wireless then
    for s, c in pairs(changes.wireless) do
            for option, v in pairs(c) do
                if option == "obeyregpower" then
                    redir_page = 1
                    break
                end
            end
    end
end

    local disabled_radio2G = "1"
    local disabled_radio5G = "1"
    local disabled_radio52G = "1"
    uci:foreach("wireless", "wifi-iface",
        function(s)
             if s.device == "wifi0" and (s.mode_display == "ap" or (s.mode_display == "wds_ap" and s.nawds == "0")) then
                if s.disabled == "0" then
                    disabled_radio2G = "0"
                end
             end
             if s.device == "wifi1" and (s.mode_display == "ap" or (s.mode_display == "wds_ap" and s.nawds == "0")) then
                if s.disabled == "0" then
                    disabled_radio5G = "0"
                end
             end
if WLAN5G_2=="1" then
             if s.device == "wifi2" and (s.mode_display == "ap" or (s.mode_display == "wds_ap" and s.nawds == "0")) then
                if s.disabled == "0" then
                    disabled_radio52G = "0"
                end
             end
end             
    end)

if uci:get('functionlist','functionlist','SUPPORT_REPEATER_MODULE') == '1' then
    local sta_ap_ap = {}
    for _, dev in ipairs(devices) do
        sta_ap_ap[#sta_ap_ap+1] = ntm:get_wifinet_index(dev:name(),"sta_ap",tonumber(1)):name()
    end
end

if uci:get('functionlist','functionlist','SUPPORT_AP_RP_SETUP_WIZARD') == "1" and uci:get("system","firmware","first_login") == "1" then
    redir_page = 1
end

%>
<script>
var redir_page = '<%=redir_page%>', avoidAlert;
if(redir_page == 1){ //if green mode changed, system will reboot
	location.href='<%=luci.dispatcher.build_url("admin", "uci", "saveapply")%>'
}
</script>
<%if redir_page ~= 1 then%>
    <%if uci:get('functionlist','functionlist','SUPPORT_MYID') == '1' then%>
        <%+myid%>
    <%end%>
    <%+header%>
<%end%>
<%
    local radioNum,wifi_dev=0,{}
    if WLAN24G == '1' then
        radioNum=radioNum+1
        wifi_dev["2.4G"]={"wifi0"}
    end
    if WLAN5G == '1' then
        radioNum=radioNum+1
        wifi_dev["5G"]={"wifi1"}
        if WLAN5G_2=="1" then
            table.insert(wifi_dev["5G"], "wifi2")
        end
        if WLAN5G_2 == '1' then --[[ #### WLAN5G_2 feature ### --]]
            radioNum=radioNum+1
        end --[[ #### WLAN5G_2 feature ### --]]
    end

    local devs={}
    devs["2.4G"]={}         --[[ record 2.4G radio --]]
    devs["5G"]={}           --[[ record 5G radio --]]

    local wifi_ap_enable = {}       --[[ record if wifi really up --]]
    local wifi_all_net={}           --[[ record the interfaces of the device --]]

    for _, dev in ipairs(devices) do
        wifi_all_net[dev:name()] = dev:get_wifinets_all()
        if filterRadio and dev:name()==filterRadio then
        else
            for i, v in pairs(wifi_dev) do
                for a, b in pairs(v) do
                    if dev:name() == b then
                        table.insert(devs[i], dev:name())
                    end
                end
            end
        end
        if dev:name()=="wifi1" or dev:name()=="wifi2" then
            wifi_ap_enable[dev:name()] = "0"
            for _, net in ipairs(wifi_all_net[dev:name()]["all"]) do
                if net:noise() ~= 0 then 
                    wifi_ap_enable[dev:name()] = "1"
                end  
            end
        end
    end

    local enjet_name
    local mgmt_name
    for _, dev in ipairs(devices) do local nets = wifi_all_net[dev:name()]["all"]
        for i, net in ipairs(nets) do
            option = net:name():match("wifi1_enjet") or ""
            if option ~= "" then
                networkName_enjet = net:id()
            end
            if uci:get('functionlist','vendorlist','MANAGEMENT_SUPPORT_RADIO') == '1' then
                option = net:name():match("wifi0_mgmt") or ""
            elseif uci:get('functionlist','vendorlist','MANAGEMENT_SUPPORT_RADIO') == '2' then
                option = net:name():match("wifi1_mgmt") or ""
            end
            if option ~= "" then
                networkName_mgmt = net:id()
            end
        end
    end
    local arpcache = { }
    sys.net.arptable(function(e) arpcache[e["HW address"]:upper()] = e["IP address"] end)

    local opmode_type = {}
   local ManagementVLANID_MIN_VALUE = tonumber(uci:get("functionlist", "vendorlist", "ManagementVLANID_MIN_VALUE") or 1)
    local ManagementVLANID_MAX_VALUE = tonumber(uci:get("functionlist", "vendorlist", "ManagementVLANID_MAX_VALUE") or 4094)

if uci:get('functionlist','functionlist','SUPPORT_REPEATER_MODULE') == '1' then
    opmode_type = {[1]="ap",[2]="sta",[3]="wds_ap",[4]="wds_sta",[5]="wds_bridge",[6]="sta_ap"}
else
    opmode_type = {[1]="ap",[2]="sta",[3]="wds_ap",[4]="wds_sta",[5]="wds_bridge"}
end
    --[[
    local netlist = { }
    local netdevs = { }
    local dev
    for _, dev in ipairs(devices) do
        local net
        for _, net in ipairs(dev:get_wifinets()) do
            netlist[#netlist+1] = net:id()
            netdevs[net:id()] = dev:name()
        end
    end
    ]]--
%>
 <STYLE type="text/css">
* {
    margin: 0;
    padding: 0;
}
form {
    font-family: helvetica,arial,verdana,sans-serif;
}
table {
    border-collapse: collapse;
    text-align: center;
}
input {
    font-family: sans-serif;
    font-size: 16px;
    color : black;
}
input[type="button"] {
    margin-left: 1px;
    padding-left: 10px;
    padding-right: 10px;
}
input[type="submit"] {
    margin-left: 1px;
    margin-right: 9px;
    padding-left: 10px;
    padding-right: 10px;
}
input[type="file"] {
    background-color: #F0F0F0;
    margin-left: 1px;
    margin-right: 9px;
    padding-right: 10px;
}
input[type="checkbox"] {
    margin-left: 3px;
    margin-right: 9px;
}
input[type="radio"] {
    margin-right: 9px;
}
.radio_en {
    margin-left: 3px;
    margin-right: 3px;
}
.radio_en_label {
    margin-right: 9px;
}
input[type="text"] {
    border: 1px solid #D0D0D0;
    margin-left: 2px;
    margin-right: 6px;
    padding: 2px;
}

input[type="text"][readonly="readonly"] {
    border: 0 none #D0D0D0;
    font-size: 16px;
    margin-right: 6px;
}
input[type="password"] {
    border: 1px solid #D0D0D0;
    margin-left: 2px;
    margin-right: 6px;
    padding: 2px;
}
textarea {
    margin: 2px;
    padding: 2px;
}
select {
    border: 1px solid #D0D0D0;
    font-size: 16px;
    margin: 2px 6px 2px 2px;
     color : black;
}
a {
    outline: medium none;
}
.msg_type_mark {
    color: red;
    font-size: 16px;
    font-weight: bold;
    margin-right: 9px;
}
.outer-bg {
    background-color: #F5F5F5;
}
.inner-bg {
    background-color: #FFFFFF;
}
.banner .ban_logo {
    width: 1202px;
}
.banner .ban_info {
    width: 1202px;
}
.banner .banner_shadow {
    width: 1202px;
}
.ban_logo {
    background: url("pictures/banner_logo.png") repeat scroll 0 0 transparent;
    height: 71px;
}
.ban_info {
    background-color: #1B489C;
    border-bottom-left-radius: 12px;
    border-bottom-right-radius: 12px;
    border-collapse: separate;
    border-spacing: 0;
    height: 41px;
}
.model {
    background-color: #1B489C;
    border-radius: 12px 12px 12px 12px;
    color: #FFFFFF;
    font-size: 20px;
    text-align: center;
    width: 181px;
}
.padding {
    background-color: #1B489C;
    width: 30px;
}
.description {
    background-color: #1B489C;
    color: #FFFFFF;
    font-weight: bold;
    text-align: left;
    width: 750px;
}
.buttons {
    background-color: #F1F1F1;
    border-bottom: 1px solid #1B489C;
    border-left: 1px none #1B489C;
    border-right: 1px solid #1B489C;
    border-style: none solid solid none;
    color: #000000;
    font-weight: bold;
    padding: 10px;
    width: 12%;
}
.buttons:nth-child(4) {
    border-top-left-radius: 10px;
}
.buttons:last-child {
    border-top-right-radius: 10px;
}
.buttons:nth-child(4) {
    border-bottom-left-radius: 10px;
}
.buttons:last-child {
    border-bottom-right-radius: 10px;
}
.buttons:nth-child(4) {
    border-left-style: solid;
}
.buttons img {
    cursor: pointer;
}
.buttons:hover {
    background-color: #9FDCFF;
    cursor: pointer;
}
.banner_shadow {
    background: url("pictures/banner_shadow.png") no-repeat scroll 0 0 transparent;
    height: 20px;
}
.function .menu {
    width: 1202px;
}
.function {
    background-color: white;
    border-color: #1B489C;
    border-left: 1px solid #1B489C;
    border-radius: 12px 12px 12px 12px;
    border-right: 1px solid #1B489C;
    border-style: solid;
    border-top: 1px solid #1B489C;
    width: 1202px;
}
.menu_blank {
    height: 34px;
    width: 195px;
}
.menu_bg {
    height: 486px;
    text-align: left;
    vertical-align: top;
}
.menu_major {
    background-color: #1B489C;
    font-size: 16px;
    font-weight: 600;
    height: auto;
    padding-bottom: 6px;
    padding-left: 15px;
    padding-top: 6px;
}
.menu_major_on {
    color: #FFFFFF;
}
.menu_major_off {
    color: #FFFFFF;
}
.menu_minor {
    border-bottom: 1px solid #9FDCFF;
    font-size: 16px;
    padding-left: 45px;
}
.menu_minor:hover {
    background-color: #9FDCFF;
    cursor: pointer;
}
.datahighlight {
    background-color: #9FDCFF;
    cursor: pointer;
}
.menu_minor_on {
    background-color: #9FDCFF;
    color: #000000;
    height: auto;
    padding-bottom: 4px;
    padding-top: 4px;
}
.menu_minor_off {
    background-color: #FFFFFF;
    color: #000000;
    height: auto;
    padding-bottom: 4px;
    padding-top: 4px;
}
.ctx-container {
    border-left: 1px solid #1B489C;
    text-align: left;
    vertical-align: top;
}
.ctx-iframe {
    height: 540px;
    overflow: auto;
    width: 100%;
}
.ctx-merge-iframe {
    height: 350px;
    overflow: auto;
    width: 100%;
}
.ctx-head-padding {
    height: 20px;
    width: 100%;
}
.ctx-head {
    height: 12px;
}
.ctx-body {
    padding-left: 0px;
    padding-right: 38px;
}
.ctx-blank {
    height: 45px;
}
.ctx-foot {
    height: 20px;
}
.bottommargin {
    margin-bottom: 20px;
}
.ecm-tbl {
    width: 100%;
}
.ecm-tbl div {
    display: inline;
}
.ecm-tbl th {
    font-size: 18px;
    font-weight: normal;
    height: 40px;
    padding-left: 10px;
    text-align: left;
}
.ecm-tbl .onepx {
    border-right: 1px solid #FFFFFF;
}
.ecm-tbl .tbl-name {
    padding-left: 10px;
    text-align: left;
    padding-top:0px;
    padding-bottom:0px;
    vertical-align : middle;    
}
.ecm-tbl .tbl-value {
    padding-left: 10px;
    text-align: left;
    padding-top:0px;
    padding-bottom:0px;
    vertical-align : middle;
}
.ecm-tbl .tbl-grey {
    background-color: #EEEEEE;
    padding-left: 6px;
    vertical-align : middle;
}
.ecm-tbl .tbl-grey-15px {
    background-color: #EEEEEE;
    padding-left: 6px;
}
.ecm-tbl .tbl-middle {
    padding-left: 6px;
}
.ecm-tbl .margin-indent {
    margin-left: 1em;
}
.ecm-tbl .margin-indent:before {
    content: "- ";
}
.ecm-tbl .margin-indent1_4 {
    margin-left: 1.4em;
}
.ecm-tbl .margin-indent1_6 {
    margin-left: 1.6em;
}
.ecm-tbl .margin-indent3 {
    margin-left: 2.5em;
}
.ecm-tbl .margin-indent3:before {
    content: "- ";
}
.ecm-tbl .float-align {
    float: right;
}
.tbl-blank {
    border-top: 1px solid #1B489C;
    height: 0px;
}
.tbl-name {
    border-bottom: 1px solid #EEEEEE;
    color: #000000;
    font-size: 16px;
    height: 27px;
}
.tbl-value {
    border-bottom: 1px solid #EEEEEE;
    color: #000000;
    font-size: 16px;
    height: 27px;
}
.tbl-grey {
    border-bottom: 1px solid #EEEEEE;
    color: #000000;
    font-size: 16px;
    height: 27px;
}
.tbl-grey-15px {
    border-bottom: 1px solid #EEEEEE;
    color: #000000;
    font-size: 15px;
    height: 27px;
    line-height: 19px;
}
.tbl-middle {
    border-bottom: 1px solid #EEEEEE;
    color: #000000;
    font-size: 16px;
    height: 27px;
}
.tbl-alighTop {
    border-bottom: 1px solid #EEEEEE;
    padding-left: 8px;
    text-align: left;
    vertical-align: top;
}
.striped {
    background-color: #F0F0F0;
}
.caution_padding {
    padding-left: 10px;
}
.button1 {
    background: url("./images/overlay.png") repeat-x scroll left center #00AFF0;
    border: 1px solid #63CEF6;
    border-radius: 4px 4px 4px 4px;
    box-shadow: 0 0 0 rgba(22, 142, 199, 0.5) inset;
    color: #FFFFFF;
    cursor: pointer;
    font: 16px tahoma,arial,sans-serif;
    height: 30px;
    margin: 10px 20px 20px 0;
    min-width: 100px;
    padding: 3px 8px 6px;
    width: 100px;
}
.buttonPM {
    background: url("./images/overlay.png") repeat-x scroll left center #00AFF0;
    border: 1px solid #63CEF6;
    border-radius: 4px 4px 4px 4px;
    box-shadow: 0 0 0 rgba(22, 142, 199, 0.5) inset;
    color: #FFFFFF;
    cursor: pointer;
    font: 16px tahoma,arial,sans-serif;
    height: 30px;
    min-width: 100px;
    padding: 3px 8px 6px;
    width: 100px;
}
.button1:hover {
    background: url("./images/but_mouseover.png") repeat-x scroll center top #00AFF0;
    border: 1px solid #3E97CE;
    color: #FFFFFF;
}
.button1:active {
    background: url("./images/but_mouseover2.png") repeat-x scroll center top #00AFF0;
    border: 1px solid #3E97CE;
    color: #FFFFFF;
    position: relative;
    top: 0;
}
.button2 {
    background: url("./images/overlay.png") repeat-x scroll left center #00AFF0;
    border: 1px solid #63CEF6;
    border-radius: 4px 4px 4px 4px;
    box-shadow: 0 0 0 rgba(22, 142, 199, 0.5) inset;
    color: #FFFFFF;
    cursor: pointer;
    font: 16px tahoma,arial,sans-serif;
    height: 30px;
    margin: 10px 20px 20px 0;
    min-width: 100px;
    padding: 3px 8px 6px;
    width: 200px;
}
.desc_style {
    font-size: 12px;
    text-align: center;
    vertical-align: middle;
}
.div1 {
    display: inline;
}
.quater_Smaller {
    font-size: 80%;
}
.input-disabled{
    background-color:black;
    border:1px solid #ABADB3;
    padding:2px 1px;
}

 select:disabled {
    background-color : #CDCDCD;
    color : gray;
}

 input:disabled {
    background-color : #CDCDCD;
    color : gray;
}

 </STYLE>
<script type="text/javascript">
var tmp_vlanid = ["0","0","0","0","0","0","0","0"];
var isolation_enable = 0;
var disabled2G="0", disabled5G="0", disabled52G="0", enable_flag2G="", enable_flag5G="", enable_flag52G="", country_changed=0, radio_on_wifi1="1", radio_on_wifi2="1", check_distance_flag=0;
var channel_handler = (function(){
    var channel_handler_enable = ((parent.$('.reloadStatus').length<=0)?'1':'0'),
    channel_handler_enable2 = ((parent.$('.reloadStatus').length<=0)?'1':'0'),
    channel_wifi0_val="<%=uci:get("wireless","wifi0","channel") or ""%>",channel_wifi1_val="<%=uci:get("wireless","wifi1","channel") or ""%>",channel_wifi2_val="<%=uci:get("wireless","wifi2","channel") or ""%>",
    setObj = function(obj,dev){
        eval("channel_"+dev+"_obj = obj");
    },
    setChannelVal = function(dev,val){
        eval("channel_"+dev+"_val = val");
    },
    getChannelVal = function(dev){
        return eval("channel_"+dev+"_val");
    },
    setSelectIndex = function(dev,val){
        var ch_select = $('select[name$="'+dev+'.channel"]');
        var hasVal = "0";
        var hasAuto = $('select[name$="'+dev+'.opmode"]').val()=="wds_bridge"?"0":"1";
        ch_select.children('option').each(function(){
            if($(this).text()==val || $(this).val()==val){
                hasVal = "1";
                return;
            }
        });
        if(hasVal == "0"){
            var backup_val = (hasAuto == "1"?"auto":ch_select.children('option:first').val());
            ch_select.val(backup_val);
            setChannelVal(dev,backup_val);
        }else{
            ch_select.val(val);
        }
    },
    getBand = function(val){
        if(val <= 48){ 
            return "1";
        }
        if(val >= 52 && val <= 64){
            return "2";
        }
        if(val >= 100 && val <= 140){
            return "3";
        }
        if(val >= 149){
            return "4";
        }     
    },
    greenModeHandler = function(green_on){
        var bandAllow = {
                "1":"1",
                "2":"1",
                "3":"1",
                "4":"1"
            };  
        if(green_on == "false"){
            return bandAllow; 
        }      

        switch(reg_domain){
            case 0 ://FCC
                return  {
                            "1":"1",
                            "2":"0",
                            "3":"0",
                            "4":"1"
                        };
            case 1 ://ETSI
                return  {
                            "1":"1",
                            "2":"0",
                            "3":"0",
                            "4":"0"
                        };
            default:
                return  bandAllow ;
        }        

    },
    doNothing = function(){
        //console.log("nothing");
    },
    _5g_channel_handler = function() {
        var select_htmode = $('select[name$="wifi1.htmode"]');
        var ch_select = $('select[name$="wifi1.channel"]');
        var currnet_htmode = select_htmode.val();
        var channel_name = ch_select.attr("name");
        var htmode_flag,htmode_name,has_channel="0";
        var no_support5G="0";
<% if WLAN5G_2=="1" then --[[ #### WLAN5G_2 feature ### --]] %>
        var str='<%:This country 5G-1 %s not support, switch to 20 MHz%>';
<% else %>
        var str='<%:This country 5G %s not support, switch to 20 MHz%>';
<% end --[[ #### WLAN5G_2 feature end ### --]] %>
        // var green_on =  $(':checkbox[name$="wifi1.obeyregpower"]').prop('checked');
        // var bandAllow = greenModeHandler(green_on);
        switch(currnet_htmode){
            case "HT40" : 
                        htmode_flag = "v40";
                        htmode_name = "40 MHz";
                        break;
            case "HT80" :
                        htmode_flag = "v80";
                        htmode_name = "80 MHz";
                        break;
            default :
                        htmode_flag = "v20";
                        break;
        }
        support_channel5G = "";
        for (var prop in channel_wifi1_obj) {
            if(channel_wifi1_obj.hasOwnProperty(prop)){
                var opt_val = channel_wifi1_obj[prop]["Value"];
<% if WLAN5G_2=="1" then --[[ #### WLAN5G_2 feature ### --]] %>
                var opt_valInt = parseInt(opt_val,10);
                if (opt_valInt > 64){                  // Triband 5G-1 support Band3 & Band4
<% end --[[ #### WLAN5G_2 feature end ### --]] %>
                    has_channel="1";
                    // var opt_band = getBand(parseInt(opt_val));
                    if(htmode_flag == "v20" || channel_wifi1_obj[prop][htmode_flag] == "1"){
                         hide_option(channel_name,opt_val,"show");
                        // if(green_on && bandAllow[opt_band]== "0"){
                        //     hide_option(channel_name,opt_val,"hide");
                        // }else{
                        //     hide_option(channel_name,opt_val,"show");
                        // }
                    support_channel5G += (support_channel5G == "") ? opt_val : ","+opt_val;
                    }
                    else{
                        hide_option(channel_name,opt_val,"hide");
                    }
<% if WLAN24G=="1" and WLAN5G=="1" then %>
                <% if uci:get('sysProductInfo','model','outdoor') == '1' then %>
                    if(($('select[name="cbid.wireless.wifi0.country"]').val() == "504") && $('input[type="checkbox"][name="cbid.wireless.wifi1.obeyregpower"]').prop('checked')){
                        has_channel="0";
                        no_support5G="1";
                        hide_option(channel_name,opt_val,"hide");
                    }
                <% end %>
<% end %>
<% if WLAN5G_2=="1" then --[[ #### WLAN5G_2 feature ### --]] %>
                }
                else{
                    hide_option(channel_name,opt_val,"hide");
                }
<% end --[[ #### WLAN5G_2 feature end ### --]] %>
            }
        }
        $("input:hidden[name='cbid.wireless.wifi1.nochannel']").val("0");
        if((ch_select.children("option").length <= 1)){
            if (has_channel=="0"){                      //handle radio no channel
                if (country_changed!=1 && avoidAlert==0){
                    if(no_support5G=="1"){
                        alert("<%:If the country you are installing device in only supports 2.4GHz, the 5GHz interface will be disabled.%>");
                    }
                    else{
                        alert("<%:If the country you are installing device in only supports Band1 and Band2, the 5GHz-1 interface will be disabled.%>");
                    }
                    avoidAlert=1;
                }
                $("input:hidden[name='cbid.wireless.wifi1.nochannel']").val("1");
                radio_on_wifi1="0";
                radioDisalbe("wifi1","disabled");
            }
            else{                                       //handle country don't support 40/80 MHz
                alert(String.format(str, htmode_name));
                select_htmode.val("HT20");
                select_htmode.triggerHandler("change");
            }
        }
        else if((ch_select.children("option").length > 1) && radio_on_wifi1=="0") // handle radio turn on if has channel
        {
            radio_on_wifi1="1";
            radioDisalbe("wifi1","enabled");
            /* triggerhandler to set rule*/
            $("select[name='cbid.wireless.wifi1.hwmode']").triggerHandler("change");
            $(':radio:checked[name="cbid.wireless.wifi1.clientlimits_enable"]').triggerHandler("click");
            $("#wifi1_tbl tr input:visible[type='checkbox'][name$='disabled']").each(function(){$(this).triggerHandler("click");});
            $("tr[id='wifi1_guest'] input[name$=disabled]").each(function(){$(this).triggerHandler("click");});
            $(':radio:checked[name$="wifi1.fasthandover_status"]').triggerHandler("click");
        }
        setSelectIndex("wifi1",getChannelVal("wifi1"));
    },
    _5g_2_channel_handler = function() {
        var select_htmode = $('select[name$="wifi2.htmode"]');
        var ch_select = $('select[name$="wifi2.channel"]');
        var currnet_htmode = select_htmode.val();
        var channel_name = ch_select.attr("name");
        var htmode_flag,htmode_name,has_channel="0";
        var str='<%:This country 5G-2 %s not support, switch to 20 MHz%>';
        switch(currnet_htmode){
            case "HT40" : 
                        htmode_flag = "v40";
                        htmode_name = "40 MHz";
                        break;
            case "HT80" :
                        htmode_flag = "v80";
                        htmode_name = "80 MHz";
                        break;
            default :
                        htmode_flag = "v20";
                        break;
        }
        support_channel52G = "";
        for (var prop in channel_wifi2_obj) {
            if(channel_wifi2_obj.hasOwnProperty(prop)){
                var opt_val = channel_wifi2_obj[prop]["Value"];
<% if WLAN5G_2=="1" then --[[ #### WLAN5G_2 feature ### --]] %>
                var opt_valInt = parseInt(opt_val,10);
                if (opt_valInt <= 64){                  // Triband 5G-2 support Band1 & Band2
<% end --[[ #### WLAN5G_2 feature end ### --]] %>
                    has_channel="1";
                    if(htmode_flag == "v20" || channel_wifi2_obj[prop][htmode_flag] == "1"){
                        hide_option(channel_name,opt_val,"show");
                        support_channel52G += (support_channel52G == "") ? opt_val : ","+opt_val;
                    }
                    else{
                        hide_option(channel_name,opt_val,"hide");
                    }
<% if WLAN5G_2=="1" then --[[ #### WLAN5G_2 feature ### --]] %>
                }
                else{
                    hide_option(channel_name,opt_val,"hide");
                }
<% end --[[ #### WLAN5G_2 feature end ### --]] %>
            }
        }
        $("input:hidden[name='cbid.wireless.wifi2.nochannel']").val("0");
        if((ch_select.children("option").length <= 1)){
            if (has_channel=="0"){                      //handle radio no channel
                if (country_changed!=1)
                    alert("<%:If the country you are installing device in only supports Band3 and Band4, the 5GHz-2 interface will be disabled.%>");
                $("input:hidden[name='cbid.wireless.wifi2.nochannel']").val("1");
                radio_on_wifi2="0";
                radioDisalbe("wifi2","disabled");
            }
            else{                                       //handle country don't support 40/80 MHz
                alert(String.format(str, htmode_name));
                select_htmode.val("HT20");
                select_htmode.triggerHandler("change");
            }
        }
        else if((ch_select.children("option").length > 1) && radio_on_wifi2=="0") // handle radio turn on if has channel
        {
            radio_on_wifi2="1";
            radioDisalbe("wifi2","enabled");
            /* triggerhandler to set rule*/
            $("select[name='cbid.wireless.wifi2.hwmode']").triggerHandler("change");
            $(':radio:checked[name="cbid.wireless.wifi2.clientlimits_enable"]').triggerHandler("click");
            $("#wifi2_tbl tr input:visible[type='checkbox'][name$='disabled']").each(function(){$(this).triggerHandler("click");});
            $("tr[id='wifi2_guest'] input[name$=disabled]").each(function(){$(this).triggerHandler("click");});
            $(':radio:checked[name$="wifi2.fasthandover_status"]').triggerHandler("click");
        }
        setSelectIndex("wifi2",getChannelVal("wifi2"));
    };
    return{
        obj: setObj,
        val: setChannelVal,
        getVal : getChannelVal,
        _5g : (channel_handler_enable == "1") ?_5g_channel_handler : doNothing,
        _5g_2 : (channel_handler_enable2 == "1") ? _5g_2_channel_handler : doNothing,
        set : setSelectIndex
    };
}());
var support_channel2G = "" , support_channel5G = "", support_channel52G = "";

function radioDisalbe(wifix,disabled){
    var element = ["opmode","hwmode","htmode","ext_channel","channel","txpower","rate","rts","clientlimits_number","clientlimits_enable","AP_Detection","fasthandover_status","fasthandover_rssi"];
    if (disabled=="disabled"){
        for (var i = 0; i < element.length; i++){
            $("[name='cbid.wireless."+wifix+"."+element[i]+"']").attr("disabled",true);
        }
        $("#"+wifix+"_tbl tr").find("input").attr("disabled", true);
        $("tr[id='"+wifix+"_guest']").find("input").attr("disabled", true);
        for (var i = 1 ; i <= 8 ; i++)
        {
            $("[name='wireless."+wifix+"_ssid_"+i+".disabled']").attr("disabled",true);
        }
    }
    else if(disabled=="enabled"){
        for (var i = 0; i < element.length; i++){
            $("[name='cbid.wireless."+wifix+"."+element[i]+"']").attr("disabled",false);
        };
        $("#"+wifix+"_tbl tr input[name$=disabled]").attr("disabled", false);
        $("#"+wifix+"_tbl tr input[name$=disabled]").prev("input:hidden").attr("disabled", false);
        $("tr[id='"+wifix+"_guest'] input[name$=disabled]").attr("disabled", false);
        for (var i = 1 ; i <= 8 ; i++)
        {
            $("[name='wireless."+wifix+"_ssid_"+i+".disabled']").attr("disabled",$("[name='cbid.wireless.wifix_ssid_"+i+".disabled']").prop("checked")?false:true);
        }
    }
};

function loadCbi(netid){
    bindFuncInterface(iface_rematch_table[netid]);
}

function loadWds(netid){
    var url , container ,data;
    url = '<%=luci.dispatcher.build_url("admin/network/wifi_Wdslink")%>';
    container = (netid.indexOf("wifi0")>-1) ? "#wdslink1" : (netid.indexOf("wifi1")>-1) ? "#wdslink2" : "#wdslink3" ;
    data = {netId : netid ,networkName : wds_net[netid]};
    $.ajax({
        type : "GET",
        url:url,
        data:data,
        dataType:"html",
        error:function(){
            loadWds(netid);
        },
        success:function(result){
            $(container).append(result);
            wds_link.init( wds_net[netid],netid);
        }
    });    
       $("#cbi_set").hide();
       $(".cbi-map").hide();
}

var dataRate_handler = (function(){
    var rate_wifi0_val="<%=uci:get("wireless","wifi0","rate") or ""%>",
    rate_wifi1_val="<%=uci:get("wireless","wifi1","rate") or ""%>",
    rate_wifi2_val="<%=uci:get("wireless","wifi2","rate") or ""%>",
    setDataRateVal = function(dev,val){
        eval("rate_"+dev+"_val = val");
    },
    getDataRateVal = function(dev){
        return eval("rate_"+dev+"_val");
    },
    setSelectIndex = function(dev,val){
        var ch_select = $('select[name$="'+dev+'.rate"]');
        var hasVal = "0";
        ch_select.children('option').each(function(){
            if($(this).text()==val || $(this).val()==val){
                $(this).prop('selected', true);
                hasVal = "1";
                return;
            }
        });
        if(hasVal == "0"){
            setDataRateVal(dev,"Auto");
            // setSelectIndex(dev,backup_val);
            ch_select.children('option').each(function(){
                if($(this).text()== "Auto"){
                    $(this).prop('selected', true);
                    return;
                }
            });
        }
        else
        {
            ch_select.val(val);
        }
    };

    return{
        val: setDataRateVal,
        getVal : getDataRateVal,
        set : setSelectIndex
    };

}());

function ajax_getChannelList(countryCode,reg_domain){
    var url, data = {countryCode:countryCode,reg_domain:reg_domain};
    avoidAlert=0;
    <% for _, dev in ipairs(devices) do %>
        var green_<%=dev:name()%>_select = ($('input[type="checkbox"][name$="<%=dev:name()%>.obeyregpower"]').is(':checked')) ? "1" : "0" ;
        data.greenmode_<%=dev:name()%> = green_<%=dev:name()%>_select;
    <% end %>
    url = '<%=luci.dispatcher.build_url("admin/network/ajax_getChannelList")%>';
    $.ajax({
        async: false,
        type : "GET",
        url:url,
        data:data,
        dataType:"json",
        error:function(){},
        success:function(result){
            var channel_now = jQuery.parseJSON(result);
            var chan_chart = {"ChInfo2G":"wifi0", "ChInfo5G":"wifi1", "ChInfo5G_2":"wifi2"};
            support_channel2G = "";
            for (var key in channel_now) {
                var obj = channel_now[key];
                if (Object.keys(obj).length==0)
                    break;
                var ch_select = $('select[name$="'+chan_chart[key]+'.channel"]');
                ch_select.find('span').each(function(){$(this).remove();});
                ch_select.find('option').each(function(){
                    if($(this).attr("value")!="auto" && $(this).attr("value")!=""){
                        $(this).remove();
                    }
                });
                for (var prop in obj) {
                  if(obj.hasOwnProperty(prop)){
                    ch_select.append($("<option></option>").attr("value", obj[prop]["Value"]).text(obj[prop]["Channel"]));
                    if (key == "ChInfo2G"){
                        support_channel2G += (support_channel2G == "") ? obj[prop]["Value"] : ","+obj[prop]["Value"];
                    }
                    else if(key == "ChInfo5G"){
                        support_channel5G += (support_channel5G == "") ? obj[prop]["Value"] : ","+obj[prop]["Value"];
                    }
<% if WLAN5G_2=="1" then --[[ #### WLAN5G_2 feature ### --]] %>
                    else{
                        support_channel52G += (support_channel52G == "") ? obj[prop]["Value"] : ","+obj[prop]["Value"];
                    }
<% end --[[ #### WLAN5G_2 feature end ### --]] %>
                  }
                }
                channel_handler.obj(obj,chan_chart[key]);
                if(key == "ChInfo5G" || key == "ChInfo5G_2"){
                    $('select[name$="'+chan_chart[key]+'.htmode"]').unbind("change",(key=="ChInfo5G")?channel_handler._5g: channel_handler._5g_2);
                    $('select[name$="'+chan_chart[key]+'.htmode"]').bind("change",(key=="ChInfo5G")?channel_handler._5g: channel_handler._5g_2);
                    $('select[name$="'+chan_chart[key]+'.htmode"]').triggerHandler("change");
                }
                channel_handler.set(chan_chart[key],channel_handler.getVal(chan_chart[key]));
            }
        }
    });
}

function opmode_set_interface(event){
    var opmode = event["opmode"]||$(this).val();
    var devName = event["devName"]||$(this).attr("name").split(".")[2];
    for(var i in iface_netid_Table[devName][opmode]){
        if(wds_net.hasOwnProperty(iface_netid_Table[devName][opmode][i])){
            loadWds(iface_netid_Table[devName][opmode][i]);
        }else{
            loadCbi(iface_netid_Table[devName][opmode][i]);
        }
    }
    iface_netid_Table[devName][opmode] = [] ;
    for(var i in ifaceTable[devName]){
        for(var j in ifaceTable[devName][i]){
            if(opmode == i){
                $("#"+ifaceTable[devName][i][j]).show();
            }else{
                $("#"+ifaceTable[devName][i][j]).hide();
            }
        }
    }
    /*handle guestNetwork*/
    if(opmode == "ap"||opmode == "wds_ap"){
        if(guest_netid_Table[devName]!=null&&guest_netid_Table[devName]!="undefined"){
            loadCbi(guest_netid_Table[devName]);
            delete guest_netid_Table[devName];
        }
        $("#"+guest_name_Table[devName]).show();
<% if radioNum < 2 then%>
        $("#gn,#gn_ip").show();
<% end %>
        gn_ip.checkEnable();
    }else{
        $("#"+guest_name_Table[devName]).hide();
<% if radioNum < 2 then%>
        $("#gn,#gn_ip").hide();
<% end %>
        gn_ip.checkEnable();
    }

<% if uci:get('functionlist','functionlist','SUPPORT_ENJET') == '1' then %>
    if($('input[type="radio"][name="cbid.wireless.wifi1.qboost_enable"]:checked').val() != 0 ){
        $("#"+guest_name_Table[devName]).hide();
        $("#gn,#gn_ip").hide();
        $("#fasthandover").hide();
        document.getElementsByName('cbid.wireless.wifi1.fasthandover_status')[1].checked=true;
        $('input[name$=".wifi1.fasthandover_rssi"]').attr('disabled',true);
    }
    else {
        $("#fasthandover").show();
    }
<% end %>
    if(opmode == "sta"||opmode == "wds_sta"||opmode == "sta_ap"){
        $('#'+devName+"_name").hide();
        $('#'+devName+"_name_sta").show();
    }else{
        $('#'+devName+"_name").show();
        $('#'+devName+"_name_sta").hide();
    }

    if(opmode == "wds_bridge"){
        $('#'+devName+"_tbl").hide();
    }else{
        $('#'+devName+"_tbl").show();
    }

    if ( opmode == "ap" )
    {
        $('#'+devName).hide();
        $('#'+devName+'_blank').hide();
        for(var i=1;i<=8;i++)
        {
            //console.log('[name="wireless.'+devName+'_ssid_'+i+'.disabled"]');
            $('input[name="wireless.'+devName+'_ssid_'+i+'.disabled"]').each(
                function()
                {
                    if ( $('input[name$="wireless.wifix_ssid_'+i+'.disabled"]').prop("checked") )
                        $(this).removeAttr("disabled");
                    else
                        $(this).attr("disabled","disabled"); 
                }
            );
        }
        $("#wifix").show();
    }
    else
    {
        $('#'+devName).show();
        $('#'+devName+'_blank').show();
        for(var i=1;i<=8;i++)
        {
            //console.log('[name="wireless.'+devName+'_ssid_'+i+'.disabled"]');
            $('input[name="wireless.'+devName+'_ssid_'+i+'.disabled"]').each(
                function()
                {
                    $(this).attr("disabled","disabled");
                }
            );
        }

        var have_ap = false ;
        $('select[name$="opmode"]').each(
            function()
            {
                if ( $(this).val()=="ap" )
                    have_ap = true;
            }
        );
        
        if ( !have_ap )
            $("#wifix").hide();
    }

    if(opmode=="wds_ap" || opmode=="wds_bridge"){
    switch(devName) {
        case 'wifi0':
            $('select[name="cbid.wireless.wifi1.opmode"]').val("ap");
            $('select[name="cbid.wireless.wifi1.opmode"]').trigger("change");
            <% if WLAN5G_2=="1" then %>
            $('select[name="cbid.wireless.wifi2.opmode"]').val("ap");
            $('select[name="cbid.wireless.wifi2.opmode"]').trigger("change");
            <% end %>
        break;
        case 'wifi1':
            $('select[name="cbid.wireless.wifi0.opmode"]').val("ap");
            $('select[name="cbid.wireless.wifi0.opmode"]').trigger("change");
            <% if WLAN5G_2=="1" then %>
            $('select[name="cbid.wireless.wifi2.opmode"]').val("ap");
            $('select[name="cbid.wireless.wifi2.opmode"]').trigger("change");
            <% end %>
        break;
        case 'wifi2':
            $('select[name="cbid.wireless.wifi0.opmode"]').val("ap");
            $('select[name="cbid.wireless.wifi0.opmode"]').trigger("change");
            $('select[name="cbid.wireless.wifi1.opmode"]').val("ap");
            $('select[name="cbid.wireless.wifi1.opmode"]').trigger("change");
        break;
        }
    <% if uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_BRIDGE_MODE') == '1' then %>
        $("#wdslink1").hide();
        $("#wdslink2").hide();
        $("#wdslink3").hide();
    <% end %>
    }
}

function triggerDevice(dev_name){
    if ( dev_name == "wifi0" )
    {
        $('select[name$="wifi0.channel"]').one("change", function(){
            channel_handler.val("wifi0","<%=uci:get('wireless','wifi0','channel')%>");
            channel_handler.set("wifi0","<%=uci:get('wireless','wifi0','channel')%>");
        });
        $('select[name$="wifi0.rate"]').one("change", function(){
            dataRate_handler.val("wifi0","<%=uci:get('wireless','wifi0','rate')%>");
            dataRate_handler.set("wifi0","<%=uci:get('wireless','wifi0','rate')%>");
        });
    }
    $('select[name$="'+dev_name+'.channel"]').triggerHandler('change');
    $('select[name$="'+dev_name+'.rate"]').triggerHandler('change');
    $('select[name$="'+dev_name+'.htmode"]').triggerHandler('change');
    $('select[name$="'+dev_name+'.hwmode"]').triggerHandler('change');
    $('select[name$="'+dev_name+'.opmode"]').triggerHandler('change');
    $('input[type="checkbox"][name$="'+dev_name+'.obeyregpower"]').triggerHandler('click'); 
    $(':radio[name*="'+dev_name+'"]').each(function(){
    if(this.checked){
            $(this).triggerHandler('click');
        }
    });
<% if WLAN24G == '1' and WLAN5G == '1' then %>
    if ($('select[name="cbid.wireless.wifi0.country"]').val() == "831" || $('select[name="cbid.wireless.wifi0.country"]').val() == "829"){
        <% for i = 1, 8 do %>
            $('input[type="checkbox"][name="wireless.wifi0_ssid_' + "<%=i%>" + '.disabled"]').attr("disabled", true);
        <% end %>
    }
<% end %>
}  

function Device_init() {
    function UKBC_GreenCheck() {
        if($('input[type="checkbox"][name="cbid.wireless.wifi0.obeyregpower"]').prop('checked') ||
           $('input[type="checkbox"][name="cbid.wireless.wifi1.obeyregpower"]').prop('checked') ||
           $('input[type="checkbox"][name="cbid.wireless.wifi2.obeyregpower"]').prop('checked'))
        {
            if($('select[name="cbid.wireless.wifi0.country"]').find('option:selected').val() == '829' || $('select[name="cbid.wireless.wifi0.country"]').find('option:selected').val() == '831'){
                alert("<%:This Country/Region does not support green mode.%>")
                $('input[type="checkbox"][name$="obeyregpower"]').prop('checked', false);
            }
        }
    };
    if(reg_domain == "0" || reg_domain == "1" || reg_domain == "2" ){ //sku v2.2
        $('input[type="checkbox"][name$="obeyregpower"]').click(function(){
            UKBC_GreenCheck()
        });
        $('select[name="cbid.wireless.wifi0.country"]').change(function(){
            UKBC_GreenCheck()
        });
    };

function append_opmode_option(deviceName){
//CB, WDS_BR, WDS_STA, RP
    <% if uci:get('functionlist','functionlist','SUPPORT_CLIENTBRIDGE_MODULE') == '1' then %>
    if ($('select[name="cbid.wireless.'+deviceName+'.opmode"] option[value="sta"]').length==0)
        $('select[name="cbid.wireless.'+deviceName+'.opmode"]').append('<option id="cbi-wireless-'+deviceName+'-opmode-sta" value="sta">Client Bridge</option>');
    <% end %>
              
    <% if uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_BRIDGE_MODE') == '0' or uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_BRIDGE_MODE') == nil
        then %>
    <% if uci:get('functionlist','functionlist','SUPPORT_ENJET') == '1' then %>
    if($('input[type="radio"][name="cbid.wireless.wifi1.qboost_enable"]:checked').val() == 0 ){
        if ($('select[name="cbid.wireless.'+deviceName+'.opmode"] option[value="wds_bridge"]').length==0)
        $('select[name="cbid.wireless.'+deviceName+'.opmode"]').append('<option id="cbi-wireless-'+deviceName+'-opmode-wds_bridge" value="wds_bridge">WDS Bridge</option>');
    }
    <% else %>
        if ($('select[name="cbid.wireless.'+deviceName+'.opmode"] option[value="wds_bridge"]').length==0)
        $('select[name="cbid.wireless.'+deviceName+'.opmode"]').append('<option id="cbi-wireless-'+deviceName+'-opmode-wds_bridge" value="wds_bridge">WDS Bridge</option>');
    <% end %>
    <% end %>

    <% if uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_STATION_MODE') == '0' or uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_STATION_MODE') == nil then %>
    if ($('select[name="cbid.wireless.'+deviceName+'.opmode"] option[value="wds_sta"]').length==0)
        $('select[name="cbid.wireless.'+deviceName+'.opmode"]').append('<option id="cbi-wireless-'+deviceName+'-opmode-wds_sta" value="wds_sta">WDS Station</option>');
    <% end %>

    <% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_MODULE') == '1' then %>
    if ($('select[name="cbid.wireless.'+deviceName+'.opmode"] option[value="sta_ap"]').length==0)
        <% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_CUSTOM_DEFINE') == '1' then %>
        $('select[name="cbid.wireless.'+deviceName+'.opmode"]').append('<option id="cbi-wireless-'+deviceName+'-opmode-sta_ap" value="sta_ap"><%= uci:get('functionlist','functionlist','SUPPORT_REPEATER_CUSTOM_STRING')%></option>');
        <% else %>
        $('select[name="cbid.wireless.'+deviceName+'.opmode"]').append('<option id="cbi-wireless-'+deviceName+'-opmode-sta_ap" value="sta_ap">Repeater</option>');
        <% end %>
    <% end %>
}

function append_WDSAP_option(){
    if ($("select[name='cbid.wireless.wifi0.opmode'] option[value='wds_ap']").length==0)
        $('select[name="cbid.wireless.wifi0.opmode"]').append('<option id="cbi-wireless-wifi0-opmode-wds_ap" value="wds_ap">WDS Access Point</option>');
            
    <% if uci:get('functionlist','functionlist','SUPPORT_WLAN5G') == '1' then %>
    if ($("select[name='cbid.wireless.wifi1.opmode'] option[value='wds_ap']").length==0)
        $('select[name="cbid.wireless.wifi1.opmode"]').append('<option id="cbi-wireless-wifi1-opmode-wds_ap" value="wds_ap">WDS Access Point</option>');
    <% end %>
    
    <% if WLAN5G_2=="1" then %>       
    if ($("select[name='cbid.wireless.wifi2.opmode'] option[value='wds_ap']").length==0)
        $('select[name="cbid.wireless.wifi2.opmode"]').append('<option id="cbi-wireless-wifi2-opmode-wds_ap" value="wds_ap">WDS Access Point</option>');
    <% end %>
}

<% if uci:get('functionlist','functionlist','SUPPORT_AP_MODE_ONLY') == '1' then --[[ #### SUPPORT_AP_MODE_ONLY START ### --]] %>
<% else %>
    $('select[name="cbid.wireless.wifi0.opmode"]').change(function(){
        if (typeof AddMyid !== 'undefined') { AddMyid("cbi","idchange") };  /* add my id*/
        $('select[name$="mac_select"]').triggerHandler("change"); // handle ht20_40 show mech
        var mode_2G = $('select[name="cbid.wireless.wifi0.opmode"]').val();
        var mode_5G = $("select[name='cbid.wireless.wifi1.opmode']").val();
        if(mode_2G=="ap"){
                <% for i=1,8 do %>
			var name="wireless.wifi0_ssid_"+"<%=i%>"+".disabled";
			$('input[type="checkbox"][name="'+ name+'"]').prop("checked",'<%=uci:get("wireless","wifi0_ssid_"..i,"disabled")%>'=="0"?true:false);

			var ssid_en_name="cbid.wireless.wifix_ssid_"+"<%=i%>"+".disabled";
			if('<%=uci:get("wireless","wifi0_ssid_"..i,"disabled")%>'=="0"){
				$('input[type="checkbox"][name="'+ ssid_en_name+'"]').prop("checked",true);
				$('input[type="checkbox"][name="'+ name+'"]').attr("disabled",false);
	
				var ssid_text_name="cbid.wireless.wifix_ssid_"+"<%=i%>"+".ssid";
				$('input[type="text"][name="'+ ssid_text_name +'"]').attr("disabled",false);

				var en_btn_name="cbid.wireless.wifix_ssid_"+"<%=i%>"+".encrEdit";
				$('input[type="button"][name="'+ en_btn_name +'"]').attr("disabled",false);
			}
		<% end %>
	}else{
        <% for i=1,8 do %>
            var name="wireless.wifi0_ssid_"+"<%=i%>"+".disabled";
            $('input[type="checkbox"][name="'+ name+'"]').prop("checked",'<%=uci:get("wireless","wifi0_ssid_"..i,"disabled")%>'=="0"?true:false);
        <% end %>
		for(var j=1;j<=8;j++){
			var ssid_en_name="cbid.wireless.wifix_ssid_"+j+".disabled";
			
			var name_5g="wireless.wifi1_ssid_"+j+".disabled";
			<% if WLAN5G_2=="1" then %>
			var name_5g_2="wireless.wifi2_ssid_"+j+".disabled";
			<% end %>
			
			if(!$('input[type="checkbox"][name="'+ name_5g+'"]').is(':checked')<% if WLAN5G_2=="1" then %>&& !$('input[type="checkbox"][name="'+name_5g_2+'"]').is(':checked')<% end %>){
				$('input[type="checkbox"][name="'+ ssid_en_name+'"]').prop("checked",false);
				
				var ssid_text_name="cbid.wireless.wifix_ssid_"+j+".ssid";
				$('input[type="text"][name="'+ ssid_text_name +'"]').attr("disabled",true);
				
				var en_btn_name="cbid.wireless.wifix_ssid_"+j+".encrEdit";
				$('input[type="button"][name="'+ en_btn_name +'"]').attr("disabled",true);
			}
			
		}
	
	}
		
	
	if(mode_5G=="ap"){
		for(var j=1;j<=8;j++){
			var name="wireless.wifi1_ssid_"+j+".disabled";
			var ssid_en_name="cbid.wireless.wifix_ssid_"+j+".disabled";
			if( $('input[type="checkbox"][name="'+ ssid_en_name+'"]').is(':checked')){
			$('input[type="checkbox"][name="'+ name+'"]').removeAttr("disabled");
			}
		}
	}
    else
    {
        <% for i=1,8 do %>
            var name="wireless.wifi1_ssid_"+"<%=i%>"+".disabled";
            $('input[type="checkbox"][name="'+ name+'"]').prop("checked",'<%=uci:get("wireless","wifi1_ssid_"..i,"disabled")%>'=="0"?true:false);
        <% end %>
    }
	<% if WLAN5G_2=="1" then %>
	var mode_5G_2 = $('select[name="cbid.wireless.wifi2.opmode"]').val();
	if(mode_5G_2=="ap"){
		for(var j=1;j<=8;j++){                                                                                                                                                               
                        var name="wireless.wifi2_ssid_"+j+".disabled";
                        var ssid_en_name="cbid.wireless.wifix_ssid_"+j+".disabled";
                        if( $('input[type="checkbox"][name="'+ ssid_en_name+'"]').is(':checked')){                                                                                                                               
                        $('input[type="checkbox"][name="'+ name+'"]').removeAttr("disabled");                                                                                                        
                	}
                }	
	}
    else
    {
        <% for i=1,8 do %>
            var name="wireless.wifi2_ssid_"+"<%=i%>"+".disabled";
            $('input[type="checkbox"][name="'+ name+'"]').prop("checked",'<%=uci:get("wireless","wifi2_ssid_"..i,"disabled")%>'=="0"?true:false);
        <% end %>
    }
	<% end %>
        if(mode_2G == 'ap' )
        {
            $('#wifi0').hide();
            $('#wifi0_blank').hide();
        }
        else
        {
            $('#wifi0').show();
            $('#wifi0_blank').show();
        }
        if(mode_2G=='ap')
        {
            $('input[name$=".wifi0.fasthandover_rssi"]').attr('disabled',$('input[type="radio"][name="cbid.wireless.wifi0.fasthandover_status"]:checked').val()==0?true:false);
            $('input[name$=".wifi0.fasthandover_status"]').each(function(){
                $(this).attr('disabled',false);
            });
            
            if(mode_5G=='ap' <% if WLAN5G_2=="1" then %> && mode_5G_2=='ap' <% end %>){              
            <% if uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_AP_MODE') == '0' or uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_AP_MODE') == nil then %>
                append_WDSAP_option();
            <% end %>
                append_opmode_option('wifi0');
            }
        }
        else
        {
            $('input[name$=".wifi0.fasthandover_status"]').each(function(){
                $(this).attr('disabled',true);
            });
            if (document.getElementsByName('cbid.wireless.wifi0.fasthandover_status').length > 0)
                document.getElementsByName('cbid.wireless.wifi0.fasthandover_status')[1].checked=true;
            $('input[name$=".wifi0.fasthandover_rssi"]').attr('disabled',true);
        }
        if(mode_2G=='wds_ap'){
            append_opmode_option('wifi0');
        }
<% if radioNum >= 2 then %>
    <% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_MODULE') == '1' then %>
        if (mode_2G == 'sta' || mode_2G == 'sta_ap' || mode_2G == 'wds_sta' || mode_2G == 'wds_bridge' || mode_2G == 'wds_ap'){
            $("#cbi-wireless-wifi1-opmode-sta_ap").remove();
        <% if WLAN5G_2=="1" then %>
            $("#cbi-wireless-wifi2-opmode-sta_ap").remove();
        <% end %>
    <% else %>
        if (mode_2G == 'sta' || mode_2G == 'wds_sta' || mode_2G == 'wds_bridge' || mode_2G == 'wds_ap'){
    <% end %>
            $("#cbi-wireless-wifi1-opmode-sta").remove();
            $("#cbi-wireless-wifi1-opmode-wds_bridge").remove();
            $("#cbi-wireless-wifi1-opmode-wds_sta").remove();
            $("#cbi-wireless-wifi1-opmode-wds_ap").remove();
    <% if WLAN5G_2=="1" then %>
            $("#cbi-wireless-wifi2-opmode-sta").remove();
            $("#cbi-wireless-wifi2-opmode-wds_bridge").remove();
            $("#cbi-wireless-wifi2-opmode-wds_sta").remove();
            $("#cbi-wireless-wifi2-opmode-wds_ap").remove();
    <% end %>
        }
        else if((mode_5G == 'ap' ) <% if WLAN5G_2=="1" then %> && ( mode_5G_2 == 'ap' ) <% end %>){
    <% if uci:get('functionlist','functionlist','SUPPORT_CLIENTBRIDGE_MODULE') == '1' then %>  
		if ($("select[name='cbid.wireless.wifi1.opmode'] option[value='sta']").length==0)
            $('select[name="cbid.wireless.wifi1.opmode"]').append('<option id="cbi-wireless-wifi1-opmode-sta" value="sta">Client Bridge</option>');
        <% if WLAN5G_2=="1" then %>
        if ($("select[name='cbid.wireless.wifi2.opmode'] option[value='sta']").length==0)
            $('select[name="cbid.wireless.wifi2.opmode"]').append('<option id="cbi-wireless-wifi2-opmode-sta" value="sta">Client Bridge</option>');
        <% end %>
    <% end %> 
    <% if uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_BRIDGE_MODE') == '0' or uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_BRIDGE_MODE') == nil
        then %>
			if ($("select[name='cbid.wireless.wifi1.opmode'] option[value='wds_bridge']").length==0)
				$('select[name="cbid.wireless.wifi1.opmode"]').append('<option id="cbi-wireless-wifi1-opmode-wds_bridge" value="wds_bridge">WDS Bridge</option>');
    <% end %>
    <% if uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_STATION_MODE') == '0' or uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_STATION_MODE') == nil then %>
			if ($("select[name='cbid.wireless.wifi1.opmode'] option[value='wds_sta']").length==0)
				$('select[name="cbid.wireless.wifi1.opmode"]').append('<option id="cbi-wireless-wifi1-opmode-wds_sta" value="wds_sta">WDS Station</option>');
    <% end %>
    <% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_MODULE') == '1' then %>
			if ($("select[name='cbid.wireless.wifi1.opmode'] option[value='sta_ap']").length==0)
				<% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_CUSTOM_DEFINE') == '1' then %>
				$('select[name="cbid.wireless.wifi1.opmode"]').append('<option id="cbi-wireless-wifi1-opmode-sta_ap" value="sta_ap"><%= uci:get('functionlist','functionlist','SUPPORT_REPEATER_CUSTOM_STRING')%></option>');
				<% else %>
				$('select[name="cbid.wireless.wifi1.opmode"]').append('<option id="cbi-wireless-wifi1-opmode-sta_ap" value="sta_ap">Repeater</option>');
				<% end %>
    <% end %>
    <% if WLAN5G_2=="1" then %>
        <% if uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_BRIDGE_MODE') == '0' or uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_BRIDGE_MODE') == nil then %>
            if ($("select[name='cbid.wireless.wifi2.opmode'] option[value='wds_bridge']").length==0)
                $('select[name="cbid.wireless.wifi2.opmode"]').append('<option id="cbi-wireless-wifi2-opmode-wds_bridge" value="wds_bridge">WDS Bridge</option>');
        <% end %>
        <% if uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_STATION_MODE') == '0' or uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_STATION_MODE') == nil then %>
            if ($("select[name='cbid.wireless.wifi2.opmode'] option[value='wds_sta']").length==0)
                $('select[name="cbid.wireless.wifi2.opmode"]').append('<option id="cbi-wireless-wifi2-opmode-wds_sta" value="wds_sta">WDS Station</option>');
        <% end %>
        <% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_MODULE') == '1' then %>
            if ($("select[name='cbid.wireless.wifi2.opmode'] option[value='sta_ap']").length==0)
                <% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_CUSTOM_DEFINE') == '1' then %>
                $('select[name="cbid.wireless.wifi2.opmode"]').append('<option id="cbi-wireless-wifi2-opmode-sta_ap" value="sta_ap"><%= uci:get('functionlist','functionlist','SUPPORT_REPEATER_CUSTOM_STRING')%></option>');
                <% else %>
                $('select[name="cbid.wireless.wifi2.opmode"]').append('<option id="cbi-wireless-wifi2-opmode-sta_ap" value="sta_ap">Repeater</option>');
                <% end %>
        <% end %>
    <% end %>
        }
<% if uci:get('functionlist','functionlist','SUPPORT_AP_RP_SETUP_WIZARD') == "1" then %>
    if ( support_myid != "1" && mode_2G == 'ap' && mode_5G == 'ap')
    {
        $('select[name="cbid.wireless.wifi1.opmode"]').val("sta_ap");
        $('select[name="cbid.wireless.wifi1.opmode"]').trigger("change");
    }
<% end %>
<% end %>
    });

    $('select[name="cbid.wireless.wifi1.opmode"]').change(function(){
        if (typeof AddMyid !== 'undefined') { AddMyid("cbi","idchange") };  /* add my id*/
        var mode_2G = $("select[name='cbid.wireless.wifi0.opmode']").val();
        var mode_5G = $('select[name="cbid.wireless.wifi1.opmode"]').val();
	if(mode_5G=="ap"){
                <% for i=1,8 do %>
			var name="wireless.wifi1_ssid_"+"<%=i%>"+".disabled";
			$('input[type="checkbox"][name="'+ name+'"]').prop("checked",'<%=uci:get("wireless","wifi1_ssid_"..i,"disabled")%>'=="0"?true:false);

			var ssid_en_name="cbid.wireless.wifix_ssid_"+"<%=i%>"+".disabled";
			if('<%=uci:get("wireless","wifi1_ssid_"..i,"disabled")%>'=="0"){
                                $('input[type="checkbox"][name="'+ ssid_en_name+'"]').prop("checked",true);
				$('input[type="checkbox"][name="'+ name+'"]').attr("disabled",false);

				var ssid_text_name="cbid.wireless.wifix_ssid_"+"<%=i%>"+".ssid";
				$('input[type="text"][name="'+ ssid_text_name +'"]').attr("disabled",false);

				var en_btn_name="cbid.wireless.wifix_ssid_"+"<%=i%>"+".encrEdit";
				$('input[type="button"][name="'+ en_btn_name +'"]').attr("disabled",false);
			}
                <% end %>
        }else{        
                for(var j=1;j<=8;j++){
                        var ssid_en_name="cbid.wireless.wifix_ssid_"+j+".disabled";
                        var name_2g="wireless.wifi0_ssid_"+j+".disabled";
   			<% if WLAN5G_2=="1" then %>
   			var name_5g_2="wireless.wifi2_ssid_"+j+".disabled";
   			<% end %>
                        if(!$('input[type="checkbox"][name="'+name_2g+'"]').is(':checked')<% if WLAN5G_2=="1" then %>&& !$('input[type="checkbox"][name="'+name_5g_2+'"]').is(':checked')<% end %>){
                                $('input[type="checkbox"][name="'+ ssid_en_name+'"]').prop("checked",false);
                       		
				var ssid_text_name="cbid.wireless.wifix_ssid_"+j+".ssid";                    
                        $('input[type="text"][name="'+ ssid_text_name +'"]').attr("disabled",true);  
                                                                                                     
                        var en_btn_name="cbid.wireless.wifix_ssid_"+j+".encrEdit";                   
                        $('input[type="button"][name="'+ en_btn_name +'"]').attr("disabled",true); 
                        
                        }
                }
        }
        
        
        if(mode_2G=="ap"){
        	for(var j=1;j<=8;j++){
        		var name="wireless.wifi0_ssid_"+j+".disabled";
        		var ssid_en_name="cbid.wireless.wifix_ssid_"+j+".disabled";
        		if( $('input[type="checkbox"][name="'+ ssid_en_name+'"]').is(':checked') ){
        			$('input[type="checkbox"][name="'+ name+'"]').removeAttr("disabled");
        		}
        	}
        }
	<% if WLAN5G_2=="1" then %>
      	var mode_5G_2 = $('select[name="cbid.wireless.wifi2.opmode"]').val();
	if(mode_5G_2=="ap"){                                                                                                                                                                           
                for(var j=1;j<=8;j++){                                                                                                                                                                
                	var name="wireless.wifi2_ssid_"+j+".disabled";                                                                                                                                       
                	var ssid_en_name="cbid.wireless.wifix_ssid_"+j+".disabled";
                	 if( $('input[type="checkbox"][name="'+ ssid_en_name+'"]').is(':checked') ){
                	$('input[type="checkbox"][name="'+ name+'"]').removeAttr("disabled");                                                                                                                
                	}
                }
        }
	<% end %>
        if(mode_5G == 'ap')
        {
            $('#wifi1').hide();
            $('#wifi1_blank').hide();
        }
        else
        {
            $('#wifi1').show();
            $('#wifi1_blank').show();
        }
        if(mode_5G=='ap')
        {
            $('input[name$=".wifi1.fasthandover_rssi"]').attr('disabled',$('input[type="radio"][name="cbid.wireless.wifi1.fasthandover_status"]:checked').val()==0?true:false);
            $('input[name$=".wifi1.fasthandover_status"]').each(function(){
                $(this).attr('disabled',false);
            });
           
           if(mode_2G=='ap' <% if WLAN5G_2=="1" then %> && mode_5G_2=='ap' <% end %>){
                <% if uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_AP_MODE') == '0' or uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_AP_MODE') == nil then %>
                append_WDSAP_option();
                <% end %>
                append_opmode_option('wifi1');
            }
        }
        else
        {
            $('input[name$=".wifi1.fasthandover_status"]').each(function(){
                $(this).attr('disabled',true);
            });
            if (document.getElementsByName('cbid.wireless.wifi1.fasthandover_status').length > 0)
                document.getElementsByName('cbid.wireless.wifi1.fasthandover_status')[1].checked=true;
            $('input[name$=".wifi1.fasthandover_rssi"]').attr('disabled',true);
        }
        if(mode_5G == 'wds_ap' ){
            append_opmode_option('wifi1');
        }
<% if radioNum >= 2 then %>
    <% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_MODULE') == '1' then %> 
        if (mode_5G == 'sta' || mode_5G == 'sta_ap' || mode_5G == 'wds_sta' || mode_5G == 'wds_bridge' || mode_5G == 'wds_ap'){
            $("#cbi-wireless-wifi0-opmode-sta_ap").remove();
        <% if WLAN5G_2=="1" then %>
            $("#cbi-wireless-wifi2-opmode-sta_ap").remove();
        <% end %>
    <% else %>            
        if (mode_5G == 'sta' || mode_5G == 'wds_sta' || mode_5G == 'wds_bridge' || mode_5G == 'wds_ap'){
    <% end %>            
            $("#cbi-wireless-wifi0-opmode-sta").remove();
            $("#cbi-wireless-wifi0-opmode-wds_bridge").remove();
            $("#cbi-wireless-wifi0-opmode-wds_sta").remove();
            $("#cbi-wireless-wifi0-opmode-wds_ap").remove();
        <% if WLAN5G_2=="1" then %>
            $("#cbi-wireless-wifi2-opmode-sta").remove();
            $("#cbi-wireless-wifi2-opmode-wds_bridge").remove();
            $("#cbi-wireless-wifi2-opmode-wds_sta").remove();
            $("#cbi-wireless-wifi2-opmode-wds_ap").remove();
        <% end %>
        } 
        else if( ( mode_2G == 'ap' ) <% if WLAN5G_2=="1" then %> && ( mode_5G_2 == 'ap' ) <% end %> ){
    <% if uci:get('functionlist','functionlist','SUPPORT_CLIENTBRIDGE_MODULE') == '1' then %> 
			if ($("select[name='cbid.wireless.wifi0.opmode'] option[value='sta']").length==0)
				$('select[name="cbid.wireless.wifi0.opmode"]').append('<option id="cbi-wireless-wifi0-opmode-sta" value="sta">Client Bridge</option>'); 
        <% if WLAN5G_2=="1" then %>
            if ($("select[name='cbid.wireless.wifi2.opmode'] option[value='sta']").length==0)
                $('select[name="cbid.wireless.wifi2.opmode"]').append('<option id="cbi-wireless-wifi2-opmode-sta" value="sta">Client Bridge</option>');
        <% end %> 
    <% end %>
    <% if uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_BRIDGE_MODE') == '0' or uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_BRIDGE_MODE') == nil then %>
			if ($("select[name='cbid.wireless.wifi0.opmode'] option[value='wds_bridge']").length==0)
				$('select[name="cbid.wireless.wifi0.opmode"]').append('<option id="cbi-wireless-wifi0-opmode-wds_bridge" value="wds_bridge">WDS Bridge</option>');
    <% end %>
    <% if uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_STATION_MODE') == '0' or uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_STATION_MODE') == nil then %>
			if ($("select[name='cbid.wireless.wifi0.opmode'] option[value='wds_sta']").length==0)
				$('select[name="cbid.wireless.wifi0.opmode"]').append('<option id="cbi-wireless-wifi0-opmode-wds_sta" value="wds_sta">WDS Station</option>');
    <% end %>
    <% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_MODULE') == '1' then %>
			if ($("select[name='cbid.wireless.wifi0.opmode'] option[value='sta_ap']").length==0)
				<% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_CUSTOM_DEFINE') == '1' then %>
				$('select[name="cbid.wireless.wifi0.opmode"]').append('<option id="cbi-wireless-wifi0-opmode-sta_ap" value="sta_ap"><%= uci:get('functionlist','functionlist','SUPPORT_REPEATER_CUSTOM_STRING')%></option>');
				<% else %>
				$('select[name="cbid.wireless.wifi0.opmode"]').append('<option id="cbi-wireless-wifi0-opmode-sta_ap" value="sta_ap">Repeater</option>');
				<% end %>
    <% end %>
    <% if WLAN5G_2=="1" then %>
        <% if uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_BRIDGE_MODE') == '0' or uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_BRIDGE_MODE') == nil then %>
            if ($("select[name='cbid.wireless.wifi2.opmode'] option[value='wds_bridge']").length==0)
                $('select[name="cbid.wireless.wifi2.opmode"]').append('<option id="cbi-wireless-wifi2-opmode-wds_bridge" value="wds_bridge">WDS Bridge</option>');
        <% end %>
        <% if uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_STATION_MODE') == '0' or uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_STATION_MODE') == nil then %>
            if ($("select[name='cbid.wireless.wifi2.opmode'] option[value='wds_sta']").length==0)
                $('select[name="cbid.wireless.wifi2.opmode"]').append('<option id="cbi-wireless-wifi2-opmode-wds_sta" value="wds_sta">WDS Station</option>');
        <% end %>
        <% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_MODULE') == '1' then %>
            if ($("select[name='cbid.wireless.wifi2.opmode'] option[value='sta_ap']").length==0)
                <% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_CUSTOM_DEFINE') == '1' then %>
                $('select[name="cbid.wireless.wifi2.opmode"]').append('<option id="cbi-wireless-wifi2-opmode-sta_ap" value="sta_ap"><%= uci:get('functionlist','functionlist','SUPPORT_REPEATER_CUSTOM_STRING')%></option>');
                <% else %>
                $('select[name="cbid.wireless.wifi2.opmode"]').append('<option id="cbi-wireless-wifi2-opmode-sta_ap" value="sta_ap">Repeater</option>');
                <% end %>
        <% end %>
    <% end %>
        }
<% if uci:get('functionlist','functionlist','SUPPORT_AP_RP_SETUP_WIZARD') == "1" then %>
    if ( support_myid != "1" && mode_5G == 'ap' && mode_2G == 'ap')
    {
        $('select[name="cbid.wireless.wifi0.opmode"]').val("sta_ap");
        $('select[name="cbid.wireless.wifi0.opmode"]').trigger("change");
    }
<% end %>
<% end %>
<% if uci:get('functionlist','functionlist','SUPPORT_ENJET') == '1' then %>
        var mode_5G = $('select[name="cbid.wireless.'+dev_name+'.opmode"]').val();
        if($('input[type="radio"][name="cbid.wireless.wifi1.qboost_enable"]:checked').val() == 0 )
        {
            if($('select[name="cbid.wireless.'+dev_name+'.opmode"]').val()=='wds_ap' || $('select[name="cbid.wireless.'+dev_name+'.opmode"]').val()=='wds_bridge'){
            <% if uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_BRIDGE_MODE') == '0' or uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_BRIDGE_MODE') == nil then %>
                $("#wdslink2").show();
            <% end %>
            }
            <% for i=1,8 do %>
                if('<%=uci:get("wireless","wifi1_ssid_"..i,"disabled")%>'=="0"){
                    $('input[type="checkbox"][name="cbid.wireless.wifix_ssid_'+"<%=i%>"+'.disabled"]').attr("disabled",false);
                    $('input[type="text"][name="cbid.wireless.wifix_ssid_'+"<%=i%>"+'.ssid"]').attr("disabled",false);
                    $('input[type="button"][name="cbid.wireless.wifix_ssid_'+"<%=i%>"+'.encrEdit"]').attr("disabled",false);
                    $('input[type="checkbox"][name="cbid.wireless.wifix_ssid_'+"<%=i%>"+'.guest_network"]').attr("disabled",false);
                }
            <% end %>
            $("#wifi1_tdma_tbl").find("input").attr("disabled", "disabled");
            $("#wifi1_tdma").hide();
        }
        else
        {
            if(mode_5G=="wds_ap"){
                $("#wdslink2").hide();
            }
            if(mode_5G =="sta" || mode_5G =="wds_sta"){
                $("#wifi1_tdma").hide();
            }
            else if(mode_5G =="wds_ap" || mode_5G =="ap")
            {
                <% for i=1,1 do %>
                    $('input[type="checkbox"][name="cbid.wireless.wifix_ssid_tdma_'+"<%=i%>"+'.disabled"]').prop("checked",true);
                    $('input[type="text"][name="cbid.wireless.wifix_ssid_tdma_'+"<%=i%>"+'.ssid"]').attr("disabled",false);
                    $('input[type="button"][name="cbid.wireless.wifix_ssid_tdma_'+"<%=i%>"+'.encrEdit"]').attr("disabled",false);
                    $('input[type="checkbox"][name="cbid.wireless.wifix_ssid_tdma_'+"<%=i%>"+'.guest_network"]').attr("disabled",false);
                <% end %>
                $("#wifi1_tdma").show();

                <% for i=1,8 do %>
                    if('<%=uci:get("wireless","wifi1_ssid_"..i,"disabled")%>'=="0"){
                        $('input[type="checkbox"][name="cbid.wireless.wifix_ssid_'+"<%=i%>"+'.disabled"]').attr("disabled",true);
                        $('input[type="text"][name="cbid.wireless.wifix_ssid_'+"<%=i%>"+'.ssid"]').attr("disabled",true);
                        $('input[type="button"][name="cbid.wireless.wifix_ssid_'+"<%=i%>"+'.encrEdit"]').attr("disabled",true);
                        $('input[type="checkbox"][name="cbid.wireless.wifix_ssid_'+"<%=i%>"+'.guest_network"]').attr("disabled",true);
                    }
                <% end %>
                $('#wifix').hide();
                $('#wifi1').hide();
            }
        }
        $('input[type="checkbox"][name="cbid.wireless.wifix_ssid_tdma_1.disabled"]').attr("disabled",true);
<% end %>
    });
    <% if WLAN5G_2=="1" then %>
        $('select[name="cbid.wireless.wifi2.opmode"]').change(function(){
            if (typeof AddMyid !== 'undefined') { AddMyid("cbi","idchange") };  /* add my id*/
            var mode_2G = $("select[name='cbid.wireless.wifi0.opmode']").val();
            var mode_5G = $('select[name="cbid.wireless.wifi1.opmode"]').val();
            var mode_5G_2 = $('select[name="cbid.wireless.wifi2.opmode"]').val();
		if(mode_5G_2=="ap"){
                <% for i=1,8 do %>
			var name="wireless.wifi2_ssid_"+"<%=i%>"+".disabled";
			$('input[type="checkbox"][name="'+ name+'"]').prop("checked",'<%=uci:get("wireless","wifi2_ssid_"..i,"disabled")%>'=="0"?true:false);

			var ssid_en_name="cbid.wireless.wifix_ssid_"+"<%=i%>"+".disabled";
			if('<%=uci:get("wireless","wifi2_ssid_"..i,"disabled")%>'=="0"){
				$('input[type="checkbox"][name="'+ ssid_en_name+'"]').prop("checked",true);
				$('input[type="checkbox"][name="'+ name+'"]').attr("disabled",false);

				var ssid_text_name="cbid.wireless.wifix_ssid_"+"<%=i%>"+".ssid";
				$('input[type="text"][name="'+ ssid_text_name +'"]').attr("disabled",false);

				var en_btn_name="cbid.wireless.wifix_ssid_"+"<%=i%>"+".encrEdit";
				$('input[type="button"][name="'+ en_btn_name +'"]').attr("disabled",false);	
			}
                <% end %>
		}else{
			for(var j=1;j<=8;j++){                                                                                                                       
                        	var ssid_en_name="cbid.wireless.wifix_ssid_"+j+".disabled";                                                                          
                        	var name_2g="wireless.wifi0_ssid_"+j+".disabled";                                                                                               
                        	var name_5g="wireless.wifi1_ssid_"+j+".disabled";                                                                                  
                        
				if(!$('input[type="checkbox"][name="'+name_2g+'"]').is(':checked') && !$('input[type="checkbox"][name="'+name_5g+'"]').is(':checked')){
                                	$('input[type="checkbox"][name="'+ ssid_en_name+'"]').prop("checked",false);
                        
                        var ssid_text_name="cbid.wireless.wifix_ssid_"+j+".ssid";                    
                        $('input[type="text"][name="'+ ssid_text_name +'"]').attr("disabled",true);  
                                                                                                     
                        var en_btn_name="cbid.wireless.wifix_ssid_"+j+".encrEdit";                   
                        $('input[type="button"][name="'+ en_btn_name +'"]').attr("disabled",true);                                                                                        
                        	}	
			}
		}
		
		if(mode_2G=="ap"){                                                                                                                                                                          
                for(var j=1;j<=8;j++){                                                                                                                                                               
                	var name="wireless.wifi0_ssid_"+j+".disabled";
                    var ssid_en_name="cbid.wireless.wifix_ssid_"+j+".disabled";
                    if( $('input[type="checkbox"][name="'+ ssid_en_name+'"]').is(':checked')){                                                                                                                                      
                	$('input[type="checkbox"][name="'+ name+'"]').removeAttr("disabled");
                    }                                                                                                                
                }
       }

		if(mode_5G=="ap"){                                                                                                                                                                          
                for(var j=1;j<=8;j++){                                                                                                                                                                      
                        var name="wireless.wifi1_ssid_"+j+".disabled";
                        var ssid_en_name="cbid.wireless.wifix_ssid_"+j+".disabled";
                        if( $('input[type="checkbox"][name="'+ ssid_en_name+'"]').is(':checked')){                                                                                                                                      
                        $('input[type="checkbox"][name="'+ name+'"]').removeAttr("disabled");
                        }                                                                                                               
                }
      }		
	
		if(mode_5G_2 == 'ap')
            {
                $('#wifi2').hide();
                $('#wifi2_blank').hide();
            }
            else
            {
                $('#wifi2').show();
                $('#wifi2_blank').show();
            }
            if(mode_5G_2=='ap')
            {
                $('input[name$=".wifi2.fasthandover_rssi"]').attr('disabled',$('input[type="radio"][name="cbid.wireless.wifi2.fasthandover_status"]:checked').val()==0?true:false);
                $('input[name$=".wifi2.fasthandover_status"]').each(function(){
                    $(this).attr('disabled',false);
                });

                if(mode_2G=='ap' && mode_5G=='ap'){
                <% if uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_AP_MODE') == '0' or uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_AP_MODE') == nil then %>
                    append_WDSAP_option();
                <% end %>
                    append_opmode_option('wifi2');
            }
            }
            else
            {
                $('input[name$=".wifi2.fasthandover_status"]').each(function(){
                    $(this).attr('disabled',true);
                });
                if (document.getElementsByName('cbid.wireless.wifi2.fasthandover_status').length > 0)
                    document.getElementsByName('cbid.wireless.wifi2.fasthandover_status')[1].checked=true;
                $('input[name$=".wifi2.fasthandover_rssi"]').attr('disabled',true);
            }
            if(mode_5G_2 == 'wds_ap' ){
               append_opmode_option('wifi2');
             }
    <% if radioNum > 2 then %>
        <% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_MODULE') == '1' then %> 
            if (mode_5G_2 == 'sta' || mode_5G_2 == 'sta_ap' || mode_5G_2 == 'wds_sta' || mode_5G_2 == 'wds_bridge' || mode_5G_2 == 'wds_ap'){
                $("#cbi-wireless-wifi0-opmode-sta_ap").remove();
                $("#cbi-wireless-wifi1-opmode-sta_ap").remove();
        <% else %>            
            if (mode_5G_2 == 'sta' || mode_5G_2 == 'wds_sta' || mode_5G_2 == 'wds_bridge' || mode_5G_2 == 'wds_ap'){
        <% end %>            
                $("#cbi-wireless-wifi0-opmode-sta").remove();
                $("#cbi-wireless-wifi0-opmode-wds_bridge").remove();
                $("#cbi-wireless-wifi0-opmode-wds_sta").remove();
                $("#cbi-wireless-wifi1-opmode-sta").remove();
                $("#cbi-wireless-wifi1-opmode-wds_bridge").remove();
                $("#cbi-wireless-wifi1-opmode-wds_sta").remove();
                $("#cbi-wireless-wifi0-opmode-wds_ap").remove();
                $("#cbi-wireless-wifi1-opmode-wds_ap").remove();
            } 
            else if( ( mode_5G == 'ap') && ( mode_2G == 'ap') ){
        <% if uci:get('functionlist','functionlist','SUPPORT_CLIENTBRIDGE_MODULE') == '1' then %> 
                if ($("select[name='cbid.wireless.wifi0.opmode'] option[value='sta']").length==0)
                    $('select[name="cbid.wireless.wifi0.opmode"]').append('<option id="cbi-wireless-wifi0-opmode-sta" value="sta">Client Bridge</option>');
                if ($("select[name='cbid.wireless.wifi1.opmode'] option[value='sta']").length==0)
                    $('select[name="cbid.wireless.wifi1.opmode"]').append('<option id="cbi-wireless-wifi1-opmode-sta" value="sta">Client Bridge</option>');
        <% end %>
        <% if uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_BRIDGE_MODE') == '0' or uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_BRIDGE_MODE') == nil then %>
                if ($("select[name='cbid.wireless.wifi0.opmode'] option[value='wds_bridge']").length==0)
                    $('select[name="cbid.wireless.wifi0.opmode"]').append('<option id="cbi-wireless-wifi0-opmode-wds_bridge" value="wds_bridge">WDS Bridge</option>');
        <% end %>
        <% if uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_STATION_MODE') == '0' or uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_STATION_MODE') == nil then %>
                if ($("select[name='cbid.wireless.wifi0.opmode'] option[value='wds_sta']").length==0)
                    $('select[name="cbid.wireless.wifi0.opmode"]').append('<option id="cbi-wireless-wifi0-opmode-wds_sta" value="wds_sta">WDS Station</option>');
        <% end %>
        <% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_MODULE') == '1' then %>
                if ($("select[name='cbid.wireless.wifi0.opmode'] option[value='sta_ap']").length==0)
                    <% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_CUSTOM_DEFINE') == '1' then %>
                    $('select[name="cbid.wireless.wifi0.opmode"]').append('<option id="cbi-wireless-wifi0-opmode-sta_ap" value="sta_ap"><%= uci:get('functionlist','functionlist','SUPPORT_REPEATER_CUSTOM_STRING')%></option>');
                    <% else %>
                    $('select[name="cbid.wireless.wifi0.opmode"]').append('<option id="cbi-wireless-wifi0-opmode-sta_ap" value="sta_ap">Repeater</option>');
                    <% end %>
        <% end %>
        <% if uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_BRIDGE_MODE') == '0' or uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_BRIDGE_MODE') == nil then %>
                if ($("select[name='cbid.wireless.wifi1.opmode'] option[value='wds_bridge']").length==0)
                    $('select[name="cbid.wireless.wifi1.opmode"]').append('<option id="cbi-wireless-wifi1-opmode-wds_bridge" value="wds_bridge">WDS Bridge</option>');
        <% end %>
        <% if uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_STATION_MODE') == '0' or uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_STATION_MODE') == nil then %>
                if ($("select[name='cbid.wireless.wifi1.opmode'] option[value='wds_sta']").length==0)
                    $('select[name="cbid.wireless.wifi1.opmode"]').append('<option id="cbi-wireless-wifi1-opmode-wds_sta" value="wds_sta">WDS Station</option>');
        <% end %>
        <% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_MODULE') == '1' then %>
                if ($("select[name='cbid.wireless.wifi1.opmode'] option[value='sta_ap']").length==0)
                    <% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_CUSTOM_DEFINE') == '1' then %>
                    $('select[name="cbid.wireless.wifi1.opmode"]').append('<option id="cbi-wireless-wifi1-opmode-sta_ap" value="sta_ap"><%= uci:get('functionlist','functionlist','SUPPORT_REPEATER_CUSTOM_STRING')%></option>');
                    <% else %>
                    $('select[name="cbid.wireless.wifi1.opmode"]').append('<option id="cbi-wireless-wifi1-opmode-sta_ap" value="sta_ap">Repeater</option>');
                    <% end %>
        <% end %>
            }
    <% end %>
        });
    <% end --[[ #### if WLAN5G_2=="1" then END ### --]]%>
<% end --[[ #### SUPPORT_AP_MODE_ONLY END ### --]] %>

<% if WLAN24G=="1" and WLAN5G=="1" then %>
    $("select[name$='opmode']").change(function(){
        var selected_val = $('select[name="cbid.wireless.wifi0.htmode"]').val();
        $('select[name="cbid.wireless.wifi0.htmode"]').html($('select[name="cbid.wireless.wifi0.htmode"] option').sort(function (a, b) {
            return a.text == b.text ? 0 : a.text < b.text ? 1 : -1
        }))
        $('select[name="cbid.wireless.wifi0.htmode"]').val(selected_val);
    });
<% end %>
    $("select[name$='opmode']").each(function(){$(this).triggerHandler("change");});

<% if uci:get('functionlist','functionlist','SUPPORT_MULTI_TO_UNI_CONVERSION') == "1" then %>
   $(':radio[name$="mcastenhance"][value="'+<%=uci:get_first("wireless","wifi-iface","mcastenhance")%>+'"]').prop('checked', true).triggerHandler('click');    
<%end%>
    $('select[name="cbid.wireless.wifi0.country"]').change(function(){
        country_changed+=1;
//---------if change country alert message the channel set to all ------------------
<% if (uci:get("functionlist","functionlist","SUPPORT_WLAN24G"))=="1" then %>
        if ($(this).val() != "<%=uci:get('wireless','wifi0','country')%>")
<% else %>
        if ($(this).val() != "<%=uci:get('wireless','wifi1','country')%>")
<% end %>
        {
            alert("<%:Warning: Channels selected will be reverted to All. You should select channels you need again.%>");
            $("input[name='country_change_chan']").val("0");
        }
<% if WLAN24G == '1' and WLAN5G == '1' then %>
        if ($(this).val() == "831" || $(this).val() == "829"){
            <% for i = 1, 8 do %>
                $('input[type="checkbox"][name="wireless.wifi0_ssid_' + "<%=i%>" + '.disabled"]').attr("disabled", true);
            <% end %>
        }
        else if($('select[name="cbid.wireless.wifi0.opmode"]').val() == "ap"){
            <% for i = 1, 8 do %>
                if ($('input[type="checkbox"][name="cbid.wireless.wifix_ssid_' + "<%=i%>" + '.disabled"]').is(':checked')){
                    $('input[type="checkbox"][name="wireless.wifi0_ssid_' + "<%=i%>" + '.disabled"]').attr("disabled", false);
                }
            <% end %>
        }
<% end %>
        //channel_handler.val("wifi0",$('select[name$="wifi0.channel"]  option:selected').val());
        //channel_handler.val("wifi1",$('select[name$="wifi1.channel"]  option:selected').val());
        ajax_getChannelList($(this).find('option:selected').val(),reg_domain);
        //JAPAN support channel 14 only for 11b
        if($(this).val() == '<%=JAPAN_COUNTRY_ID%>'){
            if($('select[name="cbid.wireless.wifi0.hwmode"]').val() != '11b')
                hide_option("wifi0.channel", "14", "hide");
            else
                hide_option("wifi0.channel", "14", "show");
        }
        if (functionlist.SUPPORT_WLAN_EXTENSION_CHANNEL == 1){ 
            $('select[name$=".ext_channel"]').each(function(){$(this).triggerHandler("change")});
            $('select[name$=".channel"]').each(function(){$(this).triggerHandler("change")});
        }
    });
    $('select[name="cbid.wireless.wifi0.country"]').triggerHandler("change");
    $('select[name$="mac_select"]').each(function(){$(this).triggerHandler("change")});
}; /* Device_init end */
function Device_init_notrigger(){
    $('input[type="checkbox"][name$="obeyregpower"]').change(function(){
        ajax_getChannelList($('select[name$="country"]').val(),reg_domain);
        channel_handler.set("wifi0",channel_handler.getVal("wifi0"));
    });
    checkPureN();
}; /* Device_init_notrigger end */

var device_flag=0, last_flag=0;
function loadDevice(dev_name,container,url,layoutTable,last){
    $.ajax({
        type : "GET",
        url:url,
        dataType:"html",
        error:function(err){
            // loadDevice(url);
        },
        success:function(result){
            $(container).html(result);
            rematch(layoutTable);
			dominCountryRule();
            SettingRule(dev_name);
            $("#cbi_set").hide(); 
            $(".cbi-map").hide();
            
            $('select[name$="'+dev_name+'.opmode"]').change(opmode_set_interface);
            // if(dev_name=="wifi1" || dev_name=="wifi2"){
            //     $('select[name$="'+dev_name+'.htmode"]').unbind("change",(dev_name=="wifi1")?channel_handler._5g: channel_handler._5g_2);
            //     $('select[name$="'+dev_name+'.htmode"]').bind("change",(dev_name=="wifi2")?channel_handler._5g: channel_handler._5g_2);
            // }

            if (device_flag==<%=radioNum-1%>){
                if (functionlist.SUPPORT_FIXED_COUNTRY == "1" ){
                    if ( !(reg_domain == "0" && support_myid == "1") ) // if reg_domain is FCC and support_myid, do not disable country
                        $('select[name="cbid.wireless.wifi0.country"]').attr("disabled",true);
                    else
                        $('select[name="cbid.wireless.wifi0.country"]').attr("disabled",false);
                }
                Device_init();
                checkPureN();
<% if uci:get('functionlist','functionlist','SUPPORT_MYID') == '1' then %>
                AddMyid("cbi","idchange");
<% end %>
                last_flag++;
            }else{
                device_flag++;
            }
            triggerDevice(dev_name);
            if(last_flag==1){Device_init_notrigger()};
        }
    });
}  /* loadDevice end */

/* LACP */
if(functionlist.SUPPORT_ETHERNET_BONDING==1){
    var mut_status={}
    function get_lacp_mut_status(){
        $.ajax({
            url: "<%=luci.dispatcher.build_url('admin/status/get_lacp_mut_status')%>",
            data:"get_info=lacp",
            success: function(re) {
                mut_status = re;
            }
        }); 
    }
}
var is_form_submit = "0";
    var ifaceTable={
            "wifi0":{        
                "ap":[],
                "sta":[],
                "wds_sta":[],
                "wds_bridge":[],
                "wds_ap":[]
<% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_MODULE') == '1' then %>
                ,"sta_ap":[]
<% end %>                
            },
            "wifi1":{
                "ap":[],
                "sta":[],
                "wds_sta":[],
                "wds_bridge":[],
                "wds_ap":[]
<% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_MODULE') == '1' then %>
                ,"sta_ap":[]
<% end %>
            },
            "wifi2":{
                "ap":[],
                "sta":[],
                "wds_sta":[],
                "wds_bridge":[],
                "wds_ap":[]
<% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_MODULE') == '1' then %>
                ,"sta_ap":[]
<% end %>
            }
        }

    var iface_netid_Table={
            "wifi0":{        
                "ap":[],
                "sta":[],
                "wds_sta":[],
                "wds_bridge":[],
                "wds_ap":[]
<% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_MODULE') == '1' then %>
                ,"sta_ap":[]
<% end %>                 
            },
            "wifi1":{
                "ap":[],
                "sta":[],
                "wds_sta":[],
                "wds_bridge":[],
                "wds_ap":[]
<% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_MODULE') == '1' then %>
                ,"sta_ap":[]
<% end %>
            },
            "wifi2":{
                "ap":[],
                "sta":[],
                "wds_sta":[],
                "wds_bridge":[],
                "wds_ap":[]
<% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_MODULE') == '1' then %>
                ,"sta_ap":[]
<% end %>
            }
        }

    var guest_name_Table={},guest_netid_Table={},iface_rematch_table={};

    var green_wifi0 = '<%=uci:get("wireless","wifi0","obeyregpower")%>';
    var green_wifi1 = '<%=uci:get("wireless","wifi1","obeyregpower")%>';
    var green_wifi2 = '<%=uci:get("wireless","wifi2","obeyregpower") or "" %>';
    var reg_domain = <%=luci.util.exec("setconfig -g 4")%>;
    var support_myid = '<%=uci:get("functionlist","functionlist","SUPPORT_MYID") or "" %>';
/*the elements of cbi want to change position in view*/
    var layoutTableDevice ={
//        <!----------------- country code, devce name----------------------------------------->
            "cbi-sysProductInfo-model-SystemName-view" : "cbi-sysProductInfo-model-SystemName",
            "cbi-wireless-wifi0-country-view" : "cbi-wireless-wifi0-country",
//        <!----------------- 2.4g,5g device setting----------------------------------------->      
            "cbi-wireless-wifi0-opmode-view" : "cbi-wireless-wifi0-opmode",
            "cbi-wireless-wifi1-opmode-view" : "cbi-wireless-wifi1-opmode",
            "cbi-wireless-wifi0-hwmode-view" : "cbi-wireless-wifi0-hwmode",
            "cbi-wireless-wifi1-hwmode-view" : "cbi-wireless-wifi1-hwmode",
            "cbi-wireless-wifi0-htmode-view" : "cbi-wireless-wifi0-htmode",
            "cbi-wireless-wifi1-htmode-view" : "cbi-wireless-wifi1-htmode",
<% if uci:get('functionlist','functionlist','SUPPORT_WLAN_EXTENSION_CHANNEL') == '1' then --[[ #### SUPPORT_WLAN_EXTENSION_CHANNEL START ### --]] %>  
            "cbi-wireless-wifi0-ext_channel-view" : "cbi-wireless-wifi0-ext_channel",
            "cbi-wireless-wifi1-ext_channel-view" : "cbi-wireless-wifi1-ext_channel",   
<% end --[[ #### SUPPORT_WLAN_EXTENSION_CHANNEL END ### --]] %>
<% 
if uci:get('functionlist','functionlist','SUPPORT_WLAN_OUTDOOR_DISTANCE_ENV') == '1' then --[[ #### SUPPORT_WLAN_OUTDOOR_DISTANCE_ENV START ### --]]
    if uci:get('sysProductInfo','model','outdoor') == '1' then
%>  
            "cbi-wireless-wifi0-distance-env-view" : "cbi-wireless-wifi0-distance_env",
            "cbi-wireless-wifi1-distance-env-view" : "cbi-wireless-wifi1-distance_env",   
<%
    end
end --[[ #### SUPPORT_WLAN_OUTDOOR_DISTANCE_ENV END ### --]] 
%>
<%
if uci:get('functionlist','functionlist','SUPPORT_WLAN_OUTDOOR_DISTANCE') == '1' then --[[ #### SUPPORT_WLAN_OUTDOOR_DISTANCE START ### --]]
    if uci:get('sysProductInfo','model','outdoor') == '1' then
%>  
            "cbi-wireless-wifi0-distance-view" : "cbi-wireless-wifi0-distance",
            "cbi-wireless-wifi1-distance-view" : "cbi-wireless-wifi1-distance",
<%
    end
end --[[ #### SUPPORT_WLAN_OUTDOOR_DISTANCE END ### --]]
%>
            "cbi-wireless-wifi0-channel-view" : "cbi-wireless-wifi0-channel",
            "cbi-wireless-wifi1-channel-view" : "cbi-wireless-wifi1-channel",
            "cbi-wireless-wifi0-txpower-view" : "cbi-wireless-wifi0-txpower",
            "cbi-wireless-wifi1-txpower-view" : "cbi-wireless-wifi1-txpower",
            "cbi-wireless-wifi0-rate-view" : "cbi-wireless-wifi0-rate",
            "cbi-wireless-wifi1-rate-view" : "cbi-wireless-wifi1-rate",
            "cbi-wireless-wifi0-rts-view" : "cbi-wireless-wifi0-rts",
            "cbi-wireless-wifi1-rts-view" : "cbi-wireless-wifi1-rts",
            "cbi-wireless-wifi0-clientlimits_number-view" : "cbi-wireless-wifi0-clientlimits_number",
            "cbi-wireless-wifi1-clientlimits_number-view" : "cbi-wireless-wifi1-clientlimits_number",
            "cbi-wireless-wifi0-clientlimits_enable-view" : "cbi-wireless-wifi0-clientlimits_enable",
            "cbi-wireless-wifi1-clientlimits_enable-view" : "cbi-wireless-wifi1-clientlimits_enable",
            "cbi-wireless-wifi0-aggregation_enable-view" : "cbi-wireless-wifi0-aggregation_enable",
            "cbi-wireless-wifi1-aggregation_enable-view" : "cbi-wireless-wifi1-aggregation_enable",
            "cbi-wireless-wifi0-aggregation_frame-view" : "cbi-wireless-wifi0-aggregation_frame",
            "cbi-wireless-wifi1-aggregation_frame-view" : "cbi-wireless-wifi1-aggregation_frame",
            "cbi-wireless-wifi0-aggregation_byte-view" : "cbi-wireless-wifi0-aggregation_byte",
            "cbi-wireless-wifi1-aggregation_byte-view" : "cbi-wireless-wifi1-aggregation_byte",
//              <!--- re-arrange last for  disable value function------------------------------------>
            "cbi-wireless-wifi0-obeyregpower-view" : "cbi-wireless-wifi0-obeyregpower", 
            "cbi-wireless-wifi1-obeyregpower-view" : "cbi-wireless-wifi1-obeyregpower"

        };
    var layoutTableDevice_SystemName={
//        <!----------------- country code, devce name----------------------------------------->
            "cbi-sysProductInfo-model-SystemName-view" : "cbi-sysProductInfo-model-SystemName",
            "cbi-wireless-wifi0-country-view" : "cbi-wireless-wifi0-country",
    };
    <% for _, r in pairs({"2.4G","5G"}) do %>
        <% for i=1,#devs[r] do %>
            var layoutTableDevice_<%=devs[r][i]%>={
                "cbi-wireless-<%=devs[r][i]%>-opmode-view" : "cbi-wireless-<%=devs[r][i]%>-opmode",
                "cbi-wireless-<%=devs[r][i]%>-hwmode-view" : "cbi-wireless-<%=devs[r][i]%>-hwmode",
                "cbi-wireless-<%=devs[r][i]%>-htmode-view" : "cbi-wireless-<%=devs[r][i]%>-htmode",
            <% if uci:get('functionlist','functionlist','SUPPORT_WLAN_EXTENSION_CHANNEL') == '1' then --[[ #### EXTENSION_CHANNEL feature ### --]] %>
                "cbi-wireless-<%=devs[r][i]%>-ext_channel-view" : "cbi-wireless-<%=devs[r][i]%>-ext_channel",
            <% end --[[ #### EXTENSION_CHANNEL feature end ### --]]%>
			<% if uci:get('functionlist','functionlist','SUPPORT_WLAN_OUTDOOR_DISTANCE_ENV') == '1' then --[[ #### OUTDOOR_DISTANCE_ENV feature ### --]] %>
                <% if uci:get('sysProductInfo','model','outdoor') == '1' then %>
                    "cbi-wireless-<%=devs[r][i]%>-distance-env-view" : "cbi-wireless-<%=devs[r][i]%>-distance_env",
                <% end %>
            <% end --[[ #### OUTDOOR_DISTANCE_ENV feature end ### --]]%>
            <% if uci:get('functionlist','functionlist','SUPPORT_WLAN_OUTDOOR_DISTANCE') == '1' then --[[ #### OUTDOOR_DISTANCE feature ### --]] %>
                <% if uci:get('sysProductInfo','model','outdoor') == '1' then %>
                    "cbi-wireless-<%=devs[r][i]%>-distance-view" : "cbi-wireless-<%=devs[r][i]%>-distance",
                <% end %>
            <% end --[[ #### OUTDOOR_DISTANCE feature end ### --]]%>
            <% if uci:get('functionlist','functionlist','SUPPORT_ENJET') == '1' then %>
                "cbi-wireless-<%=devs[r][i]%>-qboost-enable-view" : "cbi-wireless-<%=devs[r][i]%>-qboost_enable",
                "cbi-wireless-<%=devs[r][i]%>-aptimeslot-view" : "cbi-wireless-<%=devs[r][i]%>-aptimeslot",
                "cbi-wireless-<%=devs[r][i]%>-stationpriority-view" : "cbi-wireless-<%=devs[r][i]%>-stationpriority",
            <% end %>
                "cbi-wireless-<%=devs[r][i]%>-channel-view" : "cbi-wireless-<%=devs[r][i]%>-channel",
                "cbi-wireless-<%=devs[r][i]%>-txpower-view" : "cbi-wireless-<%=devs[r][i]%>-txpower",
                "cbi-wireless-<%=devs[r][i]%>-rate-view" : "cbi-wireless-<%=devs[r][i]%>-rate",
                "cbi-wireless-<%=devs[r][i]%>-rts-view" : "cbi-wireless-<%=devs[r][i]%>-rts",
                "cbi-wireless-<%=devs[r][i]%>-clientlimits_number-view" : "cbi-wireless-<%=devs[r][i]%>-clientlimits_number",
                "cbi-wireless-<%=devs[r][i]%>-clientlimits_enable-view" : "cbi-wireless-<%=devs[r][i]%>-clientlimits_enable",
                "cbi-wireless-<%=devs[r][i]%>-aggregation_enable-view" : "cbi-wireless-<%=devs[r][i]%>-aggregation_enable",
                "cbi-wireless-<%=devs[r][i]%>-aggregation_frame-view" : "cbi-wireless-<%=devs[r][i]%>-aggregation_frame",
                "cbi-wireless-<%=devs[r][i]%>-aggregation_byte-view" : "cbi-wireless-<%=devs[r][i]%>-aggregation_byte",
                "cbi-wireless-<%=devs[r][i]%>-obeyregpower-view" : "cbi-wireless-<%=devs[r][i]%>-obeyregpower"
        }
        <% end %>
    <% end %>
    var layoutTableIface={};

    var rtsTable={
            "wifi2":[],
            "wifi1":[],
            "wifi0":[]
        }
<%
    for _, dev in ipairs(devices) do
        local dev_name = dev:name()
        for n = 1 ,#opmode_type do
            local opmode = opmode_type[n]
            if opmode == "ap" then
                subnets=wifi_all_net[dev_name]["ap"] or {}
            elseif opmode == "sta" then
                subnets=wifi_all_net[dev_name]["sta"] or {}
            elseif opmode == "wds_ap" then
                subnets=wifi_all_net[dev_name]["wds_ap"] or {}
            elseif opmode == "wds_sta" then
                subnets=wifi_all_net[dev_name]["wds_sta"] or {}
            elseif opmode == "wds_bridge" then 
                subnets=wifi_all_net[dev_name]["wds_bridge"] or {}
            elseif opmode == "sta_ap" then 
                subnets=wifi_all_net[dev_name]["sta_ap_sta"]or {}
            else
                subnets={}
            end        
            
            if #subnets > 0 then 
                for i, net in ipairs(subnets) do
%>                             
                    var iface_name =  '<%=net:name()%>';
                    if(iface_name.indexOf("guest")>-1){
                        guest_name_Table['<%=dev:name()%>']= iface_name;
                        guest_netid_Table['<%=dev:name()%>'] = '<%=net:id()%>' ;
                    }
                    else{
                        ifaceTable['<%=dev:name()%>']['<%=opmode_type[n]%>'].push(iface_name);
                        iface_netid_Table['<%=dev:name()%>']['<%=opmode_type[n]%>'].push('<%=net:id()%>');
                    }
<%              
                end
            end
        end
    end

local net
%>

function sync_greenmode(flag){
    if ($('input[type="checkbox"][name="cbid.wireless.wifi0.obeyregpower"]').checked!=flag)
    {
        $('input[type="checkbox"][name="cbid.wireless.wifi0.obeyregpower"]').prop("checked",flag);

    }
    if ($('input[type="checkbox"][name="cbid.wireless.wifi1.obeyregpower"]').checked!=flag)
    {
        $('input[type="checkbox"][name="cbid.wireless.wifi1.obeyregpower"]').prop("checked",flag);

    }
    <% if WLAN5G_2=="1" then %>
    if ($('input[type="checkbox"][name="cbid.wireless.wifi2.obeyregpower"]').checked!=flag)
    {
        $('input[type="checkbox"][name="cbid.wireless.wifi2.obeyregpower"]').prop("checked",flag);

    }
    <% end %>
}

function dominCountryRule(){
    if(reg_domain == "0" || reg_domain == "2"){
        if (functionlist.SUPPORT_GREENMODE_SETTING == "1"){
            $('#green_mode_wifi0').show();
            $('#green_mode_wifi1').show();
<% if WLAN5G_2=="1" then --[[ #### WLAN5G_2 feature ### --]] %> 
            $('#green_mode_wifi2').show(); 
<% end --[[ #### WLAN5G_2 feature ### end --]] %>
        }
        if(reg_domain == "0"){  //FCC
            $('input[type="checkbox"][name$="obeyregpower"]').click(function(){
                sync_greenmode(this.checked);
                if ($('input[type="checkbox"][name$="wifi0.obeyregpower"]').is(':checked') || $('input[type="checkbox"][name$="wifi1.obeyregpower"]').is(':checked')<% if WLAN5G_2=="1" then %> || $('input[type="checkbox"][name$="wifi2.obeyregpower"]').is(':checked')<% end %>){
                    if ( support_myid != "1" )
                    {
                        $('select[name="cbid.wireless.wifi0.country"]').attr("disabled",true);
                    }
                }
                else{
                    $('select[name="cbid.wireless.wifi0.country"]').attr("disabled",false);
                }
            });
            if ($("input:hidden[name='cbid.wireless.wifi0.country']").length==0)
            {   /* for record countrycode in fcc */
                $("form[name='cbi']").append('<input type="hidden" name="cbid.wireless.wifi0.country">');
            }
            $("select[name='cbid.wireless.wifi0.country']").change(function(){
                $("input[name='cbid.wireless.wifi0.country']").val($(this).val());
            })
        }
        else{                   //INT
			var hide_table={}
            $('input[type="checkbox"][name$="obeyregpower"]').click(function(){
                sync_greenmode(this.checked);
				hide_table={"831":"United Kingdom A","829":"United Kingdom B"};
	<% if uci:get('sysProductInfo','model','outdoor') == '1' then %>
        <% if WLAN24G ~= "1" then %>
            hide_table={"831":"United Kingdom A","829":"United Kingdom B","504":"Morocco"};
        <% else %>
            hide_table={"831":"United Kingdom A","829":"United Kingdom B"};
        <% end %>
	<% end %>
                if ($('input[type="checkbox"][name$="wifi0.obeyregpower"]').is(':checked')<% if WLAN5G=="1" then %> || $('input[type="checkbox"][name$="wifi1.obeyregpower"]').is(':checked')<% end %><% if WLAN5G_2=="1" then %> || $('input[type="checkbox"][name$="wifi2.obeyregpower"]').is(':checked')<% end %>){
    				for (var key in hide_table) {
    					var obj = hide_table[key];
    					hide_option("wifi0.country", key, "hide");
    				}
    			}
    			else{
    				for (var key in hide_table) {
    					var obj = hide_table[key];
    					hide_option("wifi0.country", key, "show");
    				}
    			}
			});
        }
    }
    else if(reg_domain == "1"){   //ETSI
        if (functionlist.SUPPORT_GREENMODE_SETTING == "1"){
            $('#green_mode_wifi0').hide();
            $('#green_mode_wifi1').hide();
<% if WLAN5G_2=="1" then --[[ #### WLAN5G_2 feature ### --]] %>
            $('#green_mode_wifi2').hide();
<% end --[[ #### WLAN5G_2 feature ### end --]] %>
        }
		$('input[type="checkbox"][name$="obeyregpower"]').click(function(){
            sync_greenmode(this.checked);
			if ($('input[type="checkbox"][name$="wifi0.obeyregpower"]').is(':checked')<% if WLAN5G=="1" then %> || $('input[type="checkbox"][name$="wifi1.obeyregpower"]').is(':checked')<% end %><% if WLAN5G_2=="1" then %> || $('input[type="checkbox"][name$="wifi2.obeyregpower"]').is(':checked')<% end %>){
<% if uci:get('sysProductInfo','model','outdoor') == '1' then %>
    <% if uci:get('sysProductInfo','model','etsiDfsCertified') == '0' then %>
					hide_option("wifi0.country", "643", "hide");
    <% end %>
<% end %>
				hide_option("wifi0.country", "829", "hide");
                hide_option("wifi0.country", "831", "hide");
        }
			else{
<% if uci:get('sysProductInfo','model','outdoor') == '1' then %>
    <% if uci:get('sysProductInfo','model','etsiDfsCertified') == '0' then %>
					hide_option("wifi0.country", "643", "show");
    <% end %>
<% end %>
				hide_option("wifi0.country", "829", "show");
                hide_option("wifi0.country", "831", "show");
			}
		});
	}
}
function SettingRule(dev_name){
    var conf_txpower={"wifi0":<%=luci.sys.exec("uci get wireless.wifi0.txpower")%>,"wifi1":<%=luci.sys.exec("uci get wireless.wifi1.txpower")%><% if WLAN5G_2=="1" then %>,"wifi2":<%=luci.sys.exec("uci get wireless.wifi2.txpower")%><% end %>}
    /* Common Rule */
    $('select[name="cbid.wireless.'+dev_name+'.opmode"]').change(function(){
        <% if uci:get('functionlist','functionlist','SUPPORT_ENJET') == '1' then %>
        if($('input[type="radio"][name="cbid.wireless.wifi1.qboost_enable"]:checked').val() == 1 )
        {
            $('select[name="cbid.wireless.'+dev_name+'.aptimeslot"]').attr("disabled",($(this).val()=='sta'||$(this).val()=='wds_sta')?true:false);
            $('select[name="cbid.wireless.'+dev_name+'.stationpriority"]').attr("disabled",($(this).val()=='wds_ap'||$(this).val()=='ap')?true:false);
        }
        <% end %>
      <% if uci:get('functionlist','functionlist','HWMODE_AX') ~= '1' then %>
        <% if uci:get('functionlist','functionlist','SUPPORT_MIN_RATE_SETTING') == "1" then %>
        $('select[name="cbid.wireless.'+dev_name+'.hwmode"]').attr("disabled",true);
        <% else %>
        $('select[name="cbid.wireless.'+dev_name+'.hwmode"]').attr("disabled",($(this).val()=='sta'||$(this).val()=='sta_ap'||$(this).val()=='wds_sta')?true:false);
        <% end %>
      <% end %>
        $('select[name="cbid.wireless.'+dev_name+'.htmode"]').attr("disabled",($(this).val()=='sta'||$(this).val()=='sta_ap'||$(this).val()=='wds_sta')?true:false);
        $('select[name="cbid.wireless.'+dev_name+'.channel"]').attr("disabled",($(this).val()=='sta'||$(this).val()=='sta_ap'||$(this).val()=='wds_sta')?true:false);
        <% if (WLAN24G=="1" and WLAN5G~="1" and WLAN5G_2~="1") or (WLAN24G~="1" and WLAN5G=="1" and WLAN5G_2~="1") then --[[ ### Single Band feature ### --]] %>
            if ($('select[name="cbid.wireless.'+dev_name+'.opmode"]').val()=='sta'||$('select[name="cbid.wireless.'+dev_name+'.opmode"]').val()=='sta_ap'||$('select[name="cbid.wireless.'+dev_name+'.opmode"]').val()=='wds_sta'){
                $('[name="cbid.wireless.wifi0.wifi_channel"]').attr("class","cbi-input-button").attr("disabled",true);
            }
            else{
                $('[name="cbid.wireless.wifi0.wifi_channel"]').attr("class","cbi-button cbi-input-button").attr("disabled",false);
            }
        <% end --[[ ### Single Band feature ### end--]] %>
        $('select[name="cbid.wireless.'+dev_name+'.txpower"]').attr("disabled",($(this).val()=='sta'||$(this).val()=='sta_ap'||$(this).val()=='wds_sta')?true:false);
        if(document.getElementsByName('cbid.wireless.'+dev_name+'.clientlimits_enable')[0].checked)
            $('input[name="cbid.wireless.'+dev_name+'.clientlimits_number"]').attr("disabled",($(this).val()=='sta'||$(this).val()=='sta_ap'||$(this).val()=='wds_sta'||$(this).val()=='wds_bridge'<% if uci:get('functionlist','functionlist','SUPPORT_ENJET') == '1' then %>||$('input[type="radio"][name="cbid.wireless.wifi1.qboost_enable"]:checked').val() == 1<% end %>)?true:false);
        $('input[name="cbid.wireless.'+dev_name+'.clientlimits_enable"]').attr("disabled",($(this).val()=='sta'||$(this).val()=='sta_ap'||$(this).val()=='wds_sta'||$(this).val()=='wds_bridge'<% if uci:get('functionlist','functionlist','SUPPORT_ENJET') == '1' then %>||$('input[type="radio"][name="cbid.wireless.wifi1.qboost_enable"]:checked').val() == 1<% end %>)?true:false);
        $(':radio[name$="mcastenhance"]').attr("disabled",(
        <% if WLAN24G=="1" then %>($('select[name$="wifi0.opmode"]').val()=='sta'||$('select[name$="wifi0.opmode"]').val()=='wds_bridge')<% end %>
        <% if WLAN5G=="1" then %><% if WLAN24G=="1" then %> && <% end %> ($('select[name$="wifi1.opmode"]').val()=='sta'||$('select[name$="wifi1.opmode"]').val()=='wds_bridge')<% end %>
        <% if WLAN5G_2=="1" then %> && ($('select[name$="wifi2.opmode"]').val()=='sta'||$('select[name$="wifi2.opmode"]').val()=='wds_bridge')<% end %>
        )?true:false);
        $('input[type="checkbox"][name="cbid.wireless.'+dev_name+'.obeyregpower"]').triggerHandler('click');
    });
    $('input[type="checkbox"][name="cbid.wireless.'+dev_name+'.obeyregpower"]').click(function(){
        if ($('input[type="checkbox"][name="cbid.wireless.wifi0.obeyregpower"]').checked!=this.checked)
        {
            $('input[type="checkbox"][name="cbid.wireless.wifi0.obeyregpower"]').prop("checked",this.checked);
            $('select[name="cbid.wireless.wifi0.txpower"]').val(this.checked?"0":conf_txpower["wifi0"]);
            $('select[name="cbid.wireless.wifi0.txpower"]').attr("disabled",this.checked);
        }
        if ($('input[type="checkbox"][name="cbid.wireless.wifi1.obeyregpower"]').checked!=this.checked)
        {
            $('input[type="checkbox"][name="cbid.wireless.wifi1.obeyregpower"]').prop("checked",this.checked);
            $('select[name="cbid.wireless.wifi1.txpower"]').val(this.checked?"0":conf_txpower["wifi1"]);
            $('select[name="cbid.wireless.wifi1.txpower"]').attr("disabled",this.checked);
        }
        <% if WLAN5G_2=="1" then %>
        if ($('input[type="checkbox"][name="cbid.wireless.wifi2.obeyregpower"]').checked!=this.checked)
        {
            $('input[type="checkbox"][name="cbid.wireless.wifi2.obeyregpower"]').prop("checked",this.checked);
            $('select[name="cbid.wireless.wifi2.txpower"]').val(this.checked?"0":conf_txpower["wifi2"]);
            $('select[name="cbid.wireless.wifi2.txpower"]').attr("disabled",this.checked);
        }
        <% end %>
    });

    /* Individual Rule */
    switch(dev_name) {
        case "wifi0":
            $('input[name$=".wifi0.rts"]').val('<%=uci:get("wireless","wifi0","rts") or 2346 %>');
            $('input[type="checkbox"][name="cbid.wireless.wifi0.obeyregpower"]').click(function(){
                $('select[name="cbid.wireless.wifi0.txpower"]').val(this.checked?"0":<%=luci.sys.exec("uci get wireless.wifi0.txpower")%>);
                $('select[name="cbid.wireless.wifi0.txpower"]').attr("disabled",this.checked);
            });
            $('select[name="cbid.wireless.wifi0.opmode"]').change(function(){
                if(($(this).val()=='ap') || ($(this).val()=='wds_ap') || ($(this).val()=='wds_bridge'))
                {
                    $('select[name="cbid.wireless.wifi0.ext_channel"]').attr("disabled",$('select[name="cbid.wireless.wifi0.htmode"] option:selected').val()=='HT20'?true:false);
                }
                else
                    $('select[name="cbid.wireless.wifi0.ext_channel"]').attr("disabled",true);
                $('select[name="cbid.wireless.wifi0.rate"]').attr("disabled",($(this).val()=='sta'||$(this).val()=='sta_ap'||$(this).val()=='wds_sta')?true:false);
                if($(this).val()=='sta'||$(this).val()=='sta_ap'||$(this).val()=='wds_sta')
                    dataRate_handler.set("wifi0","Auto");
                if ($(this).val()=='sta'||$(this).val()=='sta_ap'||$(this).val()=='wds_sta')
                    $("td[name='wifi_aggregation']").find('input').filter(function(){$(this).attr("disabled",true)});
                else
                {
                    $("td[name='wifi_aggregation']").find('input').filter(function(){$(this).attr("disabled",false)});
                    $('select[name="cbid.wireless.wifi0.hwmode"]').triggerHandler('change');
                }
            });
            $('select[name="cbid.wireless.wifi0.hwmode"]').change(function(){
                if($(this).val()=='11ng'||$(this).val()=='11n'||$(this).val()=='11axg'){
                    var opmodeValue=$('select[name="cbid.wireless.'+dev_name+'.opmode"]').val();
                    $('select[name="cbid.wireless.wifi0.htmode"]').show();
                    $('select[name="cbid.wireless.wifi0.htmode"]').attr("disabled",(opmodeValue=='sta'||opmodeValue=='sta_ap'||opmodeValue=='wds_sta')?true:false);
                }
                else{
                    $('select[name="cbid.wireless.wifi0.htmode"]').hide();
                    $('select[name="cbid.wireless.wifi0.htmode"]').attr("disabled",true);
                }
                if($(this).val()=='11b'||$(this).val()=='11bg'||$(this).val()=='11g'){
                    $("td[name='wifi_aggregation']").find('input').filter(function(){$(this).attr("disabled",true)});
                }
                else{
                    $("td[name='wifi_aggregation']").find('input').filter(function(){$(this).attr("disabled",false)});
                    $('input[type="radio"][name="cbid.wireless.wifi0.aggregation_enable"]').triggerHandler('click');
                };
                //JAPAN support channel 14 only for 11b
                if($('select[name="cbid.wireless.wifi0.country"]').val() == '<%=JAPAN_COUNTRY_ID%>'){
                    if($(this).val() != '11b')
                        hide_option("wifi0.channel", "14", "hide");
                    else
                        hide_option("wifi0.channel", "14", "show");
                };
            });
<% if uci:get('functionlist','functionlist','SUPPORT_WLAN_EXTENSION_CHANNEL') == '1' then --[[ #### EXTENSION_CHANNEL feature ### --]] %>
            /*extension channel check rule*/
            $('select[name$="wifi0.hwmode"]').change(function(){
            ($(this).val()=='11ng') ? $('input[name$="'+dev_name+'.rts"]').attr("disabled","disabled") : $('input[name$="'+dev_name+'.rts"]').attr("disabled",false);
                if($(this).val()=='11ng'||$(this).val()=='11n'){
                    $('select[name$="wifi0.ext_channel"]').show();
                    if($('select[name$="wifi0.htmode"] option:selected').val()=="HT20"){
                        $('select[name$="wifi0.ext_channel"]').attr("disabled",true);
                    }else{
                        $('select[name$="wifi0.ext_channel"]').attr("disabled",false);
                    }
                    $('select[name$=".wifi0.ext_channel"]').triggerHandler("change");
                }
                else{
                    var channel_size = $('select[name$=".wifi0.channel"]').find('option').length-1;
                    if($('select[name$="wifi0.country"]').val() == '<%=JAPAN_COUNTRY_ID%>'){//handle japan
                        channel_size-=1;
                    }
                    for(var i=1;i<=channel_size;i++){
                        hide_option("wifi0.channel",i,"show");
                    }
                    $('select[name$="wifi0.ext_channel"]').hide();
                    $('select[name$="wifi0.ext_channel"]').attr("disabled",true);
                }
            });
            $('select[name$=".wifi0.htmode"]').change(function(){
                if($('select[name$="wifi0.ext_channel"]').is(":visible")){
                    if($(this).val()=='HT20'){
                        $('select[name$="wifi0.ext_channel"]').attr("disabled",true);
                    }
                    else{
                        $('select[name$="wifi0.ext_channel"]').attr("disabled",false);
                    }
                }
                $('select[name$=".wifi0.ext_channel"]').triggerHandler("change");
            });
            $('select[name$=".wifi0.ext_channel"]').change(function(){
                var channel_size = $('select[name$=".wifi0.channel"]').find('option').length;

                if($('select[name$="wifi0.opmode"]').val() == 'wds_ap' || $('select[name$="wifi0.opmode"]').val() == 'ap'){//handle auto channel
                    channel_size-=1;
                }

                if($('select[name$="wifi0.country"]').val() == '392'){//handle japan 392
                    channel_size-=1;
                }
                for(var i=1;i<=channel_size;i++){
                    hide_option("wifi0.channel",i,"show");
                }
                if(($('select[name$="wifi0.hwmode"]').val()=='11ng' || $('select[name$="wifi0.hwmode"]').val()=='11n') && $('select[name$="wifi0.htmode"] option:selected').val()!="HT20"){
                   if($(this).val()=='1'){//Lower Channel
                        for(var i=1;i<=4;i++){
                            hide_option("wifi0.channel",i,"hide");
                        }
                    }
                    else{//Upper Channel
                        for(var i=channel_size-3;i<=channel_size;i++){
                            hide_option("wifi0.channel",i,"hide");
                        }
                    }
                }
            });
<% end --[[ #### EXTENSION_CHANNEL feature ### end --]] %>
            $('input[type="radio"][name="cbid.wireless.wifi0.clientlimits_enable"]').click(function(){
                if ($(this).is(':enabled')){
                    $('input[name="cbid.wireless.wifi0.clientlimits_number"]').attr("disabled",$(this).val()==0?true:false);
                }
                else{
                    $('input[name="cbid.wireless.wifi0.clientlimits_number"]').attr("disabled",true);
                }
            });
            $('input[type="radio"][name="cbid.wireless.wifi0.aggregation_enable"]').click(function(){
                if($('input[type="radio"][name="cbid.wireless.wifi0.aggregation_enable"]:checked').val()==0||$(':radio[name$="wifi0.aggregation_enable"]').is(":disabled")){
                    $('input[name="cbid.wireless.wifi0.aggregation_frame"]').attr("disabled",true);
                    $('input[name="cbid.wireless.wifi0.aggregation_byte"]').attr("disabled",true);
                }
                else{
                    $('input[name="cbid.wireless.wifi0.aggregation_frame"]').attr("disabled",false);
                    $('input[name="cbid.wireless.wifi0.aggregation_byte"]').attr("disabled",false);
                }
            });
            $('select[name$="wifi0.channel"]').change(function(){
                channel_handler.val("wifi0",$(this).find('option:selected').val());
            });
            $('select[name$="wifi0.rate"]').change(function(){
                dataRate_handler.val("wifi0",$(this).find('option:selected').val());
            });
            $('select[name$="wifi0.hwmode"]').change(function(){
                channel_handler.set("wifi0",channel_handler.getVal("wifi0"));
                dataRate_handler.set("wifi0",dataRate_handler.getVal("wifi0"));
            });
            $('select[name$="wifi0.opmode"]').change(function(){
                channel_handler.set("wifi0",channel_handler.getVal("wifi0"));
            });
            break;
        case "wifi1":
        case "wifi2":
            var conf_rts = {"wifi1":'<%=uci:get("wireless","wifi1","rts") or 2346%>'<% if WLAN5G_2=="1" then %>,"wifi2":'<%=uci:get("wireless","wifi2","rts") or 2346%>'<% end %>};

            $('select[name="cbid.wireless.'+dev_name+'.opmode"]').change(function(){
                if($(this).val()=='sta'||$(this).val()=='sta_ap'||$(this).val()=='wds_sta')
                {
                    CBAction(dev_name);
                    /* sort data rate option */
                    sortRate(dev_name);
                }
                else
                {
                    if(document.getElementsByName('cbid.wireless.'+dev_name+'.hwmode')[0].value=='11ac'){
                        $('select[name="cbid.wireless.'+dev_name+'.rate"]').attr("disabled","disabled");
                        if($(':hidden[name="cbid.wireless.'+dev_name+'.rate"]').length==0){
                            $("form[name='cbi']").append('<input type="hidden" name="cbid.wireless.'+dev_name+'.rate" value="">');
                        };
                    }
                    else{
                        $('select[name="cbid.wireless.'+dev_name+'.rate"]').prop("disabled",false);
                        $(':hidden[name="cbid.wireless.'+dev_name+'.rate"]').remove();
                    }
                }
            });
            $('select[name="cbid.wireless.'+dev_name+'.hwmode"]').change(function(){
                if($(this).val()=='11a'){
                    $('select[name="cbid.wireless.'+dev_name+'.htmode"]').hide();
                    $('select[name="cbid.wireless.'+dev_name+'.htmode"]').attr("disabled",true);
                }
                else{
                    var opmodeValue=$('select[name="cbid.wireless.'+dev_name+'.opmode"]').val();
                    $('select[name="cbid.wireless.'+dev_name+'.htmode"]').show();
                    $('select[name="cbid.wireless.'+dev_name+'.htmode"]').attr("disabled",(opmodeValue=='sta'||opmodeValue=='sta_ap'||opmodeValue=='wds_sta')?true:false);
                }
                if($(this).val()=='11a'){
                    $("td[name='wifi_aggregation_"+dev_name+"']").find('input').filter(function(){$(this).attr("disabled",true)});
                }
                else{
                    $("td[name='wifi_aggregation_"+dev_name+"']").find('input').filter(function(){$(this).attr("disabled",false)});
                    $('input[type="radio"][name="cbid.wireless.'+dev_name+'.aggregation_enable"]').triggerHandler('click');
                };
                $('select[name$="'+dev_name+'.htmode"]').triggerHandler("change");
                ($(this).val()=='11ac') ? $('input[name$="'+dev_name+'.rts"]').attr("disabled","disabled") : $('input[name$="'+dev_name+'.rts"]').attr("disabled",false);
                if($(this).val()=='11ac'){
                    $('select[name="cbid.wireless.'+dev_name+'.rate"]').attr("disabled","disabled");
                    if($(':hidden[name="cbid.wireless.'+dev_name+'.rate"]').length==0){
                        $("form[name='cbi']").append('<input type="hidden" name="cbid.wireless.'+dev_name+'.rate" value="">');
                    };
                }
                else{
                    $('select[name="cbid.wireless.'+dev_name+'.rate"]').prop("disabled",false);
                    $(':hidden[name="cbid.wireless.'+dev_name+'.rate"]').remove();
                }
                if($('select[name="cbid.wireless.'+dev_name+'.opmode"]').val() =="sta")
                {
                    CBAction(dev_name);
                }
            });
<% if uci:get('functionlist','functionlist','SUPPORT_WLAN_EXTENSION_CHANNEL') == '1' then --[[ #### EXTENSION_CHANNEL feature ### --]] %>
            var channel_upper_extend_array_5g = ["36","44","52","60","100","108","116","124","132","140","149","157"];
            $('select[name$=".'+dev_name+'.channel"]').change(function(){
                $('select[name$="'+dev_name+'.ext_channel"]').val((jQuery.inArray($(this).val(), channel_upper_extend_array_5g)==-1?"1":"0"))
            });    
            $('select[name$=".'+dev_name+'.hwmode"]').change(function(){
                if($(this).val()=='11na'||$(this).val()=='11n'||$(this).val()=='11ac'){
                    $('select[name$="'+dev_name+'.ext_channel"]').show(); 
                    $('select[name$="'+dev_name+'.ext_channel"]').attr("disabled",true);
                }
                else{
                    $('select[name$="'+dev_name+'.ext_channel"]').hide(); 
                    $('select[name$="'+dev_name+'.ext_channel"]').attr("disabled",true);
                }
            });
<% end --[[ #### EXTENSION_CHANNEL feature ### end --]] %>
<% if uci:get('functionlist','functionlist','SUPPORT_ENJET') == '1' then %>
            $('input[type="radio"][name="cbid.wireless.'+dev_name+'.qboost_enable"]').click(function(){
                var mode_5G = $('select[name="cbid.wireless.'+dev_name+'.opmode"]').val();
                if($('input[type="radio"][name="cbid.wireless.wifi1.qboost_enable"]:checked').val() == 0 )
                {
                    $("#cbi-wireless-wifi0-opmode-wds_bridge").remove();
                    $("#cbi-wireless-wifi1-opmode-wds_bridge").remove();
                <% if uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_BRIDGE_MODE') == '0' or uci:get('functionlist','functionlist','NOT_SUPPORT_WDS_BRIDGE_MODE') == nil then %>
                    if ($("select[name='cbid.wireless.wifi0.opmode'] option[value='wds_bridge']").length==0)
                        $('select[name="cbid.wireless.wifi0.opmode"]').append('<option id="cbi-wireless-wifi0-opmode-wds_bridge" value="wds_bridge">WDS Bridge</option>');
                    if ($("select[name='cbid.wireless.wifi1.opmode'] option[value='wds_bridge']").length==0)
                        $('select[name="cbid.wireless.wifi1.opmode"]').append('<option id="cbi-wireless-wifi1-opmode-wds_bridge" value="wds_bridge">WDS Bridge</option>');
                <% end %>
                    if($("select[name$='wifi1.opmode']").val() == "ap"|| $("select[name$='wifi1.opmode']").val() == "wds_ap"){
                        $("#gn,#gn_ip").show();
                    }
                    $('select[name="cbid.wireless.wifi1.opmode"]').val(mode_5G);
                    $('select[name="cbid.wireless.wifi1.opmode"]').change();
                    $('select[name="cbid.wireless.'+dev_name+'.aptimeslot"]').attr("disabled",true);
                    $('select[name="cbid.wireless.'+dev_name+'.stationpriority"]').attr("disabled",true);
                }
                else
                {
                    if(mode_5G=="wds_bridge"){
                        $('select[name="cbid.wireless.wifi1.opmode"]').val('ap');
                    }
                    $('select[name="cbid.wireless.wifi0.opmode"]').change();
                    $('select[name="cbid.wireless.wifi1.opmode"]').change();
                    $("#cbi-wireless-wifi0-opmode-wds_bridge").remove();
                    $("#cbi-wireless-wifi1-opmode-wds_bridge").remove();
                    if(mode_5G =='sta' || mode_5G =='wds_sta'){
                        $('select[name="cbid.wireless.'+dev_name+'.aptimeslot"]').attr("disabled",true);
                        $('select[name="cbid.wireless.'+dev_name+'.stationpriority"]').attr("disabled",false);
                    }
                    else if(mode_5G =='wds_ap' || mode_5G =='ap'){
                        $('select[name="cbid.wireless.'+dev_name+'.aptimeslot"]').attr("disabled",false);
                        $('select[name="cbid.wireless.'+dev_name+'.stationpriority"]').attr("disabled",true);
                    }
                    $("#gn,#gn_ip").hide();
                }
            });
<% end %>
            $('input[type="radio"][name="cbid.wireless.'+dev_name+'.clientlimits_enable"]').click(function(){
                if ($(this).is(':enabled')){
                    $('input[name="cbid.wireless.'+dev_name+'.clientlimits_number"]').attr("disabled",$(this).val()==0?true:false);
                }
                else{
                    $('input[name="cbid.wireless.'+dev_name+'.clientlimits_number"]').attr("disabled",true);
                }
            });
            if($('input[type="radio"][name="cbid.wireless.'+dev_name+'.aggregation_enable"]').length>0){
                $('input[type="radio"][name="cbid.wireless.'+dev_name+'.aggregation_enable"]').click(function(){
                    if($('input[type="radio"][name="cbid.wireless.'+dev_name+'.aggregation_enable"]:checked').val()==0||$(':radio[name$="'+dev_name+'.aggregation_enable"]').is(":disabled")){
                        $('input[name="cbid.wireless.'+dev_name+'.aggregation_frame"]').attr("disabled",true);
                        $('input[name="cbid.wireless.'+dev_name+'.aggregation_byte"]').attr("disabled",true);
                    }
                    else{
                        $('input[name="cbid.wireless.'+dev_name+'.aggregation_frame"]').attr("disabled",false);
                        $('input[name="cbid.wireless.'+dev_name+'.aggregation_byte"]').attr("disabled",false);
                    }
                });
            }
            $('select[name$="'+dev_name+'.ext_channel"]').attr("disabled",true);
            $('select[name$="'+dev_name+'.channel"]').change(function(){
                channel_handler.val(dev_name,$(this).find('option:selected').val());
            });
            $('select[name$="'+dev_name+'.rate"]').change(function(){
                dataRate_handler.val(dev_name,$(this).find('option:selected').val());
            });
            $('select[name$="'+dev_name+'.hwmode"]').change(function(){
                channel_handler.set(dev_name,channel_handler.getVal(dev_name));
                dataRate_handler.set(dev_name,dataRate_handler.getVal(dev_name));
            });
            $('select[name$="'+dev_name+'.opmode"]').change(function(){
                channel_handler.set(dev_name,channel_handler.getVal(dev_name));
            });
            break;
        default:
            break;
    }

<%
if uci:get('functionlist','functionlist','SUPPORT_WLAN_OUTDOOR_DISTANCE') == '1' then -----#### SUPPORT_WLAN_OUTDOOR_DISTANCE START ###
    if uci:get('sysProductInfo','model','outdoor') == '1' then
%>  
        $(':text:visible:enabled[name$=".distance"]').each(function(){
            $(this).keyup(function(){
                // console.log($(this).val());
                var n = parseInt($(this).val(), 10);
                if(isNaN(n))
                    $(this).parent('div').parent('div').next('div').text(0);
                else
                    $(this).parent('div').parent('div').next('div').text(Math.round(n*0.6*1000) / 1000);
            }).triggerHandler('keyup');
        });
<%
    end
end-----####  SUPPORT_WLAN_OUTDOOR_DISTANCE END ####  
%> 

    $('select[name*="'+dev_name+'"]').each(function(){
        if($(this).attr("id").match('index_dummy')==null)
        {
            if($(this).find("option").length==0){
                $(this).hide();
                $(this).attr("disabled",true);
            }else{
                $(this).show();
                $(this).attr("disabled",false);
            }
        }
    });

    $("select[name='cbid.wireless."+dev_name+".hwmode']").change(function(){ 
        /* sort data rate option */
        sortRate(dev_name);
    })
    
} /* setting rule end */

function CBAction(dev_name)
{
    $('select[name="cbid.wireless.'+dev_name+'.rate"]').prop("disabled",true);
    $(':hidden[name="cbid.wireless.'+dev_name+'.rate"]').remove();
    dataRate_handler.set(dev_name,"Auto");
    $('input[name="cbid.wireless.'+dev_name+'.rts"]').attr("disabled",true);
    $('select[name="cbid.wireless.'+dev_name+'.htmode"]').prop("disabled",true);
}

function sortRate(dev_name)
{
    var my_options = $("select[name='cbid.wireless."+dev_name+".rate'] option");
    var selected = $("select[name='cbid.wireless."+dev_name+".rate']").val();
    my_options.sort(function(a,b) {     /* get index attribute */
        if (parseInt($(a).attr("index")) > parseInt($(b).attr("index"))) return 1;
        if (parseInt($(a).attr("index")) < parseInt($(b).attr("index"))) return -1;
        return 0
    })
    $("select[name='cbid.wireless."+dev_name+".rate']").empty().append( my_options );
    $("select[name='cbid.wireless."+dev_name+".rate']").val(selected);
}

function bindFuncInterface(layoutTable)
{
    for(var i in layoutTable)
    {
        switch(layoutTable[i].split("-")[3])
        {
            case 'disabled': 
                // if(layoutTable[i].indexOf("disabled") > -1){
                var boxName = layoutTable[i].replace("cbi","cbid").replace(/-/g,".");
                var trName = boxName.split(".")[2];
                var this_disabled;
                <% if WLAN24G == '1' then %>
                var this_24g = $(':checkbox[name="'+boxName.replace("cbid.","").replace("wifix","wifi0")+'"]');
                <% end %>
                <% if WLAN5G == '1' then %>
                var this_5g = $(':checkbox[name="'+boxName.replace("cbid.","").replace("wifix","wifi1")+'"]');
                <% if WLAN5G_2 == '1' then %>
                var this_52g = $(':checkbox[name="'+boxName.replace("cbid.","").replace("wifix","wifi2")+'"]');
                <% end %>
                <% end %>

                var this_guest_network = $(':checkbox[name="'+"cbid.wireless."+trName+".guest_network"+'"]');

                this_disabled = $('input[type="checkbox"][name="'+ boxName+'"]').bind('click',{trName:trName},
                    function disableHandler(event) {
                        var this_checked = this.checked;
                        $('#'+event.data.trName).find(":text,:checkbox,:button").not( $( this )).attr("disabled",!this.checked);
                        <% if WLAN24G == '1' then %>
                        this_24g.attr("disabled",!this_checked || $('select[name$="wifi0.opmode"]').val()!="ap");
                        <% end %>
                        <% if WLAN5G == '1' then %>
                        this_5g.attr("disabled",!this_checked || $('select[name$="wifi1.opmode"]').val()!="ap");
                        <% if WLAN5G_2 == '1' then %>
                        this_52g.attr("disabled",!this_checked || $('select[name$="wifi2.opmode"]').val()!="ap");
                        <% end %>
                        <% end %>
                        gn_ip.checkEnable();
                        checkPureN();
                        <% if WLAN24G == '1' and WLAN5G ~= '1' then %>
                            this_24g.attr("checked",this.checked).trigger('click');
                        <% end %>
                        <% if WLAN5G == '1' and WLAN24G ~= '1' then %>
                            this_5g.attr("checked",this.checked).trigger('click');
                        <% end %>
                        <% if WLAN24G == '1' and WLAN5G == '1' then %>
                            if($('select[name="cbid.wireless.wifi0.country"]').val() == "831" || $('select[name="cbid.wireless.wifi0.country"]').val() == "829")
                            {
                                this_24g.attr("disabled", true);
                            }
                        <% end %>
                        <% if uci:get('functionlist','functionlist','SUPPORT_MANAGEMENT_SSID') == '1' then %>
                            if(($('input[type="checkbox"][name="cbid.wireless.wifix_ssid_management_1.disabled"]').is(':checked'))){
                                $(':radio[name$="livetime"]').attr("disabled",false);
                            }
                            else{
                                $(':radio[name$="livetime"]').attr("disabled",true);
                            }
                        <% end %>
                    }
                );
                /*handle gn_ip*/
                if(layoutTable[i].indexOf("guest") > -1)
                {
                    $('input[type="checkbox"][name="'+ boxName+'"]').bind('click',gn_ip.checkEnable);
                }

                this_disabled.triggerHandler('click');
                break;

<% if uci:get('functionlist','functionlist','SUPPORT_GUEST_NETWORK_BY_SSID') == '1' then --[[ #### SUPPORT_GUEST_NETWORK_BY_SSID START ### --]] %>
            case 'guest_network':
                var boxName = layoutTable[i].replace("cbi","cbid").replace(/-/g,".");
                var trName = boxName.split(".")[2];
                var this_vlan_id = $('div[name="'+"cbid.wireless."+trName+".vlan_id"+'"]');
                
                $('input[type="checkbox"][name="'+ boxName+'"]').bind('click',{trName:trName},function disableHandler(event) {
                    var j = trName.substr(-1);
                    var vlan_id, isolation, index;

                    <% for i=1,8 do %>
                        if (j == "<%=i%>")
                        {
                            vlan_id = '<%=uci:get("wireless","wifi0_ssid_"..i,"vlan_id")%>';
                            index = '<%=i%>'-1;
                        }
                    <%end%>

                    if(!this.checked && tmp_vlanid[index] != "-1")
                    {
                        if(tmp_vlanid[index] == "0")
                        {
                            this_vlan_id.text(vlan_id);
                        }
                        else
                        {
                            this_vlan_id.text(tmp_vlanid[index]);
                        }
                    }
                    else
                    {
                        this_vlan_id.text("-");
                    }
                });
            break;
<% end %>
        }

    }
}

function rematch(layoutTable){
	/*match cbi to view*/   
	for(var i in layoutTable){
        $("#"+layoutTable[i]).removeClass();
        $("#"+layoutTable[i]).replaceAll($("#"+i));
        /*remove label text*/
        $('label[for=\"'+layoutTable[i].replace("cbi","cbid").replace(/-/g,".")+'\"]').remove();
        /*remove original format*/ 
        $("#"+layoutTable[i]+">div").removeClass("cbi-value-field");

        $("#"+layoutTable[i]+" input:text").each(function(){           
           var name = $(this).attr('id')||$(this).attr('name');
            if(name.indexOf("ssid") > -1||name.indexOf("SystemName") > -1||name.indexOf("guest") > -1)
                 $(this).css('width',"200px");
            else             
                $(this).css('width',"60px");
        });

        $("#"+layoutTable[i]+" select").css('width',"150px");

    }
}
    
var myTable = (function() {
    
    var titleTable={
<% if uci:get('functionlist','functionlist','SUPPORT_ENJET') == '1' then %>
    "wifi1_tdma":"<%:Wireless Settings%>" + " - <%:Access Point%>",
<% end %>
<% if uci:get('functionlist','functionlist','SUPPORT_MANAGEMENT_SSID') == '1' then %>
    <% if uci:get('functionlist','vendorlist','MANAGEMENT_SUPPORT_RADIO') == '1' then %>
    "wifix_management":"<%:Management Interface%> - 2.4G",
    <% elseif uci:get('functionlist','vendorlist','MANAGEMENT_SUPPORT_RADIO') == '2' then %>
    "wifix_management":"<%:Management Interface%> - 5G",
    <% end %>
<% end %>
        "wifix":"<%:Wireless Settings%>" + " - <%:Access Point%>",
<% if WLAN24G == '1' then %>
    "wifi0":"<%:Wireless Settings - 2.4GHz%>",
<% end %>
<% if WLAN5G == '1' then %>
    <% if WLAN5G_2 == '1' then --[[ #### WLAN5G_2 feature ### --]] %>
        "wifi1":"<%:Wireless Settings - 5GHz-1%>",
        "wifi2":"<%:Wireless Settings - 5GHz-2%>",
    <% else %>
        "wifi1":"<%:Wireless Settings - 5GHz%>",
    <% end --[[ #### WLAN5G_2 feature ### end --]] %>
<% end %>
    "gn" : "<%:Guest Network Settings%>"
    }, 
    newTable = function (data,div_id,table_id){
        var $table = $(document.createElement('table'));
        $table.attr("id",table_id);
        $table.addClass("ecm-tbl");
        $table.appendTo($("#"+div_id));
        for(var i in data){
            for(var j in data[i]){
                 newTr(data[i],table_id,table_id+"_"+i);
            }
        }
        if(div_id=="gn")
            newElement(table_id,'<tr><th colspan="'+iface_field_view.length+'" class="title">'+titleTable[div_id]+'<img class="popper" data-popbox="Guest_Network_Settings_info" src="<%=media%>/pictures/icon_info_blue.png"></th></tr>');
        else if(div_id=='wifix_management')
            newElement(table_id,'<tr><th colspan="'+iface_field_view.length+'" class="title">'+titleTable[div_id]+'<img class="popper" data-popbox="management_interface_info" src="<%=media%>/pictures/icon_info_blue.png"></th></tr>');
        else
            newElement(table_id,'<tr><th colspan="'+iface_field_view.length+'" class="title">'+titleTable[div_id]+'</th></tr>');
    },
    newTr = function(data,table_id,tr_id){
        var $tr = $(document.createElement('tr'));
        $tr.attr("id",tr_id);
        $tr.appendTo($("#"+table_id));
        for(var i in data){
            newTd(data[i],tr_id,tr_id+"_"+i);

            if(data[i]=="<%:Client Isolation%>")
            {
                newElement(tr_id+"_"+i,'<img class="popper" data-popbox="Client_Isolation_info" src="<%=media%>/pictures/icon_info_blue.png">');
            }
            if(data[i]=="<%:VLAN Isolation%>")
            {
                newElement(tr_id+"_"+i,'<img class="popper" data-popbox="VLAN_Isolation_info" src="<%=media%>/pictures/icon_info_blue.png">');
            }
        }
    },
    newTd = function(data,tr_id,td_id){
        var $td = $(document.createElement('td'));
        $td.attr("id",td_id);
        //$td.addClass((tr_id.indexOf("_name")>-1)?"tbl-grey":"tbl-value");
        $td.addClass((tr_id.indexOf("_name")>-1)?"tbl-grey":"tbl-value");

        if ( data == "<%:SSID%>" || data == "<%:Edit%>" )
        {
            $td.css("padding-left","15px");
        }
        if ( data == "<%:SSID%>")
        {
            $td.width('25%');
            $td.css("padding-right","200px");
        }
        else{
            $td.width('15%');
        }

        $td.appendTo($("#"+tr_id));
        $td.text(data);
        //(typeof data!="string" && data)?$td.text(data):newDiv(data,tr_id);  
    },
    newDiv = function(data,td_id){
        var $div = $(document.createElement('div'));
        $div.attr("id",data);
        $div.appendTo($("#"+td_id));
    },
    newElement = function(container_id,element){
        if(container_id.split("encryption_view").length > 1)
        {
          $("#" + container_id).append(showEncryption(element));
        }
        else
        {
          $("#" + container_id).append(element);
        }
    };
    
return{
        newTable : newTable,
        newTr : newTr,
        newTd : newTd,
        newDiv : newDiv,
        newElement : newElement
    };
}());  

var guest_change_handle = "";
var ssid_disabled_check = "";

var checkRule= (function(){
    var checkResult = true,
    statrtCheck = function(i){
        $(':text:enabled:visible').each(function(){
            if ($(this).attr('name')){
                if (!$(this).attr('name').match(".ssid"))
                    $(this).val($(this).val().trim());
            }
        });
<% if uci:get('functionlist','functionlist','SUPPORT_WDS_MODE_REBOOT') == "1" then %>
    var old_wifi0_opmode = "<%=uci:get('wireless','wifi0','opmode')%>";
    var new_wifi0_opmode = $("select[name$='wifi0.opmode']").val() ;

    var old_wifi1_opmode = "<%=uci:get('wireless','wifi1','opmode')%>";
    var new_wifi1_opmode = $("select[name$='wifi1.opmode']").val() ;

    var wifi0_change = 0, wifi1_change=0;

    if(old_wifi0_opmode!=new_wifi0_opmode)
        wifi0_change = 1;
    else if(old_wifi1_opmode!=new_wifi1_opmode)
        wifi1_change = 1;

    if(wifi0_change)
    {
        if(old_wifi0_opmode=="ap" || old_wifi0_opmode=="sta")
        {
            if(new_wifi0_opmode=="wds_ap" || new_wifi0_opmode=="wds_bridge" || new_wifi0_opmode=="wds_sta")
            {
                reboot();
            }
        }
        else if(old_wifi0_opmode=="wds_ap" || old_wifi0_opmode=="wds_bridge" || old_wifi0_opmode=="wds_sta")
        {
            reboot();
        }
    }
    else if (wifi1_change)
    {
        if(old_wifi1_opmode=="ap" || old_wifi1_opmode=="sta")
        {
            if(new_wifi1_opmode=="wds_ap" || new_wifi1_opmode=="wds_bridge" || new_wifi1_opmode=="wds_sta")
            {
                reboot();
            }
        }
        else if(old_wifi1_opmode=="wds_ap" || old_wifi1_opmode=="wds_bridge" || old_wifi1_opmode=="wds_sta")
        {
            reboot();
        }
    }
<% end %>
<% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_MODE_REBOOT') == "1" then %>
    var old_wifi0_opmode = "<%=uci:get('wireless','wifi0','opmode')%>";
    var new_wifi0_opmode = $("select[name$='wifi0.opmode']").val() ;

    var old_wifi1_opmode = "<%=uci:get('wireless','wifi1','opmode')%>";
    var new_wifi1_opmode = $("select[name$='wifi1.opmode']").val() ;

    if(old_wifi0_opmode!=new_wifi0_opmode)
    {
        if(old_wifi0_opmode=="sta_ap" || new_wifi0_opmode=="sta_ap")
        {
            reboot();
        }
    }
    else if(old_wifi1_opmode!=new_wifi1_opmode)
    {
        if(old_wifi1_opmode=="sta_ap" || new_wifi1_opmode=="sta_ap")
        {
            reboot();
        }
    }
<% end %>
<% if uci:get('functionlist','functionlist','SUPPORT_MESH_SETTING') == "1" then %>
        if(vlan_Setting() && wds_link_check() && text_check() && guest_setting() && non_dfs() && ssid_disabled_check())
<% else %>
		if(vlan_Setting() && wds_link_check() && text_check() && guest_setting() && ssid_disabled_check())
<% end %>
        {
<%if uci:get('functionlist','functionlist','HAS_ALL_APPLY') ~= '1' then  %>
            is_form_submit = "1";
<%end%>
            var obeyDiff_wifi0=false, obeyDiff_wifi1=false, obeyDiff_wifi2=false;
            <% for _, r in pairs({"2.4G","5G"}) do %>
                <% for i=1,#devs[r] do %>
                    obeyDiff_<%=devs[r][i]%> = green_<%=devs[r][i]%>^$(':checkbox:checked[name$="<%=devs[r][i]%>.obeyregpower"]').prop('checked');
                <% end %>
            <% end %>
            if(obeyDiff_wifi0 || obeyDiff_wifi1 || obeyDiff_wifi2){

            $("input[name='greenmode']").val("1");
                if (functionlist.SUPPORT_GREENMODE_SETTING == "1"){
                    alert("<%:Green mode is changed, system will reload.%>");
                }
            }
            $('#submitType').val(i);

            var autoch_url = '<%=luci.dispatcher.build_url("admin/network/wifi_Channel")%>';
            var autoch_data = {};
            $('form[name="wifiChannel"] input').each(function(){
                autoch_data[$(this).attr("name")]=$(this).val();
            });
            $.ajax({
                async: false,
                type : "POST",
                url:autoch_url,
                data:autoch_data,
                dataType:"json",
                error:function(){
                    //console.log("wifi_Channel error");
                },
                success:function(result){
                    //console.log("wifi_Channel success");
                }
            });
            $("form[name='cbi']").append(guest_change_handle);
            $("form[name='cbi']").append(ssid_disabled_check);
			$('form[name="cbi"]').submit();
		}
		return false;
    },
    reboot = function(){
        $.ajax({
            url: "<%=luci.dispatcher.build_url('admin/network/ajax_notice_reboot')%>",
            data:"",
            success: function(re) {
                //console.log(re);
                //alert(re);
            },
        });
    },
    non_dfs = function(){
        var band2_3 = ["52","56","60","64","100","104","108","112","116","120","124","128","132","136","140"];    
        if( "<%=uci:get('mesh','wifi','disabled')%>" == "0" && "<%=uci:get('wireless','wifi1_mesh','disabled')%>" == "0" )
        {
            for (i=0;i<band2_3.length;i++)
            {
                if (document.getElementById('cbid.wireless.wifi1.channel').value == band2_3[i])
                {
                    alert("<%:5GHz channel must be non-DFS channel when mesh enabled in 5GHz%>");
                    return false;
                }
            }
        }
        return true;
    },
    wds_link_check = function(){
        var flag = true;
        $('input:text:enabled[name$="wlanwdswepkey"]').each(function(){
            var ifname = $(this).attr("name").split(".")[2];
            var key_index = $('select[name$="'+ifname+'.index_dummy"]').val();
            var reg,errmsg = "<%:WEP key: only hex digits allowed [0-9, a-f, A-F],%d digits%>";

            switch(key_index){
                case '10' :
                    // reg = /^([0-9a-fA-F]{10})$|^([\w]{5})$/ ;
                    reg = /^([0-9a-fA-F]{10})$/ ;
                    break;
                case '26' :
                    // reg = /^([0-9a-fA-F]{26})$|^([\w]{13})$/ ;
                    reg = /^([0-9a-fA-F]{26})$/ ;
                    break;
                case '32' : 
                    // reg = /^([0-9a-fA-F]{32})$|^([\w]{16})$/ ;
                    reg = /^([0-9a-fA-F]{32})$/ ;
                    break;
            }

           if(reg.test($(this).val())==false){
                alert(String.format(errmsg, key_index));
                flag = false;
                return false;
           }
        });

       $('input:text:enabled[name$=".key"]').each(function(){
            var ifname = $(this).attr("name").split(".")[2];
            var errmsg = "<%:AES passphrase: only hex 64 digits allowed [0-9, a-f, A-F] or 8-63 ASCII characters%>";
            var reg = /^([0-9a-fA-F]{64})$|^(.{8,63})$/ ;

            if(reg.test($(this).val())==false){
                alert(errmsg);
                flag = false;
                return false;
            }

        });

        $('table:visible[id$="macfilter"]').each(function(){
            // var reg  = /^([0-9A-F]{2}[:-]){5}([0-9A-F]{2})$/ ;
            var reg = /^([0-9A-F][0,2,4,6,8,A,C,E][:-])([0-9A-F]{2}[:-]){4}([0-9A-F]{2})$/;
            var macStr="", macVal;
            var errmsg = "<%:Wrong MAC address!%>";
            var mac_array= [];
            var maclist={},this_macfilter,max_size = <%=MAX_WLAN_MAC_FILTER_NUMBER%>
            maclist.dut_mac = [];
        <%
            local dut_mac = luci.util.split(luci.util.exec("ifconfig | grep HWaddr | awk '{print $1}'"))
            for n = 1 ,#dut_mac do
        %>
            maclist.dut_mac.push('<%=ntm:get_mac(dut_mac[n])%>');
        <%
            end
        %>
            // var ifname = $(this).attr("id").replace("_macfilter","");
            $(this).find("input:enabled , select").each(function(){
                var type = this.type ? this.type : this.nodeName.toLowerCase();   
                if(type == "text"){
                     macVal = $(this).val().toUpperCase();
                     macStr+=macStr==""?macVal:":"+macVal;
                }else{
                    if((macStr!=""&&reg.test(macStr.toUpperCase())==false)||macStr=="00:00:00:00:00:00"){
                        flag = false;
                         alert(errmsg+"   "+macStr);
                         $(this).focus();
                        return false
                    }
                    //duplicate mac check
                    if(jQuery.inArray(macStr, mac_array)>-1){
                            flag = false;
                            alert("<%:Duplicate MAC%> "+macStr.toUpperCase());
                            $(this).focus();
                            return false                             
                    }else if(jQuery.inArray(macStr, maclist.dut_mac)>-1){
                            flag = false;
                            alert("<%:Duplicate LAN MAC address%>");
                            $(this).focus();
                            return false
                    }else{
                        if(macStr!=""){
                            mac_array.push(macStr);
                        }
                        
                    }
                    macStr="";
                }
            })
            $(this).find("input:disabled , select").each(function(){
                var type = this.type ? this.type : this.nodeName.toLowerCase();   
                if(type == "text"){
                     macVal = $(this).val().toUpperCase();
                     if ( macVal=="  " )
                     {
                        macVal="";
                        $(this).val("");
                    }
                     macStr+=macStr==""?macVal:":"+macVal;
                }else{
                    if( this.value == "x" && (macStr!=""&&macStr.length!=17)){ // check mac if select value is disable
                        flag = false;
                        alert(errmsg+"   "+macStr);
                        return false;
                    }
                    macStr="";
                }
            })
        });

        if(!flag)
            return false;

        return true;
    },
     vlan_Setting = function(){
        var has_isolation='0',has_isolation_for_lacp="0";
        var invalid_id='0',invalid_M_id='0';
        var str='<%:%s%s value is out of range %s%>';
        var min_vlan_id  = parseInt("<%=ManagementVLANID_MIN_VALUE%>",10);
        var max_vlan_id  = parseInt("<%=ManagementVLANID_MAX_VALUE%>",10);
        if(functionlist.SUPPORT_ETHERNET_BONDING==1){
            get_lacp_mut_status();          
        }        
        $('input:text:enabled[name$="ManagementVLANID"]').each(function(){
            var n = parseInt($(this).val(), 10);
            if(!isNumber($(this).val()) || !isBetween(n, min_vlan_id, max_vlan_id)){
                $(this).focus();
                invalid_M_id = '1';
                return false;
            }
        });

        if(invalid_M_id == '1'){
            alert(String.format(str, "<%=translate('Management VLAN ID')%>", ":", "<%=string.format("[%s - %s]",ManagementVLANID_MIN_VALUE,ManagementVLANID_MAX_VALUE) %>"));
            return false;
        }
        // //**** cehck Before enable management VLAN, SSID's VLAN isolation must be enabled first ***//
        // if($('input:checked[type="radio"][name="cbid.network.sys.WLANVLANEnable"]').val()=="1"){
            
        //     $('input:checkbox:visible:enabled[name$="isolation"]').each(function(){
        //         if(this.checked){
        //             has_isolation = '1';
        //              return false;
        //         }
        //     });
            
        //     if(has_isolation == '0'){
        //         alert("<%=translate('Before enable management VLAN settings, please enable the profile isolation function first')%>");
        //         return false;
        //     }
        // }

        // ATKK think that lacp and vlan can be enable together, so i mark these check
        // if(functionlist.SUPPORT_ETHERNET_BONDING==1){
        //     $('input:checkbox:visible:enabled[name$="isolation"]').each(function(){
        //         if(this.checked){
        //             has_isolation_for_lacp = '1';
        //              return false;
        //         }
        //     });
        //    if((has_isolation_for_lacp == '1'|| $(':radio:enabled[name$="WLANVLANEnable"][value=1]').prop('checked')) && mut_status["lacp"] == "1"){
        //         alert("<%:LACP and VLAN can not be enable at the same time%>")
        //         return false;
        //     } 
        // }
        
        var check_duplicate_vlan_id = '0';

        $(':text:visible:enabled[name$="vlan_id"]').each(function(){
            var test_vlan_id = $(this).val();
            var times = 0;

            var n = parseInt($(this).val(), 10);
            if(!isNumber($(this).val()) || !isBetween(n, min_vlan_id, max_vlan_id)){
                $(this).focus();
                invalid_id = '1';
                return false;    
            }

            $(':text:visible:enabled[name$="vlan_id"]').each(function(){
                if($(this).val()==test_vlan_id){
                    times++;
                }
            });
            if(times > 1){
                check_duplicate_vlan_id = '1';
            }
        });

        if(invalid_id == '1'){
            alert(String.format(str, "<%:VLAN ID%>", ":",  "<%=string.format("[%s - %s]",ManagementVLANID_MIN_VALUE,ManagementVLANID_MAX_VALUE) %>"));
            return false;
        }

        // if(check_duplicate_vlan_id == '1'){
        //      alert("VLAN ID can not be duplicate!"); 
        //      return false;
        // }
        return true;
    },
    text_check = function(){
        var bad_format = false ;
        var str='<%:%s%s value is out of range %s%>';
        $(':text:visible:enabled[name$="SystemName"]').each(function(){
            if($(this).val().length<1||$(this).val().length>32){
                bad_format = true;
                alert("<%=translate('Device name: length must between 1 and 32!')%>");
                return false;
            }
            if(functionlist.SUPPORT_ATKK_FW_VERSION == 1){
            //In Engenius products, Device Name is uesed to be dnsmasq search domain
            //And the comma would cause the dnsmasq crash  when parsing the config.

                if(!isPattern2($(this).val())){
                    bad_format = true;
                    alert("<%=translatef('Device name: %s (Space) are invalid characters.','# ` \\\' \\\" : ; \\\\ / [ ] &')%>");
                    return false;
                } 
            }else{
                if(!isPattern2_1($(this).val())){
                    bad_format = true;
                    alert("<%=translatef('Device name: %s (Space) are invalid characters.','\, # ` \\\' \\\" : ; \\\\ / [ ] &')%>");
                    return false;
                }    
            }            


         });

            reg = /^([\d]{1,4})$/
        $(':text:visible:enabled[name$=".rts"]').each(function(){
            var v = $(this).val(); 
            var num = parseInt(v);
            if((reg.test(v))&&(num >= 1 && num <= 2346)){

            }
            else{
                bad_format = true;
                alert(String.format(str, "<%:RTS/CTS Threshold%>", ":", "[1 - 2346]"));
                return false;
            }
        });

            reg = /^([\d]{1,2})$/
         $(':text:visible:enabled[name$="aggregation_frame"]').each(function(){
            var v = $(this).val(); 
            var num = parseInt(v);
            if((reg.test(v))&&(num >= 1 && num <= 32)||(num == 255)){

            }
            else{
                bad_format = true;
                alert(String.format(str, "<%:Aggregation frames%>", ":", "[1 - 32]"));
                return false;
            }
        });

            reg = /^([\d]{4,5})$/
        $(':text:visible:enabled[name$="aggregation_byte"]').each(function(){
            var v = $(this).val(); 
            var num = parseInt(v);
            if((reg.test(v))&&(num >= 2304 && num <= 65535)){

            }
            else{
                bad_format = true;
                alert(String.format(str, "<%:Aggregation bytes(Max)%>", ":", "[2304 - 65535]"));
                return false;
            }
        });

        $(':text:visible:enabled[name$="clientlimits_number"]').each(function(){
            var n = parseInt($(this).val(), 10);
            if(!isNumber($(this).val()) || !isBetween(n, 1, 127)){
                bad_format = true;
                alert(String.format(str, "<%:Client Limits%>", ":", "[1 - 127]"));
                return false;
            }
         });

        $(':text:visible:enabled[name$="ssid"]').each(function(){
            var length = 0;
            var i = 0;
            for( i = 0 ; i < $(this).val().length ; i++ )
            {
                if ( ( $(this).val().charCodeAt(i) >= 0X2E80 && $(this).val().charCodeAt(i) <= 0X2FDF ) || ( $(this).val().charCodeAt(i) >= 0X3400 && $(this).val().charCodeAt(i) <= 0X4DBF ) || ( $(this).val().charCodeAt(i) >= 0X4E00 && $(this).val().charCodeAt(i) <= 0X9FFF ) || ( $(this).val().charCodeAt(i) >= 0XF900 && $(this).val().charCodeAt(i) <= 0XFAFF ) || ( $(this).val().charCodeAt(i) >= 0X20000 && $(this).val().charCodeAt(i) <= 0X2A6DF ) || ( $(this).val().charCodeAt(i) >= 0X2F800 && $(this).val().charCodeAt(i) <= 0X2FA1F ) ) // check chinese unicode, reference http://jrgraphix.net/research/unicode_blocks.php
                    length = length + 3;
                else 
                    length = length + 1;
            }
            if(length<1||length>32){
                bad_format = true;
                alert("<%:SSID: english+chinese length must between 1 and 32!%>");
                return false;
            }
if(functionlist.SUPPORT_SSID_DENY_COMMA_COLON == 1){
            var reg = /[\;\:]/;
            if(reg.test($(this).val())==true){
                bad_format = true;
                alert("<%=translatef('SSID: %s  are invalid characters.',' : ; ')%>")
                return false;
            }
}
         });

        $(':text:visible:enabled[name$="fasthandover_rssi"]').each(function(){
            var rssiReg=/^-?[0-9]\d*(\d+)?$/
            var RSSI_THRESHOLD_MAX = <%=RSSI_THRESHOLD_MAX%> || -100
            var RSSI_THRESHOLD_MIN = <%=RSSI_THRESHOLD_MIN%> || -60
            var n = parseInt($(this).val(), 10);
            if(!isBetween(n, RSSI_THRESHOLD_MIN, RSSI_THRESHOLD_MAX) || !rssiReg.test($(this).val())){
                bad_format = true;
                alert(String.format(str, "<%:RSSI%>", ":", "[<%=RSSI_THRESHOLD_MIN%> - <%=RSSI_THRESHOLD_MAX%>]"));
                return false;
            }
         });
<%
if uci:get('functionlist','functionlist','SUPPORT_WLAN_OUTDOOR_DISTANCE') == '1' then -----#### SUPPORT_WLAN_OUTDOOR_DISTANCE START ###
    if uci:get('sysProductInfo','model','outdoor') == '1' then
%>  
        $(':text:visible:enabled[name$=".distance"]').each(function(){
            var n = parseInt($(this).val(), 10);
            var lower_limit = 0;
            var upper_limit = 30;
            <%
            if uci:get('functionlist','functionlist','SUPPORT_DISTANCE_ALGORITHM1') == '1' then -----#### SUPPORT__DISTANCE_ALGORITHM1 START ###
            %>
                var d_iface = $(this).attr('name').split(".")[2];//get interface
                lower_limit = 0;
                if($('select[name="cbid.wireless.'+d_iface+'.htmode"]').val() != "HT20")
                    upper_limit = 24;
            <%
            end-----####  SUPPORT__DISTANCE_ALGORITHM1 END ####  
            %> 

            if(check_distance_flag=="0" && !isBetween(n, lower_limit, upper_limit)){
                bad_format = true;
                alert(String.format(str, "<%:Distance%>", ":", "["+lower_limit+" - "+upper_limit+"]"));
                return false;
            }
        });
<%
    end
end-----####  SUPPORT_WLAN_OUTDOOR_DISTANCE END ####  
%> 
         if(bad_format){
            return false ;
         }

         return true;
    },
    ssid_disabled_check = function()
    {
        ssid_disabled_check = "";
        var ssid_enabled_wifi0 = 0;
        var ssid_enabled_wifi1 = 0;
        var ssid_enabled_wifi2 = 0;
        $(':checkbox:visible:enabled[name$="disabled"]').each(
            function()
            {
                if ($(this).prop('checked') && $(this).attr("name").match("_ssid_") )
                {
                    if ($(this).attr("name").match("wifi0"))
                        ssid_enabled_wifi0++;
                    else if ($(this).attr("name").match("wifi1"))
                        ssid_enabled_wifi1++;
                    else if ($(this).attr("name").match("wifi2"))
                        ssid_enabled_wifi2++;
                }
            }
        );
        <% if WLAN24G == '1' then %>
        ssid_disabled_check += '<input type="hidden" name="cbid.wireless.wifi0.ath_count" value="'+ssid_enabled_wifi0+'">';
        <% end %>
        <% if WLAN5G == '1' then %>
            ssid_disabled_check += '<input type="hidden" name="cbid.wireless.wifi1.ath_count" value="'+ssid_enabled_wifi1+'">';
            <% if WLAN5G_2 == '1' then %>
            ssid_disabled_check += '<input type="hidden" name="cbid.wireless.wifi2.ath_count" value="'+ssid_enabled_wifi2+'">';
            <% end %>
        <% end %>

        return true;
    },
	guest_setting = function(){
        guest_change_handle = "";
		var lan_proto = "<%=uci:get('network', 'lan', 'proto')%>", 
			lan_ip,
			lan_mask,
            bad_format=false;
		if(lan_proto == "dhcp")
		{
			lan_ip='<%=ntm.init():get_network("lan"):ipaddr()%>';
			lan_mask = '<%=ntm.init():get_network("lan"):netmask()%>';
			if(lan_ip=="" || lan_mask==""){
				lan_ip='<%=uci:get("network", "lan", "ipaddr")%>';
				lan_mask = '<%=uci:get("network", "lan", "netmask")%>';
			}
		}
		else
		{
			lan_ip='<%=uci:get("network", "lan", "ipaddr")%>';
			lan_mask = '<%=uci:get("network", "lan", "netmask")%>';
		}
		
        $(':checkbox:visible:enabled[name$="guest_network"]').each(function(){
            if ($(this).prop('checked')){
                var this_guest_name=$(this).attr("name");
                var this_iface = this_guest_name.replace("cbid.wireless.","").replace(".guest_network","");
                var this_l2_isolatior_name = this_guest_name.replace("guest_network","l2_isolatior");
                var this_vlan_isolation_name = this_guest_name.replace("guest_network","isolation");
                var this_acct_en_name = this_guest_name.replace("guest_network","acct_enabled");
                var this_encr_view = $("#cbi-wireless-"+this_iface+"-encryption_view");
                var this_security_name = this_guest_name.replace("guest_network","encryption");
                var this_nasid_en_name = this_guest_name.replace("guest_network","nasid_enable");
                var this_nasport_en_name = this_guest_name.replace("guest_network","nasport_enable");
                var this_nasip_en_name = this_guest_name.replace("guest_network","nasip_enable");
                var this_acct_en_name = this_guest_name.replace("guest_network","acct_enabled");
                guest_change_handle += '<input type="hidden" name='+this_l2_isolatior_name+' value="0">';
                guest_change_handle += '<input type="hidden" name='+this_vlan_isolation_name+' value="0">';
                guest_change_handle += '<input type="hidden" name='+this_nasid_en_name+' value="0">';
                guest_change_handle += '<input type="hidden" name='+this_nasport_en_name+' value="0">';
                guest_change_handle += '<input type="hidden" name='+this_nasip_en_name+' value="0">';
                guest_change_handle += '<input type="hidden" name='+this_acct_en_name+' value="0">';

                if ( this_encr_view.text() == "WPA2-Enterprise" || this_encr_view.text() == "WPA3-Enterprise" || this_encr_view.text() == "Mixed-Enterprise" )
                {
                    alert("<%:Guest network does not support %>"+this_encr_view.text()+"<%:, the security mode will change to None.%>");
                    guest_change_handle += '<input type="hidden" name='+this_security_name+' value="none">';
                }

                if(!isIpaddr($('input[name="cbid.network.guest.ipaddr"]').val())){
                    alert(invalid("<%:guest network ip address%>"));
                    setfocus(getByName('cbid.network.guest.ipaddr'));
                    bad_format = true;
                    return false;
                }
                if(isMulticast($('input[name="cbid.network.guest.ipaddr"]').val())){
                    alert("<%=translate('Guest network ip address cannot be a multicast ip address.')%>");
                    setfocus(getByName('cbid.network.guest.ipaddr'));
                    bad_format = true;
                    return false;
                }
                if(isLinklocal($('input[name="cbid.network.guest.ipaddr"]').val())){
                    alert("<%=translate('Guest network ip address cannot be a linklocal ip address.')%>");
                    setfocus(getByName('cbid.network.guest.ipaddr'));
                    bad_format = true;
                    return false;
                }
                if(isLoopback($('input[name="cbid.network.guest.ipaddr"]').val())){
                    alert("<%=translate('Guest network ip address cannot be a loopback ip address.')%>");
                    setfocus(getByName('cbid.network.guest.ipaddr'));
                    bad_format = true;
                    return false;
                }
                if(isSameIpRange($('input[name="cbid.network.guest.ipaddr"]').val(), $('input[name="cbid.network.guest.ipaddr"]').val(),
                                 $('input[name="cbid.dhcp.guest.start"]').val(), $('input[name="cbid.dhcp.guest.limit"]').val())){
                    alert("<%=translate('Guest network ip address cannot overlap DHCP range.')%>");
                    setfocus(getByName('cbid.network.guest.ipaddr'));
                    bad_format = true;
                    return false;
                }
                if(!isSubMask($('input[name="cbid.network.guest.netmask"]').val())){
                    alert(invalid("<%:guest network subnet mask%>"));
                    setfocus(getByName('cbid.network.guest.netmask'));
                    bad_format = true;
                    return false;
                }
                if(lan_ip)
                {
                    if(isSameSubnet(lan_ip, lan_mask, $('input[name="cbid.network.guest.ipaddr"]').val(), $('input[name="cbid.network.guest.netmask"]').val())){
                        alert("<%:To let guest network work properly, please assure the subnet of guest network do not overlap the subnet of LAN.%>");
                        setfocus(getByName('cbid.network.guest.ipaddr'));
                        bad_format = true;
                        return false;
                    }
                }
                if(!isIpaddr($('input[name="cbid.dhcp.guest.start"]').val())){
                    alert(invalid("<%:starting ip address%>"));
                    setfocus(getByName('cbid.dhcp.guest.start'));
                    bad_format = true;
                    return false;
                }
                if(!isSameSubnet($('input[name="cbid.network.guest.ipaddr"]').val(), $('input[name="cbid.network.guest.netmask"]').val(), $('input[name="cbid.dhcp.guest.start"]').val())){
                    alert("<%:Invalid DHCP starting ip subnet. Please enter again.%>");
                    setfocus(getByName('cbid.dhcp.guest.start'));
                    bad_format = true;
                    return false;
                }
                if(!isIpaddr($('input[name="cbid.dhcp.guest.limit"]').val())){
                    alert(invalid("<%:ending ip address%>"));
                    setfocus(getByName('cbid.dhcp.guest.limit'));
                    bad_format = true;
                    return false;
                }
                if(!isSameSubnet($('input[name="cbid.network.guest.ipaddr"]').val(), $('input[name="cbid.network.guest.netmask"]').val(), $('input[name="cbid.dhcp.guest.limit"]').val())){
                    alert("<%:Invalid DHCP ending ip subnet. Please enter again.%>");
                    setfocus(getByName('cbid.dhcp.guest.limit'));
                    getByName('cbid.dhcp.guest.limit').value = "";
                    bad_format = true;
                    return false;
                }
                if(!checkClientRange($('input[name="cbid.dhcp.guest.start"]').val(), $('input[name="cbid.dhcp.guest.limit"]').val())){
                    alert("<%=translate('Ending ip address should be greater than starting ip address.')%>");
                    setfocus(getByName('cbid.dhcp.guest.start'));
                    bad_format = true;
                    return false;
                }
                if($('input[name="cbid.dhcp.guest.dhcp_option"]').val() != '0.0.0.0' && !isIpaddr($('input[name="cbid.dhcp.guest.dhcp_option"]').val())){
                    alert(invalid("<%:WINS server ip%>"));
                    setfocus(getByName('cbid.dhcp.guest.dhcp_option'));
                    getByName('cbid.dhcp.guest.dhcp_option').value = "";
                    bad_format = true;
                    return false;
                }
                if(isMulticast($('input[name="cbid.dhcp.guest.dhcp_option"]').val())){
                    alert("<%:WINS server ip address cannot be a multicast ip address.%>");
                    setfocus(getByName('cbid.dhcp.guest.dhcp_option'));
                    bad_format = true;
                    return false;
                }
                if(isLinklocal($('input[name="cbid.dhcp.guest.dhcp_option"]').val())){
                    alert("<%:WINS server ip address cannot be a linklocal ip address.%>");
                    setfocus(getByName('cbid.dhcp.guest.dhcp_option'));
                    bad_format = true;
                    return false;
                }
                if(isLoopback($('input[name="cbid.dhcp.guest.dhcp_option"]').val())){
                    alert("<%:WINS server ip address cannot be a loopback ip address.%>");
                    setfocus(getByName('cbid.dhcp.guest.dhcp_option'));
                    bad_format = true;
                    return false;
                }
            }
        });
        if(bad_format){return false;} /* check guest failed return false */
        return true;
    }

    return{
        check : statrtCheck
    };


}());

var gn_ip = (function(){  
    var do2num = function(dot){
         /*192.168.200.100->3232286820*/
        var d = dot.split('.');
        return ((((((+d[0])*256)+(+d[1]))*256)+(+d[2]))*256)+(+d[3]);
    },
    num2dot = function(num){ 
        /*3232286820->192.168.200.100*/
        var d = num%256;
        for (var i = 3; i > 0; i--) { 
            num = Math.floor(num/256);
            d = num%256 + '.' + d;
        }
        return d;
    },
    init = function(){
        var start_ip = $('input:text[name="cbid.dhcp.guest.start"]').val();
        var start_ip_num =  do2num(start_ip);
        //var limit =  $('input:text[name="cbid.dhcp.guest.limit"]').val();
        var limit = "<%=uci:get('dhcp', 'guest', 'limit')%>";
        var end_ip = num2dot(parseInt(start_ip_num)+parseInt(limit));
        $('input:text[name="cbid.dhcp.guest.limit"]').val(end_ip);

        //var win_server_ip = $('input:text[name="cbid.dhcp.guest.dhcp_option"]').val();
        var win_server_ip = "<%=uci:get('dhcp', 'guest', 'dhcp_option')%>";
        $('input:text[name="cbid.dhcp.guest.dhcp_option"]').val(win_server_ip.split(",")[1]);
    },
    checkEnable = function(){
       var flag = false; 
       <% if uci:get('functionlist','functionlist','SUPPORT_GUEST_NETWORK_BY_SSID') == '1' then --[[ #### SUPPORT_GUEST_NETWORK_BY_SSID START ### --]] %>
       $('input:checkbox:visible:enabled[name$=".guest_network"]').each(function(){
            flag = flag || this.checked;
       });
       <% else %>
       $('input:checkbox:visible[name$="_guest.disabled"]').each(function(){
            flag = flag || this.checked;
       });
       <% end %>

        if(flag == true){
            $(':hidden[name="cbid.dhcp.guest.ignore"]').val("0");
            $("#gn_ip input").attr("disabled",false);
        }else{
            $(':hidden[name="cbid.dhcp.guest.ignore"]').val("1");
            $("#gn_ip input").attr("disabled",true);
        }

    },
    save = function(){
        var start_ip = $('input:text[name="cbid.dhcp.guest.start"]').val();
        var start_ip_num =  do2num(start_ip);
        var end_ip = $('input:text[name="cbid.dhcp.guest.limit"]').val();
        var end_ip_num =  do2num(end_ip);
        $('input:text[name="cbid.dhcp.guest.limit"]').val(end_ip_num-start_ip_num);
        var win_server_ip = $('input:text[name="cbid.dhcp.guest.dhcp_option"]').val();
        $('input:text[name="cbid.dhcp.guest.dhcp_option"]').val("44,"+win_server_ip);
    },
    doNothing = function(){};
<% if uci:get('functionlist','functionlist','SUPPORT_GUEST_NETWORK_SETTING') == '1' then --[[ #### SUPPORT_GUEST_NETWORK_SETTING START ### --]] %>
    return{
        init :init,
        checkEnable : checkEnable,
        save :save
    };
<% else %>
    return{
        init :doNothing,
        checkEnable : doNothing,
        save :doNothing
    };
<% end --[[ #### SUPPORT_GUEST_NETWORK_SETTING END ### --]] %>
}());

var hide_option = function(selName,opt_hide,status){
    if(status == "hide"){        
        if(!$('select[name$="'+selName+'"] span[name="'+opt_hide+'"]').length){
            $('select[name$="'+selName+'"] option[value="'+opt_hide+'"]').wrap('<span name="'+opt_hide+'"></span>').hide(); 
        }
    }
    else{
        if($('select[name$="'+selName+'"] span[name="'+opt_hide+'"]').length){
            var opt = $('select[name$="'+selName+'"] span[name="'+opt_hide+'"]').find('option').show();
            $('select[name$="'+selName+'"] span[name="'+opt_hide+'"]').replaceWith(opt)
        }
        $('select[name$="'+selName+'"] option[value="'+opt_hide+'"]').removeAttr("style");
    }

};

var remove_option = function(selName,opt,status,name){
    if (status == "remove"){
        if($('select[name$="'+selName+'"]').length>0){
            $('select[name$="'+selName+'"] option[value="'+opt+'"]').remove(); 
        }
    }
    else{
        if($('select[name$="'+selName+'"]').length>0){
            var len = $('select[name$="'+selName+'"] option').length;
            $('select[name$="'+selName+'"]').children().each(function(index, element){
                if ($('select[name$="'+selName+'"] option[value="'+opt+'"]').length==0){
                    if (parseInt($(this).val(),10) > parseInt(opt,10)){
                        $(this).before('<option id="cbi-wireless-'+selName+'-'+opt+'" value="'+opt+'">'+name+'</option>');
                        return false;
                    }
                    if (index == len - 1)
                        $(this).after('<option id="cbi-wireless-'+selName+'-'+opt+'" value="'+opt+'">'+name+'</option>');
                }
            })
        }
    }
};

var wds_link = (function(){
    var init = function(networkName,netid){
        wds_setvalue();
        var iface = netid.split(".")[0];
        var channel = netid.split(".")[0]+".channel";
        var hwmode = iface+".hwmode";
        var htmode = iface+".htmode";
        var opmode = iface+".opmode";
        var macstr =  $('input:hidden[name="cbid.wireless.'+networkName+'.WLANWDSPeer"]').val();
        var maclist = macstr.split(/[v|x]/g);
        var macModestr =  $('input:hidden[name="cbid.wireless.'+networkName+'.WLANWDSPeer_mode"]').val();
        var macModelist = macModestr.split(/[v|x]/g);

        $("#"+networkName+"_macfilter input:text").each(function(){
            var index = $(this).attr("name").split(networkName+"maca");
            if(maclist[index[0]] && maclist[index[0]].length > 0 ){
               $(this).val(maclist[index[0]].slice(index[1]*2,index[1]*2+2));
            }
            $(this).css('width',"60px");
        });

        $("#"+networkName+"_macfilter select").each(function(){
<% if uci:get("functionlist","functionlist","SUPPORT_WDS_PEER_CAPABILITY") == "1" then %>
            if ($(this).attr("name").match("hwmode_select"))
            {
                var index = parseInt($(this).attr("name").split(networkName+"hwmode_select"));
                if(macModelist[index] && macModelist[index].length > 0 ){
                    $(this).val(macModelist[index].substring(12,13));
                }
            }
            else
            {
                var index = parseInt($(this).attr("name").split(networkName+"mac_select"));
                var length = 12*(index+1)+index ;
                if(macstr[length] && macstr[length].length > 0 ){
                    $(this).val(macstr[length]);
                }
            }
<% else %>
            var index = parseInt($(this).attr("name").split(networkName+"mac_select"));
            var length = 12*(index+1)+index ;
            if(macstr[length] && macstr[length].length > 0 ){
                $(this).val(macstr[length]);
            }
<% end %>
        });

        $('select[name$="index_dummy"]').change(function(){
            $('input[name$="wlanwdswepkey"]').attr('maxlength',$(this).val());
        });

        $('select[name$="nawds_encr"]').change(function(){

            var ifname =  $(this).attr("name").split(".")[2];
            var encMode = $(this).val();

            $(this).closest("tr").nextAll("tr").each(function(){
                if($(this).attr("id") == ifname+"_"+encMode){
                    $(this).find("*").attr("disabled",false);
                }else{
                     $(this).find("*").attr("disabled",true);
                }
            });
            if(encMode == "wep" ){
                 $('select[name$="index_dummy"]').triggerHandler('change');
                 hide_option(hwmode,"11n","hide");
                 $('select[name$="'+hwmode+'"]').triggerHandler('change');
            }else{
                 hide_option(hwmode,"11n","show");
                 $('select[name$="'+hwmode+'"]').triggerHandler('change');
            }
        });  

        $('select[name$="'+hwmode+'"]').change(function(){
            var encMode = $(this).val();
            if(encMode == "11n" ){
                 hide_option(networkName+".nawds_encr","wep","hide");
            }else{
                 hide_option(networkName+".nawds_encr","wep","show");
            }           

        });  
        $('select[name$="'+hwmode+'"]').triggerHandler('change');

        $('select[name$="mac_select"]').change(function(){
            var status = $(this).val();
            $(this).closest("tr").find("input").each(function(){
                $(this).attr("disabled",status=="x"?true:false);
            });
        });   


        // $('select[name$="nawds_encr"]').each(function(){$(this).triggerHandler("change")});
        // $('select[name$="mac_select"]').each(function(){$(this).triggerHandler("change")});
        
        $('select:visible[name$="mac_select"]').change(function(){

            var show_caution = "0";
            var opmode_value =  $('select[name$="'+opmode+'"]').val();
            
            $('select:visible[name$="mac_select"]').each(function(){
                if($(this).val()=="v"){
                    show_caution = "1";
                    return false;
                }
            });

            if(show_caution=="1"){
                hide_option(htmode,"HT20_40","hide");
                hide_option(channel,"auto","hide");
                $('#'+networkName+"_caution").show();
            }else{
                if(opmode_value == "wds_ap" || opmode_value == "ap"){
                    hide_option(htmode,"HT20_40","show");
                }
                hide_option(channel,"auto","show");
                $('#'+networkName+"_caution").hide();
            }

        });  
        $('select[name$="nawds_encr"]').each(function(){$(this).triggerHandler("change")});
        $('select[name$="mac_select"]').each(function(){$(this).triggerHandler("change")});
        if (typeof AddMyid !== 'undefined') { AddMyid("cbi","idchange") };  /* add my id*/
    },
    save = function(){
        $('tr[id$="_wep"] select').attr("disabled",true);
        $('input:text:enabled[name$="wlanwdswepkey"]').each(function(){
            var keySize = $(this).val().length;
            if(keySize==5||keySize==13||keySize==16){
                $(this).val("s:"+$(this).val()) ;
            }
        });

        $('table[id$="macfilter"]').each(function(){
            var macStr="",allmacStr="";
            var allMacHwmodeStr="";
            var ifname = $(this).attr("id").replace("_macfilter","");
            $(this).find("input , select").each(function(){
                var type = this.type ? this.type : this.nodeName.toLowerCase();
                if(type == "text"){
                     macStr+=$(this).val().toUpperCase();
                }else{
<% if uci:get("functionlist","functionlist","SUPPORT_WDS_PEER_CAPABILITY") == "1" then %>
                    if(!macStr=="")
                    {
                        if ($(this).attr("name").match("hwmode_select"))
                        {
                            allMacHwmodeStr+=(macStr+$(this).val());
                        }
                        else
                        {
                            allmacStr+=(macStr+$(this).val());
                            allMacHwmodeStr+=$(this).val();
                            macStr="";
                        }
                    }
<% else %>
                    if(!macStr==""){
                        allmacStr+=(macStr+$(this).val());
                    }
                    macStr="";
<% end %>
                }
            })
            $('input:hidden[name="cbid.wireless.'+ifname+'.WLANWDSPeer"]').val(allmacStr);
            $('input:hidden[name="cbid.wireless.'+ifname+'.WLANWDSPeer_mode"]').val(allMacHwmodeStr);
        });

    };
    return{
        init :init,
        save :save
    };
}());

$(function()
{
<% if uci:get('functionlist','functionlist','SUPPORT_MANAGEMENT_SSID') == '1' then %>
    <% if uci:get('functionlist','vendorlist','MANAGEMENT_SUPPORT_RADIO') == '1' then %>
        $(':radio[name$="livetime"][value="'+<%=uci:get("wireless","wifi0_mgmt","livetime")%>+'"]').prop('checked', true).triggerHandler('click');
    <% elseif uci:get('functionlist','vendorlist','MANAGEMENT_SUPPORT_RADIO') == '2' then %>
        $(':radio[name$="livetime"][value="'+<%=uci:get("wireless","wifi1_mgmt","livetime")%>+'"]').prop('checked', true).triggerHandler('click');
    <% end %>
<% end %>
<% if uci:get('functionlist','functionlist','SUPPORT_MIN_RATE_SETTING') == "1" then %>
    var rateWin;
    $('input[type="button"][name$=".wifi_rate"]').click(function(){
        if ( rateWin != undefined )
            rateWin.close();
        rateWin = window.open('<%=luci.dispatcher.build_url("admin/network/wifi_Rate")%>');
        return false;
    });
<% end %>
<% for i=1,8 do %>
    if('<%=uci:get("wireless","wifi0_ssid_"..i,"isolation")%>' == 0)
    {
        tmp_vlanid["<%=i%>"-1] = -1;
    }
<%end%>
<% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_MODULE') == '1' then
    for _, v in ipairs(sta_ap_ap) do
%>
    $("tr[id='<%=v%>']").hide().find('input').filter(
     function(){
        $(this).attr("disabled","disabled");
     });
<%
    end
end
%>
    <% for _, r in pairs({"2.4G","5G"}) do --[[ #### Setting wifi common rule start ### --]] %>
        <% for i=1,#devs[r] do %>
            /* Load Device map */
            loadDevice("<%=devs[r][i]%>","#dev_<%=devs[r][i]%>_container" ,'<%=luci.dispatcher.build_url("admin/network/wifi_device")%>?device=<%=devs[r][i]%>',layoutTableDevice_<%=devs[r][i]%>);
            
            /*  fasthandover check rule */
            $(':radio[name="cbid.wireless.<%=devs[r][i]%>.fasthandover_status"][value="'+<%=uci:get("wireless",devs[r][i],"fasthandover_status")%>+'"]').prop('checked', true).triggerHandler('click');
            $('input[type="radio"][name="cbid.wireless.<%=devs[r][i]%>.fasthandover_status"]').click(function(){
                $('input[name="cbid.wireless.<%=devs[r][i]%>.fasthandover_rssi"]').attr("disabled",$(this).val()==0?true:false);
            }).triggerHandler('click')

            /*  AP Detection */
            $('input[type="button"][name="cbid.wireless.<%=devs[r][i]%>.AP_Detection"]').click(function(){
                var tmpOpmode = $('select[name="cbid.wireless.<%=devs[r][i]%>.opmode"]').val();

<% if uci:get('functionlist','functionlist','SUPPORT_AP_MODE_ONLY') == '1' then --[[ #### SUPPORT_AP_MODE_ONLY START ### --]] %>
                var netid = '<%=wifi_all_net[devs[r][i]]["ap"][1]:id()%>';
<%else%>
                switch(tmpOpmode) {
<% if uci:get('functionlist','functionlist','SUPPORT_CLIENTBRIDGE_MODULE') == '1' then %>
                    case "sta":
                        var netid = '<%=wifi_all_net[devs[r][i]]["sta"][1]:id()%>';
                        break;
<% end %>
<% if uci:get('functionlist','functionlist','SUPPORT_REPEATER_MODULE') == '1' then --[[ #### SUPPORT REPEATER START ### --]] %>
                    case "sta_ap":
                        var netid = '<%=wifi_all_net[devs[r][i]]["sta_ap_sta"][1]:id()%>';
                        break;
<% end %>
                    default:
                        var netid = '<%=wifi_all_net[devs[r][i]]["wds_sta"][1]:id()%>';
                        break;
                }
<% end --[[ #### SUPPORT_AP_MODE_ONLY END ### --]]%>
<% if uci:get('functionlist','functionlist','SUPPORT_WLAN5G_2') == '1' then %>
    <% if devs[r][i] == 'wifi2' then %>
                var url ='<%=luci.dispatcher.build_url("admin/network/wireless_join")%>?title=<%=r%>Hz-2%20sitesurvey&device=<%=devs[r][i]%>&tmpOpmode='+tmpOpmode+"&netid="+netid;
    <% elseif devs[r][i] == 'wifi1' then %>
                var url ='<%=luci.dispatcher.build_url("admin/network/wireless_join")%>?title=<%=r%>Hz-1%20sitesurvey&device=<%=devs[r][i]%>&tmpOpmode='+tmpOpmode+"&netid="+netid;
    <% else %>
                var url ='<%=luci.dispatcher.build_url("admin/network/wireless_join")%>?title=<%=r%>Hz%20sitesurvey&device=<%=devs[r][i]%>&tmpOpmode='+tmpOpmode+"&netid="+netid;
    <% end %>
<% else %>
                var url ='<%=luci.dispatcher.build_url("admin/network/wireless_join")%>?title=<%=r%>Hz%20sitesurvey&device=<%=devs[r][i]%>&tmpOpmode='+tmpOpmode+"&netid="+netid;
<% end %>
                var win = window.open(url, '_blank');
                win.focus();
            }); /*  AP Detection end */
<% if WLAN24G == '1' and HWMODE_AX == '1' then %>
    document.getElementsByName("hwmode_11ax")[('<%=uci:get("wireless","wifi0","hwmode")%>'=="11axg")?0:1].checked=true;
<% end %>
            $('div[id="cbi-wireless-<%=devs[r][i]%>-opmode"]').nextUntil('#cbi-wireless-<%=devs[r][i]%>-opmode').hide();
<% if uci:get('functionlist','functionlist','SUPPORT_GREENMODE_SETTING') == '1' then --[[ #### SUPPORT GREENMODE START ### --]] %>
            $('#green_<%=devs[r][i]%>').show();
            $('div[id="cbi-wireless-<%=devs[r][i]%>-opmode"]').nextUntil('#cbi-wireless-<%=devs[r][i]%>-opmode').show(); 
<% end --[[ #### SUPPORT GREENMODE END ### --]]%>

        <% end %>
    <% end --[[ #### Setting wifi common rule end ### --]]%>

    $('input[type="radio"][name="cbid.network.sys.WLANVLANEnable"]').click(function(){
        $('input[name="cbid.network.sys.ManagementVLANID"]').attr("disabled",$(this).val()==0?true:false);
    }).triggerHandler('click');
	// rematch(layoutTableDevice);
	// SettingRule();
	// $('select[name$="hwmode"]').each(function(){$(this).triggerHandler("change")});


    /*remove dummy cbi*/
    $("#cbi_set").hide(); 
    $(".cbi-map").hide(); 

    gn_ip.init();
    // checkPureN();

    $(':radio[name$="WLANVLANEnable"][value="'+<%=uci:get("network","sys","WLANVLANEnable")%>+'"]').prop('checked', true).triggerHandler('click');

    var NWin;
    $('input[type="button"][name$=".encrEdit"]').click(function(){
        var netId = $(this).attr("netId");
        var encrId = $(this).attr("id");
        var displayMode; 
        if((netId).match("wifix")){
        	displayMode="ap";
        }else if((encrId).match("_wds_") && (encrId).match("_wds_sta")){
            displayMode="wds_sta";
        }else if((encrId).match("_wds_") && !(encrId).match("_wds_sta")){
        	displayMode="wds_ap";
        }else if((encrId).match("_sta_ap_")){
            displayMode="sta_ap";  //repeater
        }else if((encrId).match("_sta")){
            displayMode="sta";  //client bridge
        }else if((encrId).match("_tdma")){
            if($('select[name$="wifi1.opmode"]').val()=="ap"){
                displayMode="ap";
            }
            else if($('select[name$="wifi1.opmode"]').val()=="wds_ap"){
                displayMode="wds_ap";
            }
        }else{
        	displayMode="ori";
        }
        netId = netId.replace("wifix","wifi0");
        var dev = netId.split(".")[0];
        var select_hwmode = $('select[name$="'+dev+'.hwmode"]').val();
        var select_opmode = $('select[name$="'+dev+'.opmode"]').val();
       
	<% if uci:get('functionlist','functionlist','SUPPORT_COMBINED_SSID_SETTING') == '1' then %>
	    var wifi0_select_opmode = $('select[name$="wifi0.opmode"]').val();
        var wifi1_select_opmode = $('select[name$="wifi1.opmode"]').val();
        <% if WLAN5G_2=="1" then %>
        var wifi2_select_opmode = $('select[name$="wifi2.opmode"]').val();
        <% end %>

    if((encrId).match("_tdma")){
        var guestEn = $('input[name="cbid.wireless.wifix_ssid_tdma_1.guest_network"]').is(':checked')?"1":"0";
        var checkbox5G = $('input[name="cbid.wireless.wifix_ssid_tdma_1.disabled"]').is(':checked')?"0":"1";
    }
    else{
        var guestEn = $('input[name="cbid.wireless.wifix_ssid_'+netId.slice(-1)+'.guest_network"]').is(':checked')?"1":"0";
        var checkbox5G = $('input[name="wireless.wifi1_ssid_'+netId.slice(-1)+'.disabled"]').is(':checked')?"0":"1";
    }
    var checkbox2G = $('input[name="wireless.wifi0_ssid_'+netId.slice(-1)+'.disabled"]').is(':checked')?"0":"1";
        <% if WLAN5G_2=="1" then %>
        var checkbox52G = $('input[name="wireless.wifi2_ssid_'+netId.slice(-1)+'.disabled"]').is(':checked')?"0":"1";
        <% end %>
	<% end %> 
        
    var countryId = $('select[name="cbid.wireless.wifi0.country"]').val();
        
        if(NWin!=undefined){
            NWin.close();
        }
     	<% if uci:get('functionlist','functionlist','SUPPORT_COMBINED_SSID_SETTING') == '1' then %>
		<% if WLAN5G_2=="1" then %>
		//2.4g, 5g, 5g-2
		NWin = window.open('<%=luci.dispatcher.build_url("admin/network/wifi_Encryption_Combined")%>?wifi0_select_opmode='+wifi0_select_opmode+'&wifi1_select_opmode='+wifi1_select_opmode+'&wifi2_select_opmode='+wifi2_select_opmode+'&displayMode='+displayMode+'&checkbox2G='+checkbox2G+'&checkbox5G='+checkbox5G+'&checkbox52G='+checkbox52G+'&guestEn='+guestEn+'&netId='+netId+'&countryId='+countryId+'&select_opmode='+select_opmode+'&select_hwmode='+select_hwmode+'&tmpOpmode='+select_opmode, 'encr_page', '')
		<% else %>
		//2.4g, 5g
		NWin = window.open('<%=luci.dispatcher.build_url("admin/network/wifi_Encryption_Combined")%>?wifi0_select_opmode='+wifi0_select_opmode+'&wifi1_select_opmode='+wifi1_select_opmode+'&displayMode='+displayMode+'&checkbox2G='+checkbox2G+'&checkbox5G='+checkbox5G+'&guestEn='+guestEn+'&netId='+netId+'&countryId='+countryId+'&select_opmode='+select_opmode+'&select_hwmode='+select_hwmode+'&tmpOpmode='+select_opmode, 'encr_page', '')
		<% end %>
	<% else %>
        NWin = window.open('<%=luci.dispatcher.build_url("admin/network/wifi_Encryption")%>?netId='+netId+'&select_opmode='+select_opmode+'&select_hwmode='+select_hwmode+'&tmpOpmode='+select_opmode, 'encr_page', '');
	<% end %>
        // if (window.focus) {
        //     NWin.focus();
        // }
        return false;
    });

        /* --   get ap & wds_ap section syntax    -- */
<%            
        local section2G = {}
        local section5G = {}
        local section52G = {}        
        local disabled_radio2G = "1"
        local disabled_radio5G = "1"
        local disabled_radio52G = "1"
        local wifi_status = {}
        uci:foreach("wireless", "wifi-iface",function(s)
                if s.device == "wifi0" and s.mode_display == "ap" then
                    section2G["ap"]= tostring(section2G["ap"]) == "nil" and s[".name"] or section2G["ap"]..","..s[".name"]
                end
                if s.device == "wifi0" and (s.mode_display == "wds_ap" and s.nawds == "0") then
                    section2G["wds_ap"]= tostring(section2G["wds_ap"]) == "nil" and s[".name"] or section2G["wds_ap"]..","..s[".name"]
                end
                if s.device == "wifi0" and (s.mode_display == "ap" or (s.mode_display == "wds_ap" and s.nawds == "0")) then
                    disabled_radio2G = "0"
                    if s.status == "1" then
                        wifi_status["2G"] = tostring(wifi_status["2G"]) == "nil" and s[".name"] or wifi_status["2G"]..","..s[".name"]
                    end
                end
                if s.device == "wifi1" and s.mode_display == "ap" then
                    section5G["ap"]= tostring(section5G["ap"]) == "nil" and s[".name"] or section5G["ap"]..","..s[".name"]
                end
                if s.device == "wifi1" and (s.mode_display == "wds_ap" and s.nawds == "0") then
                    section5G["wds_ap"]= tostring(section5G["wds_ap"]) == "nil" and s[".name"] or section5G["wds_ap"]..","..s[".name"]
                end
                if s.device == "wifi1" and (s.mode_display == "ap" or (s.mode_display == "wds_ap" and s.nawds == "0")) then
                    disabled_radio5G = "0"
                    if s.status == "1" then
                        wifi_status["5G"] = tostring(wifi_status["5G"]) == "nil" and s[".name"] or wifi_status["5G"]..","..s[".name"]
                    end
                end
if WLAN5G_2=="1" then
                if s.device == "wifi2" and s.mode_display == "ap" then
                    section52G["ap"]= tostring(section52G["ap"]) == "nil" and s[".name"] or section52G["ap"]..","..s[".name"]
                end
                if s.device == "wifi2" and (s.mode_display == "wds_ap" and s.nawds == "0") then
                    section52G["wds_ap"]= tostring(section52G["wds_ap"]) == "nil" and s[".name"] or section52G["wds_ap"]..","..s[".name"]
                end
                if s.device == "wifi2" and (s.mode_display == "ap" or (s.mode_display == "wds_ap" and s.nawds == "0")) then
                    disabled_radio52G = "0"
                    if s.status == "1" then
                        wifi_status["52G"] = tostring(wifi_status["52G"]) == "nil" and s[".name"] or wifi_status["52G"]..","..s[".name"]
                    end
                end
end
        end)
%>    
    if ("<%=disabled_radio2G%>" == "1"){
        $("#wifi0_tbl input[name$='disabled'],#wifi0_guest input[name$='disabled']").each(function(){
            if ($(this).is(':checked')){
                $(this).trigger('click');
            }
            $(this).attr("disabled","disabled");
        });
    }
    if ("<%=disabled_radio5G%>" == "1"){
        $("#wifi1_tbl input[name$='disabled'],#wifi1_guest input[name$='disabled']").each(function(){
            if ($(this).is(':checked')){
                $(this).trigger('click');
            }
            $(this).attr("disabled","disabled");
        })
    }
<% if WLAN5G_2=="1" then --[[ #### WLAN5G_2 feature ### --]] %>
    if ("<%=disabled_radio52G%>" == "1"){
        $("#wifi2_tbl input[name$='disabled'],#wifi2_guest input[name$='disabled']").each(function(){
            if ($(this).is(':checked')){
                $(this).trigger('click');
            }
            $(this).attr("disabled","disabled");
        })
    }
<% end --[[ #### WLAN5G_2 feature end ### --]] %>
    var channelWin;
    $('input[type="button"][name$=".wifi_channel"]').click(function(){
        var select_htmode = $('select[name$="wifi1.htmode"]').val();

        switch(select_htmode){
            case "HT40" : 
                        htmode_flag = "v40";
                        break;
            case "HT80" :
                        htmode_flag = "v80";;
                        break;
            default :
                        htmode_flag = "v20";
                        break;
        }
<% if WLAN5G_2=="1" then --[[ #### WLAN5G_2 feature ### --]] %>
        var select_htmode_52g = $('select[name$="wifi2.htmode"]').val();
        var htmode_flag_52g;
        switch(select_htmode_52g){
            case "HT40" :
                        htmode_flag_52g = "v40";
                        break;
            case "HT80" :
                        htmode_flag_52g = "v80";;
                        break;
            default :
                        htmode_flag_52g = "v20";
                        break;
        }
<% end --[[ #### WLAN5G_2 feature end ### --]] %>
        /*--   record user enable ssid     --*/
        function get_enable_flag(section){
            var enable_flag;
            var sec_split = section.split(",");
            for (var i in sec_split){
                if ($("input[name='cbid.wireless."+sec_split[i]+".disabled']").is(":checked")){
                    enable_flag = (enable_flag==null) ? sec_split[i] : enable_flag+","+sec_split[i]; 
                }
            }
            return enable_flag;
        }
        enable_flag2G = ((get_enable_flag("<%=section2G["ap"]%>")) ? get_enable_flag("<%=section2G["ap"]%>") :  "") + ((get_enable_flag("<%=section2G["ap"]%>")&&get_enable_flag("<%=section2G["wds_ap"]%>")) ? "," : "") + ((get_enable_flag("<%=section2G["wds_ap"]%>")) ? get_enable_flag("<%=section2G["wds_ap"]%>") : "");
        enable_flag5G = ((get_enable_flag("<%=section5G["ap"]%>")) ? get_enable_flag("<%=section5G["ap"]%>") :  "") + ((get_enable_flag("<%=section5G["ap"]%>")&&get_enable_flag("<%=section5G["wds_ap"]%>")) ? "," : "") + ((get_enable_flag("<%=section5G["wds_ap"]%>")) ? get_enable_flag("<%=section5G["wds_ap"]%>") : "");
<% if WLAN5G_2=="1" then --[[ #### WLAN5G_2 feature ### --]] %>
        enable_flag52G = ((get_enable_flag("<%=section52G["ap"]%>")) ? get_enable_flag("<%=section52G["ap"]%>") :  "") + ((get_enable_flag("<%=section52G["ap"]%>")&&get_enable_flag("<%=section52G["wds_ap"]%>")) ? "," : "") + ((get_enable_flag("<%=section52G["wds_ap"]%>")) ? get_enable_flag("<%=section52G["wds_ap"]%>") : "");
        if (enable_flag52G == ""){
            enable_flag52G=$("input[name='iface_status52G']").val();
        }
        if (!get_enable_flag("<%=section52G["ap"]%>") && !get_enable_flag("<%=section52G["wds_ap"]%>")){
            disabled52G = "1";
        }
<% end --[[ #### WLAN5G_2 feature end ### --]] %>
        if (enable_flag2G == ""){
            enable_flag2G=$("input[name='iface_status2G']").val();
        }
        if (enable_flag5G == ""){
            enable_flag5G=$("input[name='iface_status5G']").val();
        }

        /*--    check is disabled radio     --*/
        if (!get_enable_flag("<%=section2G["ap"]%>") && !get_enable_flag("<%=section2G["wds_ap"]%>")){
            disabled2G = "1";
        }
        if (!get_enable_flag("<%=section5G["ap"]%>") && !get_enable_flag("<%=section5G["wds_ap"]%>")){
            disabled5G = "1";
        }
        if ( channelWin != undefined )
            channelWin.close();
<% if WLAN5G_2=="1" then --[[ #### WLAN5G_2 feature ### --]] %>
        channelWin = window.open('<%=luci.dispatcher.build_url("admin/network/wifi_Channel")%>?htmode='+htmode_flag+'&htmode_52g='+htmode_flag_52g+'');
<%else%>
        channelWin = window.open('<%=luci.dispatcher.build_url("admin/network/wifi_Channel")%>?htmode='+htmode_flag+'');
<% end --[[ #### WLAN5G_2 feature end ### --]] %>

        return false;
    }); 
    /*handle unchecked flag option for keep option*/
    $( "form[name='cbi']" ).submit(function(){
        if ($("select[name='cbid.wireless.wifi0.country']").is(':enabled')){
            $("input:hidden[name='cbid.wireless.wifi0.country']").remove();
        }
        wds_link.save();
        gn_ip.save();
/*if (functionlist.SUPPORT_WLAN_EXTENSION_CHANNEL == 1){
    $('select[name$="wifi1.ext_channel"]').attr("disabled",false);
    <% if WLAN5G_2=="1" then %>
        $('select[name$="wifi2.ext_channel"]').attr("disabled",false);
    <% end %>
}*/

if (functionlist.SUPPORT_WLAN_L2_ISOLATION == 1){

       $('input[name$=".isolate"]').each(function(){
            if($(this).attr("disabled")=="disabled"){
                var l2_isolatior_name = $(this).attr("name").replace("isolate","l2_isolatior");
                var l2_isolatior_value = $(':checked:checkbox[name="'+l2_isolatior_name+'"]').val();
                if(l2_isolatior_value =="1"){
                    $(this).attr("disabled",false);
                }
            }
        });
}

<%
if uci:get('functionlist','functionlist','SUPPORT_WLAN_OUTDOOR_DISTANCE') == '1' then -----#### SUPPORT_WLAN_OUTDOOR_DISTANCE START ###
    if uci:get('sysProductInfo','model','outdoor') == '1' then
%>  
        $(':text:visible:enabled[name$=".distance"]').each(function(){
            var n = parseInt($(this).val(), 10);
            $(this).val(n*1000);
            check_distance_flag=1;
        });
<%
    end
end-----####  SUPPORT_WLAN_OUTDOOR_DISTANCE END ####  
%> 

       $('input').each(function(){
            var type = $(this).attr("type");
            if(type=="checkbox" && !this.checked && !$(this).attr("disabled")){
                $(this).prev("input:hidden").attr("name",$(this).attr("name"));
                $(this).prev("input:hidden").val($(this).val()=='0'?'1':'0');  
                //console.log( $(this).prev("input:hidden").attr("name")+" - "+ $(this).prev("input:hidden").val()); 
            }
        });

         /*handle rts */
       // var wifi0_rts_value = $('input:text[name="cbid.wireless.wifi0.rts"]').val();       
       // rtsTable["wifi0"].forEach(function(v){
       //       $("form").append('<input type="hidden"  name="cbid.wireless.'+v+'.rts" value="'+wifi0_rts_value+'">');          
       // });
       // for(var i in rtsTable["wifi0"]){
       //  var v = rtsTable["wifi0"][i];
       //  $("form").append('<input type="hidden"  name="cbid.wireless.'+v+'.rts" value="'+wifi0_rts_value+'">'); 
       // }

       // var wifi1_rts_value = $('input:text[name="cbid.wireless.wifi1.rts"]').val();       
       // rtsTable["wifi1"].forEach(function(v){
       //       $("form").append('<input type="hidden"  name="cbid.wireless.'+v+'.rts" value="'+wifi1_rts_value+'">');          
       // });    
       // for(var i in rtsTable["wifi1"]){
       //  var v = rtsTable["wifi1"][i];
       //  $("form").append('<input type="hidden"  name="cbid.wireless.'+v+'.rts" value="'+wifi1_rts_value+'">'); 
       // }                  
        /*disabled the options  of unset mode*/   
        $('select[name$="opmode"]').each(function(){
            var opmode = $(this).val();
            var devName = $(this).attr("name").split(".")[2];

            for(var i in ifaceTable[devName]){
                for(var j in ifaceTable[devName][i]){
                    if(opmode != i){
                        $("#"+ifaceTable[devName][i][j]).find("*").attr("disabled",true);
                    }
                } 
            }  
            // /*handle guestNetwork*/
            if(opmode == "ap" || opmode == "wds_ap"){
                $("#"+guest_name_Table[devName]).find("*").attr("disabled",false);  
            }else{
                $("#"+guest_name_Table[devName]).find("*").attr("disabled",true);  
            }
        });
        /*disabled the options  of unset mode*/   
        $('#cbi_set').find("*").each(function(){
            $(this).attr("disabled",true);
        });

        //---------check if channel not support----------------------
        
        //JAPAN support channel 14 only for 11b
        if($('select[name="cbid.wireless.wifi0.country"]').val() == '<%=JAPAN_COUNTRY_ID%>'){
            if($('select[name="cbid.wireless.wifi0.hwmode"]').val() != '11b'){
                support_channel2G = support_channel2G.substring(0,support_channel2G.indexOf("14")-1);
            }
        }
        var url1, data1;
        url1 = '<%=luci.dispatcher.build_url("admin/network/ajax_checkChannel")%>';
        //container = "#cbi_set";
<% if WLAN5G_2=="1" then --[[ #### WLAN5G_2 feature ### --]] %>
        data1 = {support_channel2G:support_channel2G,support_channel5G:support_channel5G,support_channel52G:support_channel52G,country_change_chan:$("input[name='country_change_chan']").val()};
<%else%>
        data1 = {support_channel2G:support_channel2G,support_channel5G:support_channel5G,country_change_chan:$("input[name='country_change_chan']").val()};
<% end --[[ #### WLAN5G_2 feature end ### --]] %>
        $.ajax({
            async: false,
            type : "GET",
            url:url1,
            data:data1,
            dataType:"json",
            error:function(){
                //console.log("ajax_checkChannel error");
            },
            success:function(result){
                //console.log("ajax_checkChannel success");
            }
        });

        //--------- check channel is support in selected opmode----------------------
        var url2, data2;
        url2 = '<%=luci.dispatcher.build_url("admin/network/ajax_checkOpmode")%>';
<% if WLAN5G_2=="1" then --[[ #### WLAN5G_2 feature ### --]] %>
        data2 = {support_channel2G:support_channel2G.split(",")[0],support_channel5G:support_channel5G.split(",")[0],support_channel52G:support_channel52G.split(",")[0],opmode_2G:$("select[name$='wifi0.opmode']").val(),opmode_5G:$("select[name$='wifi1.opmode']").val(),opmode_52G:$("select[name$='wifi2.opmode']").val(),country_change_chan:$("input[name='country_change_chan']").val()};
<%else%>
        data2 = {support_channel2G:support_channel2G.split(",")[0],support_channel5G:support_channel5G.split(",")[0],opmode_2G:$("select[name$='wifi0.opmode']").val(),opmode_5G:$("select[name$='wifi1.opmode']").val(),country_change_chan:$("input[name='country_change_chan']").val()};
<% end --[[ #### WLAN5G_2 feature end ### --]] %>
        $.ajax({
            async: false,
            type : "GET",
            url:url2,
            data:data2,
            dataType:"json",
            error:function(){
                 //console.log("ajax_checkOpmode error");
            },
            success:function(result){
                 //console.log("ajax_checkOpmode success");
            }
        });

        var greenmode0_checked = ($('input[type="checkbox"][name$="wifi0.obeyregpower"]').is(':checked')) ? "1" : "0" ;
        var greenmode1_checked = ($('input[type="checkbox"][name$="wifi1.obeyregpower"]').is(':checked')) ? "1" : "0" ;
        var greenmode2_checked = ($('input[type="checkbox"][name$="wifi2.obeyregpower"]').is(':checked')) ? "1" : "0" ;
<% if (uci:get("functionlist","functionlist","SUPPORT_WLAN24G"))=="1" then %>
        if ($("select[name$='country']").val() != "<%=uci:get('wireless','wifi0','country')%>" || greenmode0_checked != "<%=uci:get('wireless','wifi0','obeyregpower')%>" || greenmode1_checked != "<%=uci:get('wireless','wifi1','obeyregpower')%>" || greenmode2_checked != "<%=uci:get('wireless','wifi2','obeyregpower')%>" || $("select[name$='wifi0.htmode']").val() != "<%=uci:get('wireless','wifi0','htmode')%>" || $("select[name$='wifi1.htmode']").val() != "<%=uci:get('wireless','wifi1','htmode')%>" || $("select[name$='wifi2.htmode']").val() != "<%=uci:get('wireless','wifi2','htmode')%>")
<% else %>
        if ($("select[name$='country']").val() != "<%=uci:get('wireless','wifi1','country')%>" || greenmode0_checked != "<%=uci:get('wireless','wifi0','obeyregpower')%>" || greenmode1_checked != "<%=uci:get('wireless','wifi1','obeyregpower')%>" || greenmode2_checked != "<%=uci:get('wireless','wifi2','obeyregpower')%>" || $("select[name$='wifi0.htmode']").val() != "<%=uci:get('wireless','wifi0','htmode')%>" || $("select[name$='wifi1.htmode']").val() != "<%=uci:get('wireless','wifi1','htmode')%>" || $("select[name$='wifi2.htmode']").val() != "<%=uci:get('wireless','wifi2','htmode')%>")
<% end %>
        {

            //--------- update channel for cli ----------------------
            var url3;
            url3 = '<%=luci.dispatcher.build_url("admin/network/ajax_channel_for_cli")%>';
            $.ajax({
                async: false,
                type : "GET",
                url:url3,
                dataType:"json",
                error:function(){
                    //console.log("ajax_channel_for_cli error");
                },
                success:function(result){
                    //console.log("ajax_channel_for_cli success");
                }
            });  
        }      
    });  /* form submit check end */

    if ("<%=uci:get("functionlist","functionlist","SUPPORT_COUNTRY_SETTING")%>" == "1"){
        $('tr[name="country"]').show();
        if(reg_domain=="2" && $('select[name="cbid.wireless.wifi0.country"]').find('option:selected').val() == '00'){
            alert("<%:Please select the country where you use, to comply with local telecommunications law norms.%>");
        }
    };

    if ( reg_domain=="0" && support_myid=="1" ){
        $('tr[name="country"]').show();
    };

    if ("<%=uci:get("functionlist","functionlist","SUPPORT_TX_POWER_SETTING")%>" == "1"){
       $('tr[name="transmitpower"]').show();
    };

if(functionlist.SUPPORT_ETHERNET_BONDING==1){
    get_lacp_mut_status();
}

    if("<%=disabled_radio2G%>" == "1"){
        $("#wifi0_tbl input[name$='disabled'],#wifi0_guest input[name$='disabled']").each(function(){
            $(this).prop("disabled",true);
        });
    }
    if("<%=disabled_radio5G%>" == "1"){
        $("#wifi1_tbl input[name$='disabled'],#wifi1_guest input[name$='disabled']").each(function(){
            $(this).prop("disabled",true);
        });
    }
<% if WLAN5G_2=="1" then --[[ #### WLAN5G_2 feature ### --]] %>
    if("<%=disabled_radio52G%>" == "1"){
        $("#wifi2_tbl input[name$='disabled'],#wifi2_guest input[name$='disabled']").each(function(){
            $(this).prop("disabled",true);
        });
    }
<% end --[[ #### WLAN5G_2 feature end ### --]] %>
});
function updateChanges()
{
	setTimeout(function()
	{
		XHR.get('<%=luci.dispatcher.build_url("admin", "uci", "changes_amount")%>', null,
				function(x, j)
				{
					if(x.responseText)
					{
						var c = getById('changes_amount');
						if(c)
						{
							c.innerHTML = x.responseText.trim();
						}

						if ( x.responseText.trim() > 0 )
						{
							$('#save_apply_float_window').show();
							c = getById('save_apply_float_window_changes');
							if(c)
							{
								c.innerHTML = "("+x.responseText.trim()+")";
							}
						}
					}
				}
		);
	}, 500);
}

function updateOption(networkName,option,value)                       
{
    var ssid_mgmt = ((networkName=="wifi0_mgmt" || networkName=="wifi1_mgmt")?true:false);
    if(ssid_mgmt){
        if(option == "mgmtKey"){
            $('input:hidden[name$="wireless.wifi_mgmt.key"]').val(value)
        }
    }

    var ssid_enjet = (networkName=="wifi1_enjet"?true:false);
    if(ssid_enjet)
    {
        var encr = "cbi-wireless-wifix_ssid_tdma_1-"+option+"_view";
    }
    else
    {
        var encr = "cbi-wireless-"+networkName+"-"+option+"_view";
    }

    var c = $('#'+encr);                                                                    
    if(c)                                                                                   
    {                                                                                                                                                                                                                     
        var encr_str = (option.indexOf("encryption")>-1)?value.trim().replace(/"/g,""):value;
        if(option.indexOf("encryption")>-1){                                                 
            c.text(showEncryption(encr_str));                                                
            checkPureN();                                                                    
        }else{                                                                               
            c.find(':text').val(encr_str);                                                   
        }                                                                                    
                                                                                                                        
    }

    if ( (networkName.match("_ssid_") != null) || ssid_enjet)
    {
        if(ssid_enjet)
        {
            var combimedSSID_name = "cbid.wireless.wifix_ssid_tdma_1.ssid";
        }
        else
        {
            var combimedSSID_name = "cbid.wireless.wifix_ssid_"+networkName.slice(-1)+".ssid";
        }
        var combimedSSID_c = $('#'+combimedSSID_name);
        if(combimedSSID_c){
            var combined_ssid_str = (option.indexOf("ssid")>-1)?value.trim():value;
            if(option.indexOf("ssid")>-1){
                $('input[name="'+combimedSSID_name+'"]').val(combined_ssid_str);
            }
        }
    }
    
     if(ssid_enjet)
     {
        var combimedEncr_id = "cbi-wireless-wifix_ssid_tdma_1-encryption_view";
     }
     else
     {
        var combimedEncr_id = "cbi-wireless-wifix_ssid_"+networkName.slice(-1)+"-encryption_view";
     }

     
     var combimedEncr_c = $('#'+combimedEncr_id);
     if(combimedEncr_c){
        var combined_encr_str = (option.indexOf("encryptionCOMBINED")>-1)?value.trim().replace(/"/g,""):value;
        if(option.indexOf("encryptionCOMBINED")>-1){
            if(ssid_enjet)
            {
                var encr_com_str = "cbi-wireless-wifix_ssid_tdma_1-encryption_view";
            }
            else
            {
                var encr_com_str = "cbi-wireless-wifix_ssid_"+networkName.slice(-1)+"-encryption_view";
            }
            $('#'+encr_com_str).text(showEncryption(combined_encr_str));
        }
     }

    var isolation  = (option.indexOf("isolation")>-1)?value.trim().replace(/"/g,""):value;

    if(option.indexOf("isolation")>-1)
    {
        isolation_enable = isolation;
    }
     //sync vlan id
     if(ssid_enjet)
     {
        var vlanID_id = "cbi-wireless-wifix_ssid_tdma_1-vlan_id_view";
     }
     else
     {
        var vlanID_id = "cbi-wireless-wifix_ssid_"+networkName.slice(-1)+"-vlan_id_view";
     }
     var vlanID_c = $('#'+vlanID_id);
     if(vlanID_c){

        var vlanID = (option.indexOf("vlanid_ap")>-1)?value.trim().replace(/"/g,""):value;

        if(option.indexOf("vlanid_ap")>-1){

            if(isolation_enable == 0 )
            {
                $('#'+vlanID_id).children().text("-");
                tmp_vlanid[networkName.slice(-1)-1] = -1;
            }
            else
            {
                if(ssid_enjet)
                {
                    var name = "cbid.wireless.wifix_ssid_tdma_1.guest_network";
                }
                else
                {
                    var name = "cbid.wireless.wifix_ssid_"+networkName.slice(-1)+".guest_network";
                }
                if($('input[type="checkbox"][name="'+ name+'"]').is(':checked'))
                {
                    $('#'+vlanID_id).children().text("-");
                    tmp_vlanid[networkName.slice(-1)-1] = vlanID;
                }
                else
                {
                    $('#'+vlanID_id).children().text(vlanID);
                    tmp_vlanid[networkName.slice(-1)-1] = vlanID;
                }
            }
        }
     }
     
     if(ssid_enjet)
     {
        var vlanID_id_wds = "cbi-wireless-wifix_ssid_tdma_1-vlan_id_view";
     }
     else
     {
        var vlanID_id_wds = "cbi-wireless-"+networkName+"-vlan_id_view";
     }
     var vlanID_c_wds = $('#'+vlanID_id_wds);

     if(vlanID_c_wds){
        var vlanID_wds = (option.indexOf("vlanid_wds")>-1)?value.trim().replace(/"/g,""):value;      
        if(option.indexOf("vlanid_wds")>-1){
            if(isolation_enable == 0)
            {
                $('#'+vlanID_id_wds).children().text("-");
            }
            else
            {
                $('#'+vlanID_id_wds).children().text(vlanID_wds);
            }
        }
     }

    
    //sync radio checkbox
    var dis2G_name = "wireless.wifi0_ssid_"+networkName.slice(-1)+".disabled";
    var dis2G_c = $('input[name="'+dis2G_name+'"]');
    if(dis2G_c){
        var dis2G = (option.indexOf("dis2G")>-1)?value.trim().replace(/"/g,""):value;
        if(option.indexOf("dis2G")>-1){
            $('input[type="checkbox"][name="'+dis2G_name+'"]').prop("checked",dis2G=="0"?true:false);
        }
    }

    var dis5G_name = "wireless.wifi1_ssid_"+networkName.slice(-1)+".disabled";
    var dis5G_c = $('input[name="'+dis5G_name+'"]');
    if(dis5G_c){
        var dis5G = (option.indexOf("dis5G")>-1)?value.trim().replace(/"/g,""):value;
        if(option.indexOf("dis5G")>-1){
            $('input[type="checkbox"][name="'+dis5G_name+'"]').prop("checked",dis5G=="0"?true:false);
        }
    }
    
    <% if uci:get('functionlist','functionlist','SUPPORT_WLAN5G_2') == "1" then %>
    var dis52G_name = "wireless.wifi2_ssid_"+networkName.slice(-1)+".disabled";
    var dis52G_c = $('input[name="'+dis52G_name+'"]');
    if(dis52G_c){
         var dis52G = (option.indexOf("dis52G")>-1)?value.trim().replace(/"/g,""):value;
         if(option.indexOf("dis52G")>-1){
            $('input[type="checkbox"][name="'+dis52G_name+'"]').prop("checked",dis52G=="0"?true:false);
        }
    }
    <% end %>
    
}
function checkPureN()
{
    var encr_2_4g_wep_tkip = 0;
    var encr_5g_wep_tkip = 0;
    
    $('#wifi0_tbl,#wifi0_guest').find('*').each(function(){
        if($(this).is(":visible") && $(this).attr("id") && $(this).attr("id").indexOf("encryption") >-1){
            if ($(this).parent().prev().find('input').is(":enabled")){
                if($(this).text() && ($(this).text().indexOf("WEP") > -1 || $(this).text().indexOf("TKIP") > -1)){
                    encr_2_4g_wep_tkip = 1;
                    return false;
                }
            }
        }
    });
    $('#wifi1_tbl,#wifi1_guest').find('*').each(function(){
        if($(this).is(":visible") && $(this).attr("id") && $(this).attr("id").indexOf("encryption")>-1){
            if ($(this).parent().prev().find('input').is(":enabled")){
                if($(this).text() && ($(this).text().indexOf("WEP")>-1 || $(this).text().indexOf("TKIP")>-1)){
                    encr_5g_wep_tkip = 1;
                    return false;
                }
            }
        }
    });
<% if WLAN5G_2 == '1' then --[[ #### WLAN5G_2 feature ### --]] %>
    var encr_5g_2_wep_tkip = 0;
    $('#wifi2_tbl,#wifi2_guest').find('*').each(function(){
        if($(this).is(":visible") && $(this).attr("id") && $(this).attr("id").indexOf("encryption")>-1){
            if ($(this).parent().prev().find('input').is(":enabled")){
                if($(this).text() && ($(this).text().indexOf("WEP")>-1 || $(this).text().indexOf("TKIP")>-1)){
                    encr_5g_2_wep_tkip = 1;
                    return false;
                }
            }
        }
    });
    (encr_5g_2_wep_tkip == 0)?hide_option("wifi2.hwmode","11n","show"):hide_option("wifi2.hwmode","11n","hide");
<% end --[[ #### WLAN5G_2 feature ### end --]] %>

    (encr_2_4g_wep_tkip == 0)?hide_option("wifi0.hwmode","11n","show"):hide_option("wifi0.hwmode","11n","hide");    
    (encr_5g_wep_tkip == 0)?hide_option("wifi1.hwmode","11n","show"):hide_option("wifi1.hwmode","11n","hide");
    $('select[name$=".hwmode"]').each(function(){$(this).triggerHandler('change')});

}
<% if WLAN5G_2=="1" then --[[ #### WLAN5G_2 feature ### --]] %>
function updateSSIDDisable(value2G,value5G,value52G,status2G,status5G,status52G)
{
    var alldisable2G = "1";
    var alldisable5G = "1";
    var alldisable52G = "1";
   
    if (value2G == 1) {
        $("#wifi0_tbl input[name$='disabled'],#wifi0_guest input[name$='disabled']").each(function(){
            if ($(this).is(':checked')){
                $(this).trigger('click');
            }
            $(this).attr("disabled","disabled");
        });
    }
    else{
        $("#wifi0_tbl input[name$='disabled']").each(function(){
            if ($(this).is(':checked')){
                alldisable2G = "0";
            }
        })
        if (alldisable2G == "1"){
            $("#wifi0_tbl input[name$='disabled'],#wifi0_guest input[name$='disabled']").each(function(){
                $(this).prop("disabled",false);
            });
            if (status2G != ""){
                for (i=0;i<status2G.split(',').length;i++){
                    $("#wifi0_tbl input[name$='"+status2G.split(',')[i]+".disabled']").prop({checked:true}).triggerHandler('click');
                    if (status2G.split(',')[i] == "wifi0_guest"){
                        $("#wifi0_guest input[name$='"+status2G.split(',')[i]+".disabled']").prop({checked:true}).triggerHandler('click');
                    }
                }
            }
        }
    };

    if (value5G == 1) {
        $("#wifi1_tbl input[name$='disabled'],#wifi1_guest input[name$='disabled']").each(function(){
            if ($(this).is(':checked')){
                $(this).trigger('click');
            }
            $(this).attr("disabled","disabled");
        })
    }
    else{
        $("#wifi1_tbl input[name$='disabled']").each(function(){
            if ($(this).is(':checked')){
                alldisable5G = "0";
            }
        })
        if (alldisable5G == "1"){
            $("#wifi1_tbl input[name$='disabled'],#wifi1_guest input[name$='disabled']").each(function(){
                $(this).prop("disabled",false);
            });
            if (status5G != ""){
                for (i=0;i<status5G.split(',').length;i++){
                    $("#wifi1_tbl input[name$='"+status5G.split(',')[i]+".disabled']").prop({checked:true}).triggerHandler('click');
                    if (status5G.split(',')[i] == "wifi1_guest"){
                        $("#wifi1_guest input[name$='"+status5G.split(',')[i]+".disabled']").prop({checked:true}).triggerHandler('click');
                    }
                }
            }
        }
    };
    if (value52G == 1) {
        $("#wifi2_tbl input[name$='disabled'],#wifi2_guest input[name$='disabled']").each(function(){
            if ($(this).is(':checked')){
                $(this).trigger('click');
            }
            $(this).attr("disabled","disabled");
        })
    }
    else{
        $("#wifi2_tbl input[name$='disabled']").each(function(){
            if ($(this).is(':checked')){
                alldisable52G = "0";
            }
        })
        if (alldisable52G == "1"){
            $("#wifi2_tbl input[name$='disabled'],#wifi2_guest input[name$='disabled']").each(function(){
                $(this).prop("disabled",false);
            });
            if (status52G != ""){
                for (i=0;i<status52G.split(',').length;i++){
                    $("#wifi2_tbl input[name$='"+status52G.split(',')[i]+".disabled']").prop({checked:true}).triggerHandler('click');
                    if (status52G.split(',')[i] == "wifi2_guest"){
                        $("#wifi2_guest input[name$='"+status52G.split(',')[i]+".disabled']").prop({checked:true}).triggerHandler('click');
                    }
                }
            }
        }
    };    
}
<%else%>
function updateSSIDDisable(value2G,value5G,status2G,status5G)
{
    var alldisable2G = "1";
    var alldisable5G = "1";
    if (value2G == 1) {
        $("#wifi0_tbl input[name$='disabled'],#wifi0_guest input[name$='disabled']").each(function(){
            if ($(this).is(':checked')){
                $(this).trigger('click');
            }
            $(this).attr("disabled","disabled");
        });
    }
    else{
        $("#wifi0_tbl input[name$='disabled']").each(function(){
            if ($(this).is(':checked')){
                alldisable2G = "0";
            }
        })
        if (alldisable2G == "1"){
            $("#wifi0_tbl input[name$='disabled'],#wifi0_guest input[name$='disabled']").each(function(){
                $(this).prop("disabled",false);
            });
            if (status2G != ""){
                for (i=0;i<status2G.split(',').length;i++){
                    $("#wifi0_tbl input[name$='"+status2G.split(',')[i]+".disabled']").prop({checked:true}).triggerHandler('click');
                    if (status2G.split(',')[i] == "wifi0_guest"){
                        $("#wifi0_guest input[name$='"+status2G.split(',')[i]+".disabled']").prop({checked:true}).triggerHandler('click');
                    }
                }
            }
        }
    };

    if (value5G == 1) {
        $("#wifi1_tbl input[name$='disabled'],#wifi1_guest input[name$='disabled']").each(function(){
            if ($(this).is(':checked')){
                $(this).trigger('click');
            }
            $(this).attr("disabled","disabled");
        })
    }
    else{
        $("#wifi1_tbl input[name$='disabled']").each(function(){
            if ($(this).is(':checked')){
                alldisable5G = "0";
            }
        })
        if (alldisable5G == "1"){
            $("#wifi1_tbl input[name$='disabled'],#wifi1_guest input[name$='disabled']").each(function(){
                $(this).prop("disabled",false);
            });
            if (status5G != ""){
                for (i=0;i<status5G.split(',').length;i++){
                    $("#wifi1_tbl input[name$='"+status5G.split(',')[i]+".disabled']").prop({checked:true}).triggerHandler('click');
                    if (status5G.split(',')[i] == "wifi1_guest"){
                        $("#wifi1_guest input[name$='"+status5G.split(',')[i]+".disabled']").prop({checked:true}).triggerHandler('click');
                    }
                }
            }
        }
    };
}
<% end --[[ #### WLAN5G_2 feature end ### --]] %>
function country_has_changed_chan()
{
    $("input[name='country_change_chan']").val("1");
}
<% if WLAN5G_2=="1" then --[[ #### WLAN5G_2 feature ### --]] %>
function auto_channel_setting(settings,enable_flag2G,enable_flag5G, enable_flag52G)
{
    $('form[name="wifiChannel"]').remove();
    $('form').before(settings);
    $('form[name="wifiChannel"]').hide();
    $("input[name='save_auto_chan']").val("1");
    $("input[name='iface_status2G']").val(enable_flag2G);
    $("input[name='wireless.wifi0.channel_config_enable']").val($("input[name='channel_enable2G']").val());
    $("input[name='wireless.wifi0.channel']").val($("input[name='channel2G']").val());
    $("input[name='wireless.wifi0.channel_config_list']").val($("input[name='channel_list2G']").val());
    $("input[name='wireless.wifi0.channel_config_status']").val($("input[name='channel_status2G']").val());
    $("input[name='wireless.wifi0.channel_config_group']").val($("input[name='channel_group2G']").val());
    $("input[name='iface_status5G']").val(enable_flag5G);
    $("input[name='wireless.wifi1.channel_config_enable']").val($("input[name='channel_enable5G']").val());
    $("input[name='wireless.wifi1.channel']").val($("input[name='channel5G']").val());
    $("input[name='wireless.wifi1.channel_config_list']").val($("input[name='channel_list5G']").val());
    $("input[name='wireless.wifi1.channel_config_status']").val($("input[name='channel_status5G']").val());
    $("input[name='wireless.wifi1.channel_config_group']").val($("input[name='channel_group5G']").val());
    $("input[name='iface_status52G']").val(enable_flag5G);
    $("input[name='wireless.wifi2.channel_config_enable']").val($("input[name='channel_enable52G']").val());
    $("input[name='wireless.wifi2.channel']").val($("input[name='channel52G']").val());
    $("input[name='wireless.wifi2.channel_config_list']").val($("input[name='channel_list52G']").val());
    $("input[name='wireless.wifi2.channel_config_status']").val($("input[name='channel_status52G']").val());
    $("input[name='wireless.wifi2.channel_config_group']").val($("input[name='channel_group52G']").val());
}
<%else%>
function auto_channel_setting(settings,enable_flag2G,enable_flag5G)
{
    $('form[name="wifiChannel"]').remove();
    $('form').before(settings);
    $('form[name="wifiChannel"]').hide();
    $("input[name='save_auto_chan']").val("1");
    $("input[name='iface_status2G']").val(enable_flag2G);
    $("input[name='wireless.wifi0.channel_config_enable']").val($("input[name='channel_enable2G']").val());
    $("input[name='wireless.wifi0.channel']").val($("input[name='channel2G']").val());
    $("input[name='wireless.wifi0.channel_config_list']").val($("input[name='channel_list2G']").val());
    $("input[name='wireless.wifi0.channel_config_status']").val($("input[name='channel_status2G']").val());
    $("input[name='wireless.wifi0.channel_config_group']").val($("input[name='channel_group2G']").val());
    $("input[name='iface_status5G']").val(enable_flag5G);
    $("input[name='wireless.wifi1.channel_config_enable']").val($("input[name='channel_enable5G']").val());
    $("input[name='wireless.wifi1.channel']").val($("input[name='channel5G']").val());
    $("input[name='wireless.wifi1.channel_config_list']").val($("input[name='channel_list5G']").val());
    $("input[name='wireless.wifi1.channel_config_status']").val($("input[name='channel_status5G']").val());
    $("input[name='wireless.wifi1.channel_config_group']").val($("input[name='channel_group5G']").val());
}
<% end --[[ #### WLAN5G_2 feature end ### --]] %> 

function showfake(type, val, width)
{
	width = width || 60;
	type = type || "";
	val = val || "";
	var s="";
	switch(type)
	{
		case "select":
			s += '<select name="" id="" style="width: 150px;">' +
					'<option value="' + val + '">' + val + '</option>' +
					'</select>';
			break;
		case "radio":
			s += '<input type="radio" ' + ((val == 1) ? "checked" : "") + ' />&nbsp;<label for=""><%:Enable%></label>&nbsp;&nbsp;&nbsp;' +
					'<input type="radio" ' + ((val == 0) ? "checked" : "") + '/>&nbsp;<label for=""><%:Disable%></label>';
			break;
		case "input":
			s += "<input type=\"text\" style=\"width: "+ width +"px;\" value='"+ val +"'/>";
			break;
		default:
			s += '<img src="<%=resource%>/icons/loading.gif" alt="<%:Loading%>" style="vertical-align:middle" />';
			break;
	}
	
	document.write("<div class=\"\">" + s + "</div>");
    document.close();
}
function showCountryList()
{
    var s = "", v, k;
    var j = $.parseJSON('<%=luci.http.write_json(ntm:get_countrylist())%>');
    var country_list = [];
    var name_value = {};
    var countryInList = false;
    for (var i in j){
        country_list.push(j[i]);
        name_value[j[i]] = i;
    }
    country_list.sort();

    <% if uci:get("functionlist","functionlist","SUPPORT_ATKK_FW_VERSION") == '1' then %>
        var selectableList = $.parseJSON('<%=luci.http.write_json(ntm:get_countrySelectableList())%>');
    <% end %>

    for(k in country_list)
    {
        country_name = country_list[k];
    <% if uci:get("functionlist","functionlist","SUPPORT_ATKK_FW_VERSION") == '1' then %>
        if (selectableList[name_value[country_name]]=="disabled")
        {
            s += '<option id="cbi-wireless-wifi0-country-'+name_value[country_name]+'" value="'+name_value[country_name]+'" disabled="disabled">'+country_name+'</option>';
        }
        else
    <% end %>
        {
            s += '<option id="cbi-wireless-wifi0-country-'+name_value[country_name]+'" value="'+name_value[country_name]+'">'+country_name+'</option>';
        }
    <% if (uci:get('functionlist', 'functionlist', 'SUPPORT_WLAN24G') == '1') then %>
        if("<%=uci:get('wireless', 'wifi0', 'country')%>" == name_value[country_name])
            countryInList = true;
    <% else %>
        if("<%=uci:get('wireless', 'wifi1', 'country')%>" == name_value[country_name])
            countryInList = true;
    <% end %>
    }
    s += '</select>';
<% if (uci:get('functionlist', 'functionlist', 'SUPPORT_WLAN24G') == '1') then %>
    if(('00' == "<%=uci:get('wireless', 'wifi0', 'country')%>") || !countryInList)
<% else %>
    if(('00' == "<%=uci:get('wireless', 'wifi1', 'country')%>") || !countryInList)
<% end %>
    {
        s = '<option value="00"><%:Please select the country%></option>' + s;
    }
    s = '<select size="1" name="cbid.wireless.wifi0.country" id="cbid.wireless.wifi0.country" class="cbi-input-select">' + s;
    
    document.write(s);
<% if (uci:get('functionlist', 'functionlist', 'SUPPORT_WLAN24G') == '1') then %>
    getById('cbid.wireless.wifi0.country').value = countryInList? "<%=uci:get('wireless', 'wifi0', 'country')%>":"00";
<% else %>
    getById('cbid.wireless.wifi0.country').value = countryInList? "<%=uci:get('wireless', 'wifi1', 'country')%>":"00";
<% end %>
    document.close();
}
function checkmesh()
{
    var ssid_num = 0;
<%
    if uci:get('functionlist','functionlist','SUPPORT_MESH_SETTING') == "1" and uci:get('mesh','wifi','disabled')== "0" then
%>
    if($("select[name='cbid.wireless.wifi0.opmode']").val() != "ap" || $("select[name='cbid.wireless.wifi1.opmode']").val() != "ap")
        alert("<%:The mesh function will be disabled.%>");
    else if( "<%=uci:get('mesh','wifi','mode')%>" == "mesh_point" && "<%=uci:get('wireless','wifi0_mesh','disabled')%>" == "0" )
    {
<% for i,v in pairs(wifi_all_net["wifi0"]["ap"]) do %>
        if("<%=v:name()%>" == "wifi0_guest")
        {
<% if uci:get('functionlist','functionlist','SUPPORT_GUEST_NETWORK_SETTING') == '1' then %>
            if( document.getElementsByName('wireless.<%=v:name()%>.disabled')[0] != undefined && document.getElementsByName('wireless.<%=v:name()%>.disabled')[0].checked == true )
            {
                ssid_num++;
            }
<% end %>
        }
        else
        {
            if( document.getElementsByName('wireless.<%=v:name()%>.disabled')[0] != undefined && document.getElementsByName('wireless.<%=v:name()%>.disabled')[0].checked == true)
            {
                ssid_num++;
            }
        }
<% end %>
        if(ssid_num != 0)
        {
            document.getElementsByName('mesh_point_to_ap')[0].value = "1";
            alert('<%=translatef("System will change the operation mode from %s to %s", "\"Mesh Point\"", "\"Mesh AP\"")%>');
        }
    }
    else if( "<%=uci:get('mesh','wifi','mode')%>" == "mesh_point" && "<%=uci:get('wireless','wifi1_mesh','disabled')%>" == "0" )
    {
<% for i,v in pairs(wifi_all_net["wifi1"]["ap"]) do %>
        if("<%=v:name()%>" == "wifi1_guest")
        {
<% if uci:get('functionlist','functionlist','SUPPORT_GUEST_NETWORK_SETTING') == '1' then %>
            if(document.getElementsByName('wireless.<%=v:name()%>.disabled')[0] != undefined && document.getElementsByName('wireless.<%=v:name()%>.disabled')[0].checked == true)
            {
                ssid_num++;
            }
<% end %>
        }
        else
        {
            if(document.getElementsByName('wireless.<%=v:name()%>.disabled')[0] != undefined && document.getElementsByName('wireless.<%=v:name()%>.disabled')[0].checked == true)
            {
                ssid_num++;
            }
        }
<% end %>
        if(ssid_num != 0)
        {
            document.getElementsByName('mesh_point_to_ap')[0].value = "1";
            alert('<%=translatef("System will change the operation mode from %s to %s", "\"Mesh Point\"", "\"Mesh AP\"")%>');
        }
    }
<%
    end
%>
}
</script>
<div id="Guest_Network_Settings_info" class="popbox">
    <p><%:This configuration allows segregate temporary guest WiFi usage with individual SSID, security, and DHCP settings.%></p>
</div>
<div id="Fast_Handover_info" class="popbox">
    <p><%:When a weakening wireless link between Access Point and client is detected below specified RSSI, the AP will encourage client to connect to the surrounding AP with stronger signal.%></p>
</div>
<div id="Management_VLAN_Settings_info" class="popbox">
    <p><%:If the feature is enabled with specified VLAN ID, the device will only allow management access with the same specified VLAN ID.%></p>
</div>
<div id="RTS_CTS_Threshold" class="popbox">
    <p><%:This is to specify threshold packet size for RTS/CTS; a small number may cause RTS/CTS frames to be sent more often and consume more bandwidth.%></p>
</div>
<div id="Aggregation_info" class="popbox">
    <p><%:For enhanced transmit efficiency, it can merge multiple data frames upon specified number of frames or bytes into one aggregated frame for transmission on 2.4GHz.%></p>
</div>
<div id="Client_Isolation_info" class="popbox">
    <p><%:Block the communication between the associated clients under the same WLAN.%></p>
</div>
<div id="VLAN_Isolation_info" class="popbox">
    <p><%:When this option is checked with specified VLAN ID in a SSID profile, the traffics from this SSID will be tagged with this VLAN ID upon entering LAN bridge.%></p>
</div>
<div id="MtoUSC_enable_info" class="popbox">
    <p class="popper"><%:Unicast conversion method allows a WLAN AP to have a direct relationship with each client to transmit original multicast-like traffics on a one-to-one basis, establishing individual sessions between the transmission server and each client.  This method will add additional bandwidth overhead on the unicast server upon each additional client.%></p>
</div>
<div id="MtoUSC_disable_info" class="popbox">
    <p><%:Multicast transmission is a one-to-many group communication methodology in which a WLAN AP forwards all broadcast traffics from a multicast source to a client subnet where multiple client devices are listening.%></p>
</div>
<% if uci:get('functionlist','functionlist', 'SUPPORT_MIN_RATE_SETTING') == '1' then%>
<div id="Bit_Rate_info" class="popbox">
    <p><%:Data frames will be sent out at the lowest selected rate. Client devices must use either the lowest selected rate or a faster one.%></p>
</div>
<% end %>
<% if uci:get('functionlist','functionlist','SUPPORT_ENJET') == '1' then %>
<div id="Enjet_info" class="popbox">
    <p><%:Enable the EnGenius EnJet system. Your AP can then transmit data more efficiently, avoid collisions, and reduce latency and packet losses. (If you do not enable EnJet, data will be sent via traditional CSMA.)%></p>
</div>
<div id="aptimeslot_info" class="popbox">
    <p><%:In EnJet mode, the AP will assign time slots for each client’s data transmission. The larger the slot, the faster the data transmission.%></p>
</div>
<div id="stationpriority_info" class="popbox">
    <p><%:In EnJet mode, the client bridge/WDS station’s data transmission is prioritized by data. High level means a longer transmission time. (The time ratio is 10:5:1.)%></p>
</div>
<% end %>
<% if uci:get('functionlist','functionlist','SUPPORT_MANAGEMENT_SSID') == '1' then %>
<div id="management_interface_info" class="popbox">
    <p><%:Management SSID will be turned off when the setting is done and idle in 15 minutes. If you need to turn on please reboot the device.%></p>
</div>
<% end %>
<form method="post" name="cbi"  action="<%=REQUEST_URI%>">
<input type="hidden" name="saveApply">
<input type="hidden" name="wireless.wifi_mgmt.key">
<input type="hidden" name="cbid.dhcp.guest.ignore">
<input type="hidden" value="0" name="mesh_point_to_ap">
<input type="hidden" value="1" name="bs_check_wifi0">
<input type="hidden" value="1" name="bs_check_wifi1">
<input type="hidden" value="1" name="bs_check_wifi2">
<input type="hidden" value="0" name="save_auto_chan"/>
<input type="hidden" value="1" name="country_change_chan">
<input type="hidden" name="disable_radio2G">
<input type="hidden" value="<%=wifi_status["2G"]%>" name="iface_status2G">
<input type="hidden" name="wireless.wifi0.channel_config_enable">
<input type="hidden" name="wireless.wifi0.channel">
<input type="hidden" name="wireless.wifi0.channel_config_list">
<input type="hidden" name="wireless.wifi0.channel_config_status">
<input type="hidden" name="wireless.wifi0.channel_config_group">
<input type="hidden" name="disable_radio5G">
<input type="hidden" value="<%=wifi_status["5G"]%>" name="iface_status5G">
<input type="hidden" name="wireless.wifi1.channel_config_enable">
<input type="hidden" name="wireless.wifi1.channel">
<input type="hidden" name="wireless.wifi1.channel_config_list">
<input type="hidden" name="wireless.wifi1.channel_config_status">
<input type="hidden" name="wireless.wifi1.channel_config_group">
<% if WLAN5G_2=="1" then --[[ #### WLAN5G_2 feature ### --]] %>
    <input type="hidden" name="disable_radio52G">
    <input type="hidden" value="<%=wifi_status["52G"]%>" name="iface_status52G">
    <input type="hidden" name="wireless.wifi2.channel_config_enable">
    <input type="hidden" name="wireless.wifi2.channel">
    <input type="hidden" name="wireless.wifi2.channel_config_list">
    <input type="hidden" name="wireless.wifi2.channel_config_status">
    <input type="hidden" name="wireless.wifi2.channel_config_group">
<% end %>
<% if WLAN5G == '1' then --[[ #### WLAN5G START ### --]] %>
    <input type="hidden" name="cbid.wireless.wifi1.nochannel">
<% end %>
<% if WLAN5G_2 == '1' then --[[ #### WLAN5G_2 START ### --]] %>
    <input type="hidden" name="cbid.wireless.wifi2.nochannel">
<% end %>
<div class="ctx-body">
    <div id="tbl_1" class="table bottommargin">
        <table class="ecm-tbl">
            <tbody>
                <tr>
                    <th class="title" width="20%" colspan="2"><%:Wireless Settings%></th>
                </tr>
                <tr>
                    <td class="tbl-name" width="20%" myid="title_Device_Name_text"><%:Device Name%></td>
                    <td class="tbl-value" width="80%">
	                    <input type="text" value="<%=uci:get_first('system', 'system', 'SystemName')%>" id="cbid.system.system.SystemName" name="cbid.system.system.SystemName" class="cbi-input-text" maxlength='32'>

                    </td>
                </tr>
                <tr name="country" style="display:none">
                    <td class="tbl-name" width="20%" myid="title_wifi_country"><%:Country / Region%></td>
                    <td class="tbl-value" width="80%">
	                    <script>showCountryList();</script>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

<% if uci:get('functionlist','functionlist','SUPPORT_ENJET') == '1' then --[[####SUPPORT_ENJET START #### --]] %>
    <div id="tdma" class="table">
        <table class="ecm-tbl">
            <tbody>
                <tr>
                    <th class="title" width="20%" colspan="2" ><%:EnJet%><img class="popper" data-popbox="Enjet_info" src="<%=media%>/pictures/icon_info_blue.png"></th>
                </tr>
                    <tr>
                        <td class="tbl-name" width="20%" ><%:Status%></td>
                        <td class="tbl-value">
                            <div id="cbi-wireless-wifi1-qboost-enable-view"></div>
                        </td>
                    </tr>
            </tbody>
        </table>
    </div>
<% end --[[####SUPPORT_ENJET END #### --]] %>
    <div id="tbl_2" class="table">
        <table class="ecm-tbl" >
            <tbody>
                <tr>
                    <th class="title"></th>
<% if WLAN24G == '1' then %>
    <% if uci:get("wireless","wifi0","hwmode") == '11axg' then %>
                    <th class="title">2.4GHz (ax/n/g/b)</th>
    <% else %>
                    <th class="title">2.4GHz (n/g/b)</th>
    <% end %>
<% end %>
<% if WLAN5G == '1' then %>
    <% if WLAN5G_2 == '1' then --[[ #### WLAN5G_2 feature ### --]] %>
        <% if uci:get("wireless","wifi2","hwmode") == '11axa' then %>
                    <th class="title">5GHz -1 (ax/ac/n/a)(Band3, 4)</th>
                    <th class="title">5GHz -2 (ax/ac/n/a)(Band1, 2)</th>
        <% else %>
                    <th class="title">5GHz -1 (ac/n/a)(Band3, 4)</th>
                    <th class="title">5GHz -2 (ac/n/a)(Band1, 2)</th>
        <% end %>
    <% else %>
        <% if uci:get("wireless","wifi1","hwmode") == '11axa' then %>
                    <th class="title">5GHz (ax/ac/n/a)</th>
        <% else %>
                    <th class="title">5GHz (ac/n/a)</th>
        <% end %>
    <% end --[[ #### WLAN5G_2 feature ### end --]] %>
<% end %>
                </tr>
                <tr>
                    <td class="tbl-name" myid="title_wifi_opmode" style="width: <%=100/(radioNum+1)%>%"><%:Operation Mode%></td>
<% if WLAN24G == '1' then %>
                    <td class="tbl-value" style="width: <%=100/(radioNum+1)%>%">
                        <div id="cbi-wireless-wifi0-opmode-view">
                             <script>showfake("select", "Loading...")</script>
                        </div>
	<% if radioNum == 3 then %>
                        <legend>
	<% end %>
                        <div id="cbi-wireless-wifi0-obeyregpower-view"></div>
                            <div id="green_wifi0"  style="display:none"><%:Green%></div>
                            <div id="green_mode_wifi0" style="display:none">
                                <div class="popper" data-popbox="pop1"><img src="<%=media%>/pictures/icon_info_blue.png"></div>
                            </div>
	<% if radioNum == 3 then %>
                        </legend>
	<% end %>
                    </td>
<% end %>
<% if WLAN5G == '1' then %>
                    <td class="tbl-value" style="width: <%=100/(radioNum+1)%>%">
                        <div id="cbi-wireless-wifi1-opmode-view">
                            <script>showfake("select", "Loading...")</script>
                        </div>
	<% if radioNum == 3 then %>
                        <legend>
	<% end %>
                            <div id="cbi-wireless-wifi1-obeyregpower-view"></div>
                            <div id="green_wifi1"  style="display:none"><%:Green%></div>
                            <div id="green_mode_wifi1" style="display:none">
                                <div class="popper" data-popbox="pop1"><img src="<%=media%>/pictures/icon_info_blue.png"></div>
                            </div>
	<% if radioNum == 3 then %>
                        </legend>
	<% end %>
                    </td>
    <% if WLAN5G_2 == '1' then --[[ #### WLAN5G_2 feature ### --]] %>
                    <td class="tbl-value" style="width: <%=100/(radioNum+1)%>%">
                        <div id="cbi-wireless-wifi2-opmode-view">
                            <script>showfake("select", "Access Point")</script>
                        </div>
	   <% if radioNum == 3 then %>
                        <legend>
	   <% end %>
                            <div id="cbi-wireless-wifi2-obeyregpower-view"></div>
                            <div id="green_wifi2"  style="display:none"><%:Green%></div>
                            <div id="green_mode_wifi2" style="display:none">
                                <div class="popper" data-popbox="pop1"><img src="<%=media%>/pictures/icon_info_blue.png"></div>
                            </div>
	   <% if radioNum == 3 then %>
                        </legend>
	   <% end %>
                    </td>
    <% end --[[ #### WLAN5G_2 feature ### end --]] %>
<% end %>
                </tr>
                <div id="pop1" class="popbox" style="display:none">
                <p><%:Un-check the green function in order to configure the advanced settings.%></p>
                </div>
                <tr style="display:none">
                    <td class="tbl-name" myid="title_wifi_band"><%:Wireless Mode%></td>
<% if WLAN24G == '1' then %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi0-hwmode-view">
                            <script>showfake("select", "Loading...")</script>
                        </div>
                    </td>
<% end %>
<% if WLAN5G == '1' then %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi1-hwmode-view">
                            <script>showfake("select", "Loading...")</script>
                        </div>
                    </td>
    <% if WLAN5G_2 == '1' then --[[ #### WLAN5G_2 feature ### --]] %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi2-hwmode-view">
                            <script>showfake("select", "Loading...")</script>
                        </div>
                    </td>
    <% end --[[ #### WLAN5G_2 feature ### end --]] %>
<% end %>
                </tr>
                <tr>
                    <td class="tbl-name" myid="title_wifi_htmode"><%:Channel HT Mode%></td>
<% if WLAN24G == '1' then %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi0-htmode-view">
                            <script>showfake("select", "Loading...")</script>
                        </div>
                    </td>
<% end %>
<% if WLAN5G == '1' then %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi1-htmode-view">
                            <script>showfake("select", "Loading...")</script>
                        </div>
                    </td>
    <% if WLAN5G_2 == '1' then --[[ #### WLAN5G_2 feature ### --]] %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi2-htmode-view">
                            <script>showfake("select", "Loading...")</script>
                        </div>
                    </td> 
    <% end --[[ #### WLAN5G_2 feature ### end --]] %>
<% end %>
                </tr>
<% if uci:get('functionlist','functionlist','SUPPORT_WLAN_EXTENSION_CHANNEL') == '1' then --[[ #### SUPPORT_WLAN_EXTENSION_CHANNEL START ### --]] %>
                <tr style="display:none">
                    <td class="tbl-name" myid="title_wifi24_ex_channel"><%:Extension Channel%></td>
    <% if WLAN24G == '1' then %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi0-ext_channel-view">
                            <script>showfake("select", "Loading...")</script>
                        </div>
                    </td>
    <% end %>
    <% if WLAN5G == '1' then %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi1-ext_channel-view">
                            <script>showfake("select", "Loading...")</script>
                        </div>
                    </td>
        <% if WLAN5G_2 == '1' then --[[ #### WLAN5G_2 feature ### --]] %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi2-ext_channel-view">
                            <script>showfake("select", "Loading...")</script>
                        </div>
                    </td>
        <% end --[[ #### WLAN5G_2 feature ### end --]] %>
    <% end %>
                </tr>  
                <tr style="display:none"></tr>
<% end --[[ #### SUPPORT_WLAN_EXTENSION_CHANNEL END ### --]] %>
                <tr>
                    <td class="tbl-name" myid="title_wifi_channel"><%:Channel%></td>
                    <td colspan = "3">
                        <input id="cbid.wireless.wifi0.wifi_channel" class="cbi-button cbi-input-button" type="button" name="cbid.wireless.wifi0.wifi_channel" value="<%:Configuration%>"/>
                    </td>
                </tr>
                <tr name="transmitpower" style="display:none">
                    <td class="tbl-name" myid="title_wifi_txpower"><%:Transmit Power%></td>
<% if WLAN24G == '1' then %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi0-txpower-view">
                            <script>showfake("select", "Loading...")</script>
                        </div>
                    </td>
<% end %>
<% if WLAN5G == '1' then %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi1-txpower-view">
                            <script>showfake("select", "Loading...")</script>
                        </div>
                    </td>
    <% if WLAN5G_2 == '1' then --[[ #### WLAN5G_2 feature ### --]] %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi2-txpower-view">
                            <script>showfake("select", "Loading...")</script>
                        </div>
                    </td>
    <% end --[[ #### WLAN5G_2 feature ### end --]] %>
<% end %>
                </tr>
                <tr>
<% if uci:get('functionlist','functionlist', 'SUPPORT_MIN_RATE_SETTING') == '1' then%>
                    <td class="tbl-name" myid="title_wifi_rate"><%:Bit Rate%><img class="popper" data-popbox="Bit_Rate_info" src="<%=media%>/pictures/icon_info_blue.png"></td>
                    <td>
                        <input id="cbid.wireless.wifi0.wifi_rate" class="cbi-button cbi-input-button" type="button" name="cbid.wireless.wifi0.wifi_rate" value="<%:Configuration%>"/>
                    </td>
    <% if WLAN24G == '1' then %>
                    <td class="tbl-value">
                    </td>
    <% end --[[ #### WLAN24G feature ### end --]]%>
    <% if WLAN5G == '1' then %>
                    <td class="tbl-value">
                    </td>
        <% if WLAN5G_2 == '1' then --[[ #### WLAN5G_2 feature ### --]] %>
                    <td class="tbl-value">
                    </td>
        <% end --[[ #### WLAN5G_2 feature ### end --]] %>
    <% end --[[ #### WLAN5G feature ### end --]]%>
<% else %>
                    <td class="tbl-name" myid="title_wifi_rate"><%:Data Rate%></td>
    <% if WLAN24G == '1' then %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi0-rate-view">
                            <script>showfake("select", "Loading...")</script>
                        </div>
                    </td>
    <% end --[[ #### WLAN24G feature ### end --]]%>
    <% if WLAN5G == '1' then %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi1-rate-view">
                            <script>showfake("select", "Loading...")</script>
                        </div>
                    </td>
        <% if WLAN5G_2 == '1' then --[[ #### WLAN5G_2 feature ### --]] %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi2-rate-view">
                            <script>showfake("select", "Loading...")</script>
                        </div>
                    </td>
        <% end --[[ #### WLAN5G_2 feature ### end --]] %>
    <% end --[[ #### WLAN5G feature ### end --]]%>
<% end --[[ #### else SUPPORT_MIN_RATE_SETTING ### end --]]%>
                </tr>
<% if uci:get('functionlist','functionlist', 'SUPPORT_MIN_RATE_SETTING') ~= '1' then%>
                <tr>
                    <td class="tbl-name" myid="title_wifi_rts"><%:RTS/CTS Threshold%><img class="popper" data-popbox="RTS_CTS_Threshold" src="<%=media%>/pictures/icon_info_blue.png"> 
                    <legend>(1 - 2346)</legend>
                    </td>
<% if WLAN24G == '1' then %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi0-rts-view">
                            <input type="text" style="width: 60px;" value="<%=uci:get('wireless', 'wifi0', 'rts') or uci:get_first('wireless', 'wifi-iface', 'rts')%>"/>
                        </div>
                    </td>
<% end %>
<% if WLAN5G == '1' then %>
                    <td class="tbl-value">
                         <div id="cbi-wireless-wifi1-rts-view">
                            <input type="text" style="width: 60px;" value="<%=uci:get('wireless', 'wifi1', 'rts') or uci:get_first('wireless', 'wifi-iface', 'rts')%>"/>
                        </div>
                    </td>
    <% if WLAN5G_2 == '1' then --[[ #### WLAN5G_2 feature ### --]] %>
                    <td class="tbl-value">
                         <div id="cbi-wireless-wifi2-rts-view">
                            <input type="text" style="width: 60px;" value="<%=uci:get('wireless', 'wifi2', 'rts') or uci:get_first('wireless', 'wifi-iface', 'rts')%>"/>
                        </div>
                    </td>
    <% end --[[ #### WLAN5G_2 feature ### end --]] %>
<% end %>
                </tr>
<% end --[[ #### SUPPORT_MIN_RATE_SETTING ### end --]] %>
                <tr>
                    <td class="tbl-name" myid="title_wifi_clientlimits"><%:Client Limits%></td>
<% if WLAN24G == '1' then %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi0-clientlimits_enable-view">
                            <script>showfake("radio", "<%=uci:get('wireless', 'wifi0', 'clientlimits_enable')%>")</script>
                        </div>
                        <div style="display: block;">
                            <div id="cbi-wireless-wifi0-clientlimits_number-view">
                                <input type="text" style="width: 60px;" value="<%=uci:get('wireless', 'wifi0', 'clientlimits_number')%>"/>
                            </div>
                        </div>
                    </td>
<% end %>
<% if WLAN5G == '1' then %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi1-clientlimits_enable-view">
                            <script>showfake("radio", "<%=uci:get('wireless', 'wifi1', 'clientlimits_enable')%>")</script>
                        </div>
                        <div style="display: block;">
                            <div id="cbi-wireless-wifi1-clientlimits_number-view">
                                <input type="text" style="width: 60px;" value="<%=uci:get('wireless', 'wifi1', 'clientlimits_number')%>"/>
                            </div>
                        </div>
                    </td>
    <% if WLAN5G_2 == '1' then --[[ #### WLAN5G_2 feature ### --]] %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi2-clientlimits_enable-view">
                            <script>showfake("radio", "<%=uci:get('wireless', 'wifi2', 'clientlimits_enable')%>")</script>
                        </div>
                        <div style="display: block;">
                            <div id="cbi-wireless-wifi2-clientlimits_number-view"><input type="text" style="width: 60px;" value="<%=uci:get('wireless', 'wifi2', 'clientlimits_number')%>"/></div>
                        </div>
                    </td>
    <% end --[[ #### WLAN5G_2 feature ### end --]] %>
<% end %>
                </tr>
<% if WLAN5G == '1' and WLAN24G ~= "1" and uci:get('functionlist','functionlist','HWMODE_AC') == '1' then%>
<% else %>
                <tr <% if (uci:get('functionlist','vendorlist','WEB_GUI_VER') ~= nil and uci:get('functionlist','vendorlist','WEB_GUI_VER') > "1") or uci:get('functionlist','functionlist','SUPPORT_HIDE_AGGREGATION_SETTING') == '1' then %> style="display:none" <% end %> >
                    <td class="tbl-name" myid="title_wifi_aggregation"><%:Aggregation%><img class="popper" data-popbox="Aggregation_info" src="<%=media%>/pictures/icon_info_blue.png"></td>
    <% if WLAN24G == '1' then %>
                    <td class="tbl-value" name="wifi_aggregation">
                        <div id="cbi-wireless-wifi0-aggregation_enable-view">
                            <script>showfake("radio", "<%=uci:get('wireless', 'wifi0', 'aggregation_enable')%>")</script>
                        </div><br>
                        <div id="cbi-wireless-wifi0-aggregation_frame-view">
                            <input type="text" style="width: 60px;" value="<%=uci:get('wireless', 'wifi0', 'aggregation_frame')%>"/>
                        </div><%:Frames%><br>
                        <div id="cbi-wireless-wifi0-aggregation_byte-view">
                            <input type="text" style="width: 60px;" value="<%=uci:get('wireless', 'wifi0', 'aggregation_byte')%>"/>
                        </div><%:Bytes(Max)%>
                    </td>
    <% end %>
    <% if WLAN5G == '1' then %>
        <% if uci:get('functionlist','functionlist','HWMODE_AC') == '1' then %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi1-aggregation_enable-view"></div><br>
                        <div id="cbi-wireless-wifi1-aggregation_frame-view"></div><br>
                        <div id="cbi-wireless-wifi1-aggregation_byte-view"></div>
                    </td>
        <% else --[[ #### without HWMODE_AC support aggregation ### --]] %>
                    <td class="tbl-value" name="wifi_aggregation_wifi1">
                        <div id="cbi-wireless-wifi1-aggregation_enable-view">
                            <script>showfake("radio", "<%=uci:get('wireless', 'wifi1', 'aggregation_enable')%>")</script>
                        </div><br>
                        <div id="cbi-wireless-wifi1-aggregation_frame-view">
                            <input type="text" style="width: 60px;" value="<%=uci:get('wireless', 'wifi1', 'aggregation_frame')%>"/>
                        </div><%:Frames%><br>
                        <div id="cbi-wireless-wifi1-aggregation_byte-view">
                            <input type="text" style="width: 60px;" value="<%=uci:get('wireless', 'wifi1', 'aggregation_byte')%>"/>
                        </div><%:Bytes(Max)%>
                    </td>
        <% end %>
        <% if WLAN5G_2 == '1' then --[[ #### WLAN5G_2 feature ### --]] %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi2-aggregation_enable-view"></div><br>
                        <div id="cbi-wireless-wifi2-aggregation_frame-view"></div><br>
                        <div id="cbi-wireless-wifi2-aggregation_byte-view"></div>
                    </td>
        <% end --[[ #### WLAN5G_2 feature ### end --]] %>
    <% end %>
<% end %>
                </tr>
<% if uci:get('functionlist','functionlist','SUPPORT_MULTI_TO_UNI_CONVERSION') == '1' then %>                
                <tr>
                    <td class="tbl-name" myid="title_wifi_multi_to_uni"><%:Multicast to Unicast Stream Conversion%></td>
                    <td class="tbl-name" colspan="3">
                        <div id="cbi-wireless-wifi0-Multicast-view">
                        <% if uci:get('functionlist','functionlist','HWMODE_AX') == '1' then %>
                            <input id="cbid.wireless.wifi0.Multicast1" class="cbi-input-radio" type="radio" value="6" name="mcastenhance"/><label><%:Enable%></label>
                        <% else %>
                            <input id="cbid.wireless.wifi0.Multicast1" class="cbi-input-radio" type="radio" value="2" name="mcastenhance"/><label><%:Enable%></label>
                        <% end %>
                            <div class="popper" data-popbox="multicast"><img class="popper" data-popbox="MtoUSC_enable_info" src="<%=media%>/pictures/icon_info_blue.png"></div>&nbsp&nbsp

                            <input id="cbid.wireless.wifi0.Multicast2" class="cbi-input-radio" type="radio" value="0" name="mcastenhance"/><label><%:Disable%></label>
                            <div class="popper" data-popbox="unicast"><img class="popper" data-popbox="MtoUSC_disable_info" src="<%=media%>/pictures/icon_info_blue.png"></div>
                        </div><br>
                    </td>
    <% if radioNum == 2 then %>
                    <td></td>
    <% end %>
    <% if radioNum == 3 then %>
                    <td></td>
    <% end %>
                </tr>
<% end %>
                <tr>
                    <td class="tbl-name" myid="title_wifi_AP_Detection"><%:AP Detection%></td>
<% if WLAN24G == '1' then %>
                    <td class="tbl-value">
                        <input id="cbid.wireless.wifi0.AP_Detection" class="cbi-button cbi-input-button" type="button" value="<%:Scan%>" name="cbid.wireless.wifi0.AP_Detection">
                    </td>
<% end %>
<% if WLAN5G == '1' then %>
                    <td class="tbl-value">
                        <input id="cbid.wireless.wifi1.AP_Detection" class="cbi-button cbi-input-button" type="button" value="<%:Scan%>" name="cbid.wireless.wifi1.AP_Detection">
                    </td>
    <% if WLAN5G_2 == '1' then --[[ #### WLAN5G_2 feature ### --]] %>
                    <td class="tbl-value">
                        <input id="cbid.wireless.wifi2.AP_Detection" class="cbi-button cbi-input-button" type="button" value="<%:Scan%>" name="cbid.wireless.wifi2.AP_Detection">
                    </td>                    
    <% end --[[ #### WLAN5G_2 feature ### end --]] %>
<% end %>
                </tr>
<% if WLAN24G == '1' and HWMODE_AX == '1' then %>
                <tr>
                    <td class="tbl-name" myid="title_wifi_11ax_mode"><%:11ax mode%></td>
                    <td class="tbl-value">
                        <input type="radio" value="1" name="hwmode_11ax" myid="24g_ax_enable" />&nbsp;<%:Enable%>&nbsp;&nbsp;
                        <input type="radio" value="0" name="hwmode_11ax" myid="24g_ax_disable" />&nbsp;<%:Disable%>
                    </td>
                </tr>
<% end %>
<% if uci:get('functionlist','functionlist','SUPPORT_WLAN_OUTDOOR_DISTANCE_ENV') == '1' then --[[ #### SUPPORT_WLAN_OUTDOOR_DISTANCE_ENV START ### --]]
        if uci:get('sysProductInfo','model','outdoor') == '1' then
%>                
                <tr>
                    <td class="tbl-name">
                        <%
                        if uci:get('functionlist','functionlist','SUPPORT_DISTANCE_ALGORITHM1') == '1' then -----#### SUPPORT_WLAN_OUTDOOR_DISTANCE START ###
                        %>
                            <%:Noise Environment%>
                        <% else %>
                            <%:Noise Environment%>
                        <% end %>
                    </td>
<% if WLAN24G == '1' then %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi0-distance-env-view">
                            <input type="checkbox" value="1" <%if(uci:get('wireless', 'wifi0', 'distance_env'))== '1' then print("checked") end %>/>
                        </div>
                    </td>
<% end %>
<% if WLAN5G == '1' then %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi1-distance-env-view">
                            <input type="checkbox" value="1" <%if(uci:get('wireless', 'wifi1', 'distance_env'))== '1' then print("checked") end %>/>
                        </div>
                    </td>
    <% if WLAN5G_2 == '1' then --[[ #### WLAN5G_2 feature ### --]] %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi2-distance-env-view">
                            <input type="text" style="width: 60px;" value="<%=tonumber(uci:get('wireless', 'wifi2', 'distance_env'))%>"/>
                        </div>
                    </td>
    <% end --[[ #### WLAN5G_2 feature ### end --]] %>
<% end %>
                </tr>
<%
        end
end --[[ #### SUPPORT_WLAN_OUTDOOR_DISTANCE_ENV END ### --]]

if uci:get('functionlist','functionlist','SUPPORT_WLAN_OUTDOOR_DISTANCE') == '1' then --[[ #### SUPPORT_WLAN_OUTDOOR_DISTANCE START ### --]]
    if uci:get('sysProductInfo','model','outdoor') == '1' then
%>                
                <tr>
                    <td class="tbl-name" >
                        <% if uci:get('functionlist','functionlist','SUPPORT_DISTANCE_ALGORITHM1') == '1' then 
--[[ #### SUPPORT_WLAN_OUTDOOR_DISTANCE START ### --]] %>
                            <%:Distance %>
                        <% else %>
                            <%:Distance %>(0-30<%:km%>)
                        <% end %>
                    </td>
        <% if WLAN24G == '1' then %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi0-distance-view">
                            <input type="text" style="width: 60px;" value="<%=tonumber(uci:get('wireless', 'wifi0', 'distance'))/1000%>"/>
                        </div>
                        (<div id="wifi0_mile_text" style="display:inline;">0
                        </div><%:miles%>)
                    </td>
        <% end %>
        <% if WLAN5G == '1' then %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi1-distance-view">
                            <input type="text" style="width: 60px;" value="<%=tonumber(uci:get('wireless', 'wifi1', 'distance'))/1000%>"/>
                        </div>
                        (<div id="wifi1_mile_text" style="display:inline;">0
                        </div><%:miles%>)
                    </td>
            <% if WLAN5G_2 == '1' then --[[ #### WLAN5G_2 feature ### --]] %>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi2-distance-view">
                            <input type="text" style="width: 60px;" value="<%=tonumber(uci:get('wireless', 'wifi2', 'distance'))/1000%>"/>
                        </div>
                        (<div id="wifi2_mile_text" style="display:inline;">0
                        </div><%:miles%>)
                    </td>
            <% end --[[ #### WLAN5G_2 feature ### end --]] %>
        <% end %>
                </tr>
<%
        end
end-----####  SUPPORT_WLAN_OUTDOOR_DISTANCE END ####
%>                
<% if uci:get('functionlist','functionlist','SUPPORT_ENJET') == '1' then --[[####SUPPORT_ENJET START #### --]] %>
                <tr>
                    <td class="tbl-name" myid="title_ap_time_slot">
                        <%:AP Time Slot%><img class="popper" data-popbox="aptimeslot_info" src="<%=media%>/pictures/icon_info_blue.png">
                    </td>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi1-aptimeslot-view">
                        <script>showfake("select", "Loading...")</script>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="tbl-name" myid="title_sta_priority">
                            <%:Station Priority%><img class="popper" data-popbox="stationpriority_info" src="<%=media%>/pictures/icon_info_blue.png">
                    </td>
                    <td class="tbl-value">
                        <div id="cbi-wireless-wifi1-stationpriority-view">
                            <script>showfake("select", "Loading...")</script>
                        </div>
                    </td>
                </tr>
<% end --[[####SUPPORT_ENJET END #### --]] %>
            </tbody>
        </table>
    </div>
    <div id="wifix" class="table" style="overflow:auto"></div> 
<% if WLAN24G == '1' then %>
    <div class="ctx-blank" id="wifi0_blank"></div>
    <div id="wifi0" class="table" style="overflow:auto"></div> 
    <div id="wdslink1" class="table"></div>
<% end %> 
<% if WLAN5G == '1' then %>
    <div class="ctx-blank" id="wifi1_blank"></div>
    <div id="wifi1" class="table"></div> 
    <div id="wdslink2" class="table"></div>
    <% if WLAN5G_2 == '1' then --[[ #### WLAN5G_2 feature ### --]] %>
        <div class="ctx-blank" id="wifi2_blank"></div>
        <div id="wifi2" class="table"></div> 
        <div id="wdslink3" class="table"></div>
    <% end --[[ #### WLAN5G_2 feature ### end --]] %>
<% end %>
<% if uci:get('functionlist','functionlist','SUPPORT_ENJET') == '1' then %>
    <div id="wifi1_tdma" class="table" style="overflow:auto"></div>
<% end %>
<% if uci:get('functionlist','functionlist','SUPPORT_MANAGEMENT_SSID') == '1' then %>
<div id="wifix_management_all">
    <div id="wifix_management" class="table" style="overflow:auto"></div>
    <table class="ecm-tbl">
        <tbody>
            <tr>
                <% if uci:get('functionlist','vendorlist','MANAGEMENT_SUPPORT_RADIO') == '1' then %>
                    <td class="tbl-value">
                        <input id="cbid.wireless.wifi0_mgmt.livetime1" myid="wifi24_radio_enable_mgm_livetime1" class="cbi-input-radio" type="radio" value="0" name="cbid.wireless.wifi0_mgmt.livetime"><%:Always on%>
                        <input id="cbid.wireless.wifi0_mgmt.livetime2" myid="wifi24_radio_enable_mgm_livetime2" class="cbi-input-radio" type="radio" value="15" name="cbid.wireless.wifi0_mgmt.livetime"><%:Turn off if idle in 15 minutes%>
                    </td>
                <% elseif uci:get('functionlist','vendorlist','MANAGEMENT_SUPPORT_RADIO') == '2' then %>
                    <td class="tbl-value">
                        <input id="cbid.wireless.wifi1_mgmt.livetime1" myid="wifi5_radio_enable_mgm_livetime1" class="cbi-input-radio" type="radio" value="0" name="cbid.wireless.wifi1_mgmt.livetime"><%:Always on%>
                        <input id="cbid.wireless.wifi1_mgmt.livetime2" myid="wifi5_radio_enable_mgm_livetime2" class="cbi-input-radio" type="radio" value="15" name="cbid.wireless.wifi1_mgmt.livetime"><%:Turn off if idle in 15 minutes%>
                    </td>
                <% end %>
            </tr>
        </tbody>
    </table>
</div>
<% end %>
<% if uci:get('functionlist','functionlist','SUPPORT_GUEST_NETWORK_SETTING') == '1' then --[[ #### SUPPORT_GUEST_NETWORK_SETTING START ### --]] %>
    <% if uci:get('functionlist','functionlist','SUPPORT_GUEST_NETWORK_BY_SSID') ~= '1' then --[[ #### SUPPORT_GUEST_NETWORK_BY_SSID START ### --]] %>
    <div id="gn" class="table"></div>
    <% end %>
    <div id="gn_ip" class="table">
        <table  class="ecm-tbl">
            <tbody>
                <% if uci:get('functionlist','functionlist','SUPPORT_GUEST_NETWORK_BY_SSID') == '1' then --[[ #### SUPPORT_GUEST_NETWORK_BY_SSID START ### --]] %>
                <tr><th colspan=2 class="title"><%:Guest Network DHCP Server Settings%></th></tr>
                <% end %>
                <tr>
                    <td class="tbl-name" width="40%"><%:Manual IP Settings%></td>
                    <td class="tbl-value" width="60%"></td>
                </tr>
                <tr>
                    <td class="tbl-name" width="40%" myid="title_wifi_guest_ipaddr"><span class="margin-indent" ></span><%:IP Address%></td>
                    <td class="tbl-value" width="60%">
                        <input id="cbid.network.guest.ipaddr" class="cbi-input-text" type="text" value="<%=uci:get("network","guest","ipaddr")%>" name="cbid.network.guest.ipaddr"  style="width: 200px;">
                    </td>
                </tr>
                <tr>
                    <td class="tbl-name" width="40%" myid="title_wifi_guest_netmask"><span class="margin-indent"></span><%:Subnet Mask%></td>
                    <td class="tbl-value" width="60%">
                      <input id="cbid.network.guest.netmask" class="cbi-input-text" type="text" value="<%=uci:get("network","guest","netmask")%>" name="cbid.network.guest.netmask"  style="width: 200px;">
                    </td>
                </tr>
                <tr>
                    <td class="tbl-name" width="40%"><%:Automatic DHCP Server Settings%></td>
                    <td class="tbl-value" width="60%"></td>                    
                </tr>
                <tr>
                    <td class="tbl-name" width="40%" myid="title_wifi_guest_startip"><span class="margin-indent"></span><%:Starting IP Address%></td>
                    <td class="tbl-value" width="60%">
                      <input id="cbid.dhcp.guest.start" class="cbi-input-text" type="text" value="<%=uci:get("dhcp","guest","start")%>" name="cbid.dhcp.guest.start"  style="width: 200px;">

                    </td>
                </tr>
                <tr>
                    <td class="tbl-name" width="40%" myid="title_wifi_guest_endip"><span class="margin-indent"></span><%:Ending IP Address%></td>
                    <td class="tbl-value" width="60%">
                       <input id="cbid.dhcp.guest.limit" class="cbi-input-text" type="text" value="<%=uci:get("dhcp","guest","limit")%>" name="cbid.dhcp.guest.limit"  style="width: 200px;">

                    </td>
                </tr>
                <tr>
                    <td class="tbl-name" width="40%" myid="title_wifi_guest_serverip"><span class="margin-indent"></span><%:WINS Server IP%></td>
                    <td class="tbl-value" width="60%">
                       <input id="cbid.dhcp.guest.dhcp_option" class="cbi-input-text" type="text" value="<%=uci:get("dhcp","guest","dhcp_option")%>" name="cbid.dhcp.guest.dhcp_option"  style="width: 200px;">

                    </td>
                </tr>
            </tbody>
       </table>
    </div> 
    <div  style="display:none"><div id="cbi-dhcp-guest-ignore-view"></div></div>    
    <div class="ctx-blank"></div>
<% end --[[ #### SUPPORT_GUEST_NETWORK_SETTING END ### --]] %>
<% if uci:get('functionlist','functionlist', 'SUPPORT_FAST_HANDOVER') == '1' then %>
    <div id="fasthandover" class="table bottommargin">
        <table class="ecm-tbl">
            <tbody>
                <tr>
<% if uci:get('functionlist','functionlist', 'SUPPORT_DUAL_FAST_HANDOVER') == '1' then %>
                    <th class="title"><%:RSSI Threshold%><img class="popper" data-popbox="Fast_Handover_info" src="<%=media%>/pictures/icon_info_blue.png"></td>
    <% if WLAN24G == '1' then %>
                    <th class="title">2.4GHz</td>
    <% end %>
    <% if WLAN5G == '1' then %>
        <% if WLAN5G_2 == '1' then --[[ #### WLAN5G_2 feature ### --]] %>
                    <th class="title">5GHz -1</td>
                    <th class="title">5GHz -2</td>
        <% else %>
                    <th class="title">5GHz</td>
        <% end --[[ #### WLAN5G_2 feature ### end --]] %>
    <% end %>
<% else %>
                    <th width="20%" colspan="2" class="title"><%:RSSI Threshold%><img class="popper" data-popbox="Fast_Handover_info" src="<%=media%>/pictures/icon_info_blue.png"></th>
<% end %>
                </tr>
                <tr>
<% if uci:get('functionlist','functionlist', 'SUPPORT_DUAL_FAST_HANDOVER') == '1' then %>
                    <td class="tbl-name" myid="title_wifi_fasthandover_status"><%:Status%></td>
    <% if WLAN24G == '1' then %>
                    <td class="tbl-value">
                        <input id="cbid.wireless.wifi0.fasthandover_status1" class="cbi-input-radio" type="radio" value="1" name="cbid.wireless.wifi0.fasthandover_status"><%:Enable%>
                        <input id="cbid.wireless.wifi0.fasthandover_status2" class="cbi-input-radio" type="radio" value="0" name="cbid.wireless.wifi0.fasthandover_status"><%:Disable%>
                    </td>
    <% end %>
    <% if WLAN5G == '1' then %>
                     <td class="tbl-value">
                        <input id="cbid.wireless.wifi1.fasthandover_status1" class="cbi-input-radio" type="radio" value="1" name="cbid.wireless.wifi1.fasthandover_status"><%:Enable%>
                        <input id="cbid.wireless.wifi1.fasthandover_status2" class="cbi-input-radio" type="radio" value="0" name="cbid.wireless.wifi1.fasthandover_status"><%:Disable%>
                    </td>
        <% if WLAN5G_2 == '1' then --[[ #### WLAN5G_2 feature ### --]] %>
                     <td class="tbl-value">
                        <input id="cbid.wireless.wifi2.fasthandover_status1" class="cbi-input-radio" type="radio" value="1" name="cbid.wireless.wifi2.fasthandover_status"><%:Enable%>
                        <input id="cbid.wireless.wifi2.fasthandover_status2" class="cbi-input-radio" type="radio" value="0" name="cbid.wireless.wifi2.fasthandover_status"><%:Disable%>
                    </td>
        <% end --[[ #### WLAN5G_2 feature ### end --]] %>
    <% end %>
<% else %>
                    <td class="tbl-name" width="20%" myid="title_wifi_fasthandover_status"><%:Status%></td>
                    <td class="tbl-value" width="80%">
                        <input id="cbid.wireless.wifi0.fasthandover_status" class="cbi-input-radio" type="radio" value="1" name="cbid.wireless.wifi0.fasthandover_status"><%:Enable%>
                        <input id="cbid.wireless.wifi0.fasthandover_status" class="cbi-input-radio" type="radio" value="0" name="cbid.wireless.wifi0.fasthandover_status"><%:Disable%>
                    </td> 
<% end %>
                </tr>
                <tr>
<% if uci:get('functionlist','functionlist', 'SUPPORT_DUAL_FAST_HANDOVER') == '1' then %>                    
                    <td class="tbl-name" myid="title_wifi_fasthandover_rssi">RSSI
                    <legend>(<%:Range%>: <%=RSSI_THRESHOLD_MIN%>dBm ~ <%=RSSI_THRESHOLD_MAX%>dBm)</legend>
                    </td>
    <% if WLAN24G == '1' then %>
                    <td class="tbl-value">
                    <input id="cbid.wireless.wifi0.fasthandover_rssi" myid="wifi24_fasthandover_rssi" class="cbi-input-text" type="text" value="<%=uci:get("wireless","wifi0","fasthandover_rssi")%>" name="cbid.wireless.wifi0.fasthandover_rssi"  style="width: 60px;  " maxlength='4'>
                        </div>dBm
                    </td>
    <% end %>
    <% if WLAN5G == '1' then %>
                    <td class="tbl-value">
                    <input id="cbid.wireless.wifi1.fasthandover_rssi" myid="wifi5_fasthandover_rssi" class="cbi-input-text" type="text" value="<%=uci:get("wireless","wifi1","fasthandover_rssi")%>" name="cbid.wireless.wifi1.fasthandover_rssi"  style="width: 60px;  " maxlength='4'>
                        </div>dBm
                    </td>
        <% if WLAN5G_2 == '1' then --[[ #### WLAN5G_2 feature ### --]] %>
                    <td class="tbl-value">
                    <input id="cbid.wireless.wifi2.fasthandover_rssi" myid="wifi5_1_fasthandover_rssi" class="cbi-input-text" type="text" value="<%=uci:get("wireless","wifi2","fasthandover_rssi")%>" name="cbid.wireless.wifi2.fasthandover_rssi"  style="width: 60px;  " maxlength='4'>
                        </div>dBm
                    </td>
        <% end --[[ #### WLAN5G_2 feature ### end --]] %>
    <% end %>
<% else %>
                    <td class="tbl-name" width="20%" myid="title_wifi_fasthandover_rssi">RSSI</td>
                    <td class="tbl-value" width="80%">
                    <input id="cbid.wireless.wifi0.fasthandover_rssi" myid="wifi24_fasthandover_rssi" class="cbi-input-text" type="text" value="<%=uci:get("wireless","wifi0","fasthandover_rssi")%>" name="cbid.wireless.wifi0.fasthandover_rssi"  style="width: 60px;  " maxlength='4'/>
                    </div>dBm (<%:Range%>: <%=RSSI_THRESHOLD_MIN%>dBm ~ <%=RSSI_THRESHOLD_MAX%>dBm)
                    </td>
<% end %>
                </tr>
<% if uci:get('functionlist','functionlist','SUPPORT_RSSI_THRESHOLD_MSG') == '1' then --[[ #### SUPPORT_RSSI_THRESHOLD_MSG START ### --]] %>
                <tr>
                    <td class="tbl-name" colspan="<%=radioNum+1%>">
                    <span class="msg_type_mark">&nbsp;<%:Caution%>:</span>
                   <%:Enabling RSSI Threshold disassociates wireless clients that fall below the configured RSSI threshold and may cause wireless clients to reconnect frequently. It is recommended to disable this feature unless you deem it absolutely necessary.%>
                    </td> 
                </tr> 
<%
end -----#### SUPPORT_RSSI_THRESHOLD_MSG END ###
%>
            </tbody>
        </table>
    </div>
<% end%>
     <div class="ctx-blank"></div>

<% if uci:get('functionlist','functionlist','SUPPORT_AP_RP_SETUP_WIZARD') ~= "1" then %>
    <div id="tbl_1" class="table bottommargin">
        <table class="ecm-tbl">
            <tbody>
                <tr>
                    <th width="20%" colspan="2" class="title"><%:Management VLAN Settings%><img class="popper" data-popbox="Management_VLAN_Settings_info" src="<%=media%>/pictures/icon_info_blue.png"></th>
                </tr>
                <tr>
                    <td class="tbl-name" width="20%" myid="title_VLAN"><%:Status%></td>
                    <td class="tbl-value" width="80%">
                    <input id="cbid.network.sys.WLANVLANEnable1" class="cbi-input-radio" type="radio" value="1" name="cbid.network.sys.WLANVLANEnable" myid="VLAN_enable"><%:Enable%>
                    <input id="cbid.network.sys.WLANVLANEnable2" class="cbi-input-radio" type="radio" value="0" name="cbid.network.sys.WLANVLANEnable" myid="VLAN_disable"><%:Disable%>
                    <input id="cbid.network.sys.ManagementVLANID" class="cbi-input-text" type="text" value="<%=uci:get("network","sys","ManagementVLANID")%>" name="cbid.network.sys.ManagementVLANID" myid="VLAN_id"  style="width: 60px; " maxlength='4' >                     
                    </td>
                </tr> 
                <tr>
                    <td class="tbl-name" colspan="2"><span class="msg_type_mark">&nbsp;<%:Caution%>:</span>
                        <%:If you encounter disconnection issue during the configuration process, verify that the switch and the DHCP server can support the new VLAN ID and then connect to the new IP address.%> 
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
<% end %>
<script type="text/javascript">
var gn_field = ["ssid","isolate","encryption","hidden","disabled"];
var gn_field_view = ["disabled","ssid","encrEdit","encryption","hidden","isolate"];
//modii
//var gn_field_view = ["disabled","ssid","encrEdit","encryption"];
//var gn_field_gui = ["<%:Enabled%>","<%:SSID%>","<%:Edit%>","<%:Security%>","<%:Hidden SSID%>","<%:Client Isolation%>"]; 
var gn_field_gui = ["<%:Enabled%>","<%:SSID%>","<%:Edit%>","<%:Security%>"];
var sta_field = ["ssid","encryption"];
var sta_field_view = ["ssid","encrEdit","encryption"];
var sta_field_gui = ["","<%:SSID%>","<%:Edit%>","<%:Security%>","","","",""];
var wds_net ={};
var repeater_net ={};

var iface_field = ["ssid","vlan_id","encryption","guest_network","disabled"];
var iface_field_view = ["disabled","ssid"
<% if WLAN24G == '1' then %>
,"24g"
<% end %>
<% if WLAN5G == '1' then %>
,"5g"
<% if WLAN5G_2 == '1' then %>
,"5g2"
<% end %>
<% end %>
,"encrEdit","encryption","guest_network"
<% if uci:get('functionlist','functionlist','SUPPORT_AP_RP_SETUP_WIZARD') == "1" then %>
,""
<% else %>
,"vlan_id"
<% end %>
];
var iface_field_tdma_view = ["disabled","ssid"
<% if WLAN24G == '1' then %>
,"24g"
<% end %>
<% if WLAN5G == '1' then %>
,"5g"
<% if WLAN5G_2 == '1' then %>
,"5g2"
<% end %>
<% end %>
,"encrEdit","encryption","vlan_id"];
var iface_field_mgmt_view = ["disabled","ssid"
<% if uci:get('functionlist','vendorlist','MANAGEMENT_SUPPORT_RADIO') == '1' then %>
,"24g"
<% end %>
<% if uci:get('functionlist','vendorlist','MANAGEMENT_SUPPORT_RADIO') == '2' then %>
,"5g"
<% end %>
,"encrEdit","encryption"];
var iface_field_wds = ["ssid","vlan_id","encryption","guest_network","disabled"];
var iface_field_wds_view = ["disabled","ssid","encrEdit","encryption","vlan_id"];
//var iface_field_view = ["disabled","ssid","24g","5g","encrEdit","encryption","hidden","isolate","guest_network","bandsteer_en","isolation","l2_isolatior","vlan_id"];
//var iface_field_gui = ["<%:Enabled%>","<%:SSID%>","<%:2.4GHz%>","<%:5GHz%>","<%:Edit%>","<%:Security%>","<%:Hidden SSID%>","<%:Client Isolation%>","<%:Guest Network%>","<%:Band Steering%>","<%:VLAN Isolation%>","<%:L2 Isolation%>","<%:VLAN ID%>"];
var iface_field_gui = ["<%:Enabled%>","<%:SSID%>"
<% if WLAN24G == '1' and WLAN5G == '1' then %>
,"<%:2.4GHz%>"
<%end%>
<% if WLAN5G_2 == '1' then %>
,"<%:5GHz-1%>"
,"<%:5GHz-2%>"
<% elseif WLAN5G == '1' and WLAN24G == '1' then %>
,"<%:5GHz%>"
<% end %>
,"<%:Edit%>","<%:Security%>","<%:Guest Network%>"
<% if uci:get('functionlist','functionlist','SUPPORT_AP_RP_SETUP_WIZARD') == "1" then %>
,""
<% else %>
,"<%:VLAN ID%>"
<% end %>
];
var iface_field_wds_gui = ["<%:Enabled%>","<%:SSID%>","<%:Edit%>","<%:Security%>","<%:VLAN ID%>"];
var iface_field_tdma_gui = ["<%:Enabled%>","<%:SSID%>","<%:Edit%>","<%:Security%>","<%:VLAN ID%>","",""];
var iface_field_mgmt_gui = ["<%:Enabled%>","<%:SSID%>","<%:Edit%>","<%:Security%>","","",""];
<%
if uci:get('functionlist','functionlist','SUPPORT_AP_MODE_ONLY') == '1' then --[[ #### SUPPORT_AP_MODE_ONLY START ### --]]
else
    for _, dev in ipairs(devices) do 
        local net_wds_ap
        if wifi_all_net[dev:name()]["wds_ap"] ~= nil then
            for _, net_wds_ap in ipairs(wifi_all_net[dev:name()]["wds_ap"]) do
                local nawds_wds_ap = uci:get("wireless",net_wds_ap:name(),"nawds")
                if  nawds_wds_ap and nawds_wds_ap == '1'  then
    %>
                    wds_net['<%=net_wds_ap:id()%>'] = '<%=net_wds_ap:name()%>'
    <%
                end
            end
        end
        local net_wds_bridge
        if wifi_all_net[dev:name()]["wds_bridge"] ~= nil then
            for _, net_wds_bridge in ipairs(wifi_all_net[dev:name()]["wds_bridge"]) do
                local nawds_wds_bridge = uci:get("wireless",net_wds_bridge:name(),"nawds")
                if  nawds_wds_bridge and nawds_wds_bridge == '1'  then
    %>
                    wds_net['<%=net_wds_bridge:id()%>'] = '<%=net_wds_bridge:name()%>'
    <%
                end
            end
        end
if uci:get("functionlist","functionlist","SUPPORT_REPEATER_MODULE") == "0" or uci:get("functionlist","functionlist","SUPPORT_REPEATER_MODULE") == nil then
        local net_sta_ap
        for _, net_sta_ap in ipairs(dev:get_wifinets_repeater()) do
%>
            repeater_net['<%=net_sta_ap:id()%>'] = '<%=net_sta_ap:name()%>'
<%
        end
end     --[[ #### SUPPORT_REPEATER_MODULE END ### --]]
    end
end --[[ #### SUPPORT_AP_MODE_ONLY END ### --]]
%>
<% if uci:get('functionlist','functionlist','SUPPORT_GUEST_NETWORK_BY_SSID') ~= '1' then --[[ #### SUPPORT_GUEST_NETWORK_BY_SSID START ### --]] %>
myTable.newTable([],"gn","gn_tbl");
myTable.newTr(gn_field_gui,"gn_tbl","gn_name");
<% end %>
</script>

<span style="display:none"  id="cbi_set">
<div id="dev_wifi0_container"></div>
<div id="dev_wifi1_container"></div>
<div id="dev_wifi2_container"></div>

</span>

<script type="text/javascript">

$( window ).unload(function() {
     if(is_form_submit=="1"){
         window.location.replace('<%=luci.dispatcher.build_url("admin/network/wireless_device")%>');
     }
});
</script >
<% 
for _, dev in ipairs(devices) do local nets = wifi_all_net[dev:name()]["all"]
        --local opmode = string.sub(luci.sys.exec("uci get wireless.%s.opmode" %dev:name()),1,-2)
%>
<script type="text/javascript">   
myTable.newTable([],"<%=dev:name()%>","<%=dev:name()%>"+"_tbl");     
myTable.newTr(iface_field_wds_gui,"<%=dev:name()%>"+"_tbl","<%=dev:name()%>"+"_name");
myTable.newTr(sta_field_gui,"<%=dev:name()%>"+"_tbl","<%=dev:name()%>"+"_name_sta");
<% if dev:name() == "wifi0"  then %>
myTable.newTable([],"wifix","wifix"+"_tbl");
myTable.newTr(iface_field_gui,"wifix"+"_tbl","wifix"+"_name");
<% if uci:get('functionlist','functionlist','SUPPORT_ENJET') == '1' then %>
    myTable.newTable([],"wifi1_tdma","wifi1_tdma"+"_tbl");
    myTable.newTr(iface_field_tdma_gui,"wifi1_tdma"+"_tbl","wifi1_tdma"+"_name");
<% end %>
<% if uci:get('functionlist','functionlist','SUPPORT_MANAGEMENT_SSID') == '1' then %>
    myTable.newTable([],"wifix_management","wifix_management"+"_tbl");
    myTable.newTr(iface_field_mgmt_gui,"wifix_management"+"_tbl","wifix_management"+"_name");
<% end %>
<% for i=1,iface_num do %>

var iface_bindfunc_array={};

for( var i in iface_field_view )
{
    myTable.newTr([],"wifix"+"_tbl","wifix_ssid_"+"<%=i%>");
    myTable.newTd([],"wifix_ssid_"+"<%=i%>","wifix_ssid_"+"<%=i%>"+"_"+i);
    myTable.newDiv("cbi-wireless-wifix_ssid_"+"<%=i%>"+"-"+iface_field_view[i]+"_view","wifix_ssid_"+"<%=i%>"+"_"+i);

    iface_bindfunc_array["cbi-wireless-wifix_ssid_"+"<%=i%>"+"-"+iface_field_view[i]+"_view"] = "cbi-wireless-wifix_ssid_"+"<%=i%>"+"-"+iface_field_view[i];
    switch(iface_field_view[i])
    {
        case 'ssid':
            // if(_view[i].indexOf("ssid")>-1){
            var name = "cbid.wireless.wifix_ssid_<%=i%>.ssid";
    <%
            local ssid = luci.util.repSpec(tostring(uci:get("wireless","wifi0_ssid_"..i,"ssid") or ""))
            if uci:get('functionlist','functionlist','SUPPORT_WLAN24G') == '1' and uci:get("wireless","wifi0","opmode") == 'ap' then
                ssid = luci.util.repSpec(tostring(uci:get("wireless","wifi0_ssid_"..i,"ssid") or ""))
            elseif  uci:get('functionlist','functionlist','SUPPORT_WLAN5G') == '1' and uci:get("wireless","wifi1","opmode") == 'ap' then
                ssid = luci.util.repSpec(tostring(uci:get("wireless","wifi1_ssid_"..i,"ssid") or ""))
            elseif  uci:get('functionlist','functionlist','SUPPORT_WLAN5G_2') == '1' and uci:get("wireless","wifi2","opmode") == 'ap' then
                ssid = luci.util.repSpec(tostring(uci:get("wireless","wifi2_ssid_"..i,"ssid") or ""))
            end
    %>
            var ssid = repSpecHTML("<%=ssid%>",1);
            myTable.newElement("cbi-wireless-wifix_ssid_"+"<%=i%>"+"-"+iface_field_view[i]+"_view","<input type='text' value='"+ssid+"'  name='"+name+"'  maxlength='32' style='width: 200px;'>");
            break;
        case 'encrEdit':
                var btnName = "cbid.wireless.wifix_ssid_"+"<%=i%>"+".encrEdit";
                myTable.newElement("cbi-wireless-wifix_ssid_"+"<%=i%>"+"-"+iface_field_view[i]+"_view",'<input type="button" id="'+btnName +'"  name="'+btnName+'" value="<%:Edit%>" class="cbi-button" netId="wifix.network'+"<%=i%>"+'" >');
            break;

        case 'encryption':
            var encryption = '<%=uci:get("wireless","wifi0_ssid_"..i,"security") or uci:get("wireless","wifi0_ssid_"..i,"encryption")%>';
            <% if uci:get('functionlist','functionlist','SUPPORT_WLAN24G') == '1' and uci:get("wireless","wifi0","opmode") == 'ap' then %>
            encryption = '<%=uci:get("wireless","wifi0_ssid_"..i,"security") or uci:get("wireless","wifi0_ssid_"..i,"encryption")%>';
            <% elseif  uci:get('functionlist','functionlist','SUPPORT_WLAN5G') == '1' and uci:get("wireless","wifi1","opmode") == 'ap' then %>
            encryption = '<%=uci:get("wireless","wifi1_ssid_"..i,"security") or uci:get("wireless","wifi0_ssid_"..i,"encryption")%>';
            <% elseif  uci:get('functionlist','functionlist','SUPPORT_WLAN5G_2') == '1' and uci:get("wireless","wifi2","opmode") == 'ap' then %>
            encryption = '<%=uci:get("wireless","wifi2_ssid_"..i,"security") or uci:get("wireless","wifi0_ssid_"..i,"encryption")%>';
            <% end %>
            myTable.newElement("cbi-wireless-wifix_ssid_"+"<%=i%>"+"-"+iface_field_view[i]+"_view",encryption);
            break;
        case 'disabled':
            var name = "cbid.wireless.wifix_ssid_"+"<%=i%>"+".disabled";
            var is_check = ( false
                <% if uci:get('functionlist','functionlist','SUPPORT_WLAN24G') == '1' and uci:get("wireless","wifi0","opmode") == 'ap' then %>
                             || '<%=uci:get("wireless","wifi0_ssid_"..i,"disabled")%>'=="0"
                <% end %>
                <% if uci:get('functionlist','functionlist','SUPPORT_WLAN5G') == '1' and uci:get("wireless","wifi1","opmode") == 'ap' then %>
                             || '<%=uci:get("wireless","wifi1_ssid_"..i,"disabled")%>'=="0"
                <% end %>
                <% if uci:get('functionlist','functionlist','SUPPORT_WLAN5G_2') == '1' and uci:get("wireless","wifi2","opmode") == 'ap' then %>
                             || '<%=uci:get("wireless","wifi2_ssid_"..i,"disabled")%>'=="0"
                <% end %>
                            )
                            ?"checked":"";
            myTable.newElement("cbi-wireless-wifix_ssid_"+"<%=i%>"+"-"+iface_field_view[i]+"_view",'<input type="hidden" value="1" >');
            myTable.newElement("cbi-wireless-wifix_ssid_"+"<%=i%>"+"-"+iface_field_view[i]+"_view",'<input type="checkbox" value="0" '+is_check+'  name="'+name+'" >');
            break;
<% if uci:get('functionlist','functionlist','SUPPORT_GUEST_NETWORK_BY_SSID') == '1' then --[[ #### SUPPORT_GUEST_NETWORK_BY_SSID START ### --]] %>
        case 'guest_network':
            var gn_value = '<%=uci:get("wireless","wifi0_ssid_"..i,"guest_network")%>' || "Disable"; 
            var is_check = gn_value == "Disable" ? "":"checked";
            var name = "cbid.wireless.wifix_ssid_"+"<%=i%>"+".guest_network";
            myTable.newElement("cbi-wireless-wifix_ssid_"+"<%=i%>"+"-"+iface_field_view[i]+"_view",'<input type="hidden" value="0"  >');
            myTable.newElement("cbi-wireless-wifix_ssid_"+"<%=i%>"+"-"+iface_field_view[i]+"_view",'<input type="checkbox" value="1" '+is_check+'  name="'+name+'" >');
            $('input[type="checkbox"][name="'+ name+'"]').bind('click',gn_ip.checkEnable);
            break;
<% end --[[ #### SUPPORT_GUEST_NETWORK_BY_SSID END ### --]] %>
        case 'vlan_id':
            var name = "cbid.wireless.wifix_ssid_"+"<%=i%>"+".vlan_id";
            var name2 = "cbid.wireless.wifix_ssid_"+"<%=i%>"+".guest_network";
            var vlan_id = '<%=uci:get("wireless","wifi0_ssid_"..i,"vlan_id")%>';
            var vlan_isolation = '<%=uci:get("wireless","wifi0_ssid_"..i,"isolation")%>';
            if($('input[type="checkbox"][name="'+ name2+'"]').is(':checked') || vlan_isolation == 0)
            {
            	myTable.newElement("cbi-wireless-wifix_ssid_"+"<%=i%>"+"-"+iface_field_view[i]+"_view",'<div id="vlan_id"  value="'+vlan_id+'"  name="'+name+'"  maxlength="4" style="width: 60px;">-</div>');
            }
            else
            {
            	myTable.newElement("cbi-wireless-wifix_ssid_"+"<%=i%>"+"-"+iface_field_view[i]+"_view",'<div id="vlan_id"  value="'+vlan_id+'"  name="'+name+'"  maxlength="4" style="width: 60px;">'+vlan_id+'</div>');
            }
            break;
<% if WLAN24G == '1' then %>
        case '24g':
            var name = "wireless.wifi0_ssid_<%=i%>.disabled";
            var is_check = '<%=uci:get("wireless","wifi0_ssid_"..i,"disabled")%>'=="0"?"checked":"";
            var is_disabled = '';
            var opmode = '<%=uci:get("wireless","wifi0","opmode")%>';

            if ( opmode != "ap" && opmode != "wds_ap" )
            {
                is_check = "";
                is_disabled = 'disabled="disabled'+'"';
            }

            myTable.newElement("cbi-wireless-wifix_ssid_"+"<%=i%>"+"-"+iface_field_view[i]+"_view",'<input type="hidden" value="1" >');
            myTable.newElement("cbi-wireless-wifix_ssid_"+"<%=i%>"+"-"+iface_field_view[i]+"_view",'<input type="checkbox" value="0" '+is_disabled+' '+is_check+'  name="'+name+'" >');            
<% if WLAN5G ~= '1' then %>
            $("[id='wifix_ssid_"+<%=i%>+"_2']").css("display","none");
<% end %>
            break;
<% end %>
<% if WLAN5G == '1' then %>
        case '5g':
            var name = "wireless.wifi1_ssid_<%=i%>.disabled";
            var is_check = '<%=uci:get("wireless","wifi1_ssid_"..i,"disabled")%>'=="0"?"checked":"";
            var is_disabled = '';
            var opmode = '<%=uci:get("wireless","wifi1","opmode")%>';

            if ( opmode != "ap" && opmode != "wds_ap" )
            {
                is_check = "";
                is_disabled = 'disabled="disabled'+'"';
            }

            myTable.newElement("cbi-wireless-wifix_ssid_"+"<%=i%>"+"-"+iface_field_view[i]+"_view",'<input type="hidden" value="1" >');
            myTable.newElement("cbi-wireless-wifix_ssid_"+"<%=i%>"+"-"+iface_field_view[i]+"_view",'<input type="checkbox" value="0" '+is_check+'  name="'+name+'" >');
<% if WLAN24G ~= '1' then %>
            $("[id='wifix_ssid_"+<%=i%>+"_2']").css("display","none");
<% end %>
            break;
<% if WLAN5G_2 == '1' then %>
        case '5g2':
            var name = "wireless.wifi2_ssid_<%=i%>.disabled";
            var is_check = '<%=uci:get("wireless","wifi2_ssid_"..i,"disabled")%>'=="0"?"checked":"";
            var is_disabled = '';
            var opmode = '<%=uci:get("wireless","wifi2","opmode")%>';

            if ( opmode != "ap" && opmode != "wds_ap" )
            {
                is_check = "";
                is_disabled = 'disabled="disabled'+'"';
            }

            myTable.newElement("cbi-wireless-wifix_ssid_"+"<%=i%>"+"-"+iface_field_view[i]+"_view",'<input type="hidden" value="1" >');
            myTable.newElement("cbi-wireless-wifix_ssid_"+"<%=i%>"+"-"+iface_field_view[i]+"_view",'<input type="checkbox" value="0" '+is_check+'  name="'+name+'" >');
            break;
<% end %>
<% end %>
    }
}
bindFuncInterface(iface_bindfunc_array);
<% end %>

<% if uci:get('functionlist','functionlist','SUPPORT_ENJET') == '1' then --[[####SUPPORT_ENJET START #### --]] %>
<% for i=1, 1 do %>
var iface_bindfunc_array2={};
for( var i in iface_field_tdma_view )
{
    myTable.newTr([],"wifi1_tdma"+"_tbl","wifix_ssid_tdma_"+"<%=i%>");
    myTable.newTd([],"wifix_ssid_tdma_"+"<%=i%>","wifix_ssid_tdma_"+"<%=i%>"+"_"+i);
    myTable.newDiv("cbi-wireless-wifix_ssid_tdma_"+"<%=i%>"+"-"+iface_field_tdma_view[i]+"_view","wifix_ssid_tdma_"+"<%=i%>"+"_"+i);

    iface_bindfunc_array2["cbi-wireless-wifix_ssid_tdma_"+"<%=i%>"+"-"+iface_field_tdma_view[i]+"_view"] = "cbi-wireless-wifix_ssid_tdma_"+"<%=i%>"+"-"+iface_field_tdma_view[i];
    switch(iface_field_tdma_view[i])
    {
        case 'ssid':
            var name = "cbid.wireless.wifix_ssid_tdma_<%=i%>.ssid";
    <%
            local ssid = luci.util.repSpec(tostring(uci:get("wireless","wifi1_enjet","ssid") or ""))
    %>
            var ssid = repSpecHTML("<%=ssid%>",1);
            myTable.newElement("cbi-wireless-wifix_ssid_tdma_"+"<%=i%>"+"-"+iface_field_tdma_view[i]+"_view","<input type='text' value='"+ssid+"'  name='"+name+"'  maxlength='32' style='width: 200px;'>");
            break;
        case 'encrEdit':
                var btnName = "cbid.wireless.wifix_ssid_tdma_"+"<%=i%>"+".encrEdit";
                myTable.newElement("cbi-wireless-wifix_ssid_tdma_"+"<%=i%>"+"-"+iface_field_tdma_view[i]+"_view",'<input type="button" id="'+btnName +'"  name="'+btnName+'" value="<%:Edit%>" class="cbi-button" netId="'+"<%=networkName_enjet%>"+'" >');
            break;

        case 'encryption':
            var encryption = '<%=uci:get("wireless","wifi1_enjet","encryption")%>';
            encryption = '<%=uci:get("wireless","wifi1_enjet","encryption")%>';
            myTable.newElement("cbi-wireless-wifix_ssid_tdma_"+"<%=i%>"+"-"+iface_field_tdma_view[i]+"_view",encryption);
            break;
        case 'disabled':
            var name = "cbid.wireless.wifix_ssid_tdma_"+"<%=i%>"+".disabled";
            var is_check = ( false
                             || '<%=uci:get("wireless","wifi1_enjet","disabled")%>'=="0"
                            )
                            ?"checked":"";
            myTable.newElement("cbi-wireless-wifix_ssid_tdma_"+"<%=i%>"+"-"+iface_field_tdma_view[i]+"_view",'<input type="hidden" value="1" >');
            myTable.newElement("cbi-wireless-wifix_ssid_tdma_"+"<%=i%>"+"-"+iface_field_tdma_view[i]+"_view",'<input type="checkbox" value="0" '+is_check+'  name="'+name+'" >');
            break;
        case 'vlan_id':
            var name = "cbid.wireless.wifix_ssid_tdma_"+"<%=i%>"+".vlan_id";
            var name2 = "cbid.wireless.wifix_ssid_tdma_"+"<%=i%>"+".guest_network";
            var vlan_id = '<%=uci:get("wireless","wifi1_enjet","vlan_id")%>';
            var vlan_isolation = '<%=uci:get("wireless","wifi1_enjet","isolation")%>';
            if($('input[type="checkbox"][name="'+ name2+'"]').is(':checked') || vlan_isolation == 0)
            {
                myTable.newElement("cbi-wireless-wifix_ssid_tdma_"+"<%=i%>"+"-"+iface_field_tdma_view[i]+"_view",'<div id="vlan_id"  value="'+vlan_id+'"  name="'+name+'"  maxlength="4" style="width: 60px;">-</div>');
            }
            else
            {
                myTable.newElement("cbi-wireless-wifix_ssid_tdma_"+"<%=i%>"+"-"+iface_field_tdma_view[i]+"_view",'<div id="vlan_id"  value="'+vlan_id+'"  name="'+name+'"  maxlength="4" style="width: 60px;">'+vlan_id+'</div>');
            }
            break;

<% if WLAN5G == '1' then %>
        case '5g':
            var name = "wireless.wifi1_ssid_tdma<%=i%>.disabled";
            var is_check = '<%=uci:get("wireless","wifi1_enjet","disabled")%>'=="0"?"checked":"";
            var is_disabled = '';
            var opmode = '<%=uci:get("wireless","wifi1","opmode")%>';

            if ( opmode != "ap" && opmode != "wds_ap" )
            {
                is_check = "";
                is_disabled = 'disabled="disabled'+'"';
            }

            myTable.newElement("cbi-wireless-wifix_ssid_tdma_"+"<%=i%>"+"-"+iface_field_tdma_view[i]+"_view",'<input type="hidden" value="1" >');
            myTable.newElement("cbi-wireless-wifix_ssid_tdma_"+"<%=i%>"+"-"+iface_field_tdma_view[i]+"_view",'<input type="checkbox" value="0" '+is_check+'  name="'+name+'" >');
<% if WLAN24G ~= '1' then %>
            $("[id='wifix_ssid_tdma_"+<%=i%>+"_2']").css("display","none");
<% end %>
            break;
<% end %>
    }
}
bindFuncInterface(iface_bindfunc_array2);
<% end %>
<% end --[[####SUPPORT_ENJET END #### --]] %>

<% if uci:get('functionlist','functionlist','SUPPORT_MANAGEMENT_SSID') == '1' then %>
<% for i=1, 1 do %>
var iface_bindfunc_array3={};
for( var i in iface_field_mgmt_view )
{
    myTable.newTr([],"wifix_management"+"_tbl","wifix_ssid_management_"+"<%=i%>");
    myTable.newTd([],"wifix_ssid_management_"+"<%=i%>","wifix_ssid_management_"+"<%=i%>"+"_"+i);
    myTable.newDiv("cbi-wireless-wifix_ssid_management_"+"<%=i%>"+"-"+iface_field_mgmt_view[i]+"_view","wifix_ssid_management_"+"<%=i%>"+"_"+i);

    iface_bindfunc_array3["cbi-wireless-wifix_ssid_management_"+"<%=i%>"+"-"+iface_field_mgmt_view[i]+"_view"] = "cbi-wireless-wifix_ssid_management_"+"<%=i%>"+"-"+iface_field_mgmt_view[i];
    switch(iface_field_mgmt_view[i])
    {
        case 'ssid':
            // if(_view[i].indexOf("ssid")>-1){
            var name = "cbid.wireless.wifix_ssid_management_<%=i%>.ssid";
    <%
            local ssid = luci.util.repSpec(tostring(uci:get("wireless","wifi0_mgmt","ssid") or ""))
            if uci:get('functionlist','vendorlist','MANAGEMENT_SUPPORT_RADIO') == '1' then
                ssid = luci.util.repSpec(tostring(uci:get("wireless","wifi0_mgmt","ssid") or ""))
            elseif uci:get('functionlist','vendorlist','MANAGEMENT_SUPPORT_RADIO') == '2' then
                ssid = luci.util.repSpec(tostring(uci:get("wireless","wifi1_mgmt","ssid") or ""))
            end
    %>
            var ssid = repSpecHTML("<%=ssid%>",1);
            myTable.newElement("cbi-wireless-wifix_ssid_management_"+"<%=i%>"+"-"+iface_field_mgmt_view[i]+"_view",ssid);

            break;
        case 'encrEdit':
                var btnName = "cbid.wireless.wifix_ssid_management_"+"<%=i%>"+".encrEdit";
                myTable.newElement("cbi-wireless-wifix_ssid_management_"+"<%=i%>"+"-"+iface_field_mgmt_view[i]+"_view",'<input type="button" id="'+btnName +'"  name="'+btnName+'" value="<%:Edit%>" class="cbi-button" netId="'+"<%=networkName_mgmt%>"+'" >');
            break;

        case 'encryption':
            var encryption = '<%=uci:get("wireless","wifi0_mgmt","encryption")%>';
            <% if uci:get('functionlist','vendorlist','MANAGEMENT_SUPPORT_RADIO') == '1' then %>
                encryption = '<%=uci:get("wireless","wifi0_mgmt","encryption")%>';
            <% elseif uci:get('functionlist','vendorlist','MANAGEMENT_SUPPORT_RADIO') == '2' then %>
                encryption = '<%=uci:get("wireless","wifi1_mgmt","encryption")%>';
            <% end %>
            myTable.newElement("cbi-wireless-wifix_ssid_management_"+"<%=i%>"+"-"+iface_field_mgmt_view[i]+"_view",encryption);
            break;
        case 'disabled':
            var name = "cbid.wireless.wifix_ssid_management_"+"<%=i%>"+".disabled";
            var is_check = ( false
                <% if uci:get('functionlist','vendorlist','MANAGEMENT_SUPPORT_RADIO') == '1' then %>
                             || '<%=uci:get("wireless","wifi0_mgmt","disabled")%>'=="0"
                <% elseif uci:get('functionlist','vendorlist','MANAGEMENT_SUPPORT_RADIO') == '2' then %>
                             || '<%=uci:get("wireless","wifi1_mgmt","disabled")%>'=="0"
                <% end %>
                            )
                            ?"checked":"";
            myTable.newElement("cbi-wireless-wifix_ssid_management_"+"<%=i%>"+"-"+iface_field_mgmt_view[i]+"_view",'<input type="hidden" value="1" >');
            myTable.newElement("cbi-wireless-wifix_ssid_management_"+"<%=i%>"+"-"+iface_field_mgmt_view[i]+"_view",'<input type="checkbox" value="0" '+is_check+'  name="'+name+'" >');
            break;
<% if uci:get('functionlist','vendorlist','MANAGEMENT_SUPPORT_RADIO') == '1' then %>
        case '24g':
            var name = "wireless.wifi0_ssid_management<%=i%>.disabled";
            var is_check = '<%=uci:get("wireless","wifi0_mgmt","disabled")%>'=="0"?"checked":"";
            var is_disabled = '';
            var opmode = '<%=uci:get("wireless","wifi0","opmode")%>';

            if ( opmode != "ap" && opmode != "wds_ap" )
            {
                is_check = "";
                is_disabled = 'disabled="disabled'+'"';
            }

            myTable.newElement("cbi-wireless-wifix_ssid_management_"+"<%=i%>"+"-"+iface_field_mgmt_view[i]+"_view",'<input type="hidden" value="1" >');
            myTable.newElement("cbi-wireless-wifix_ssid_management_"+"<%=i%>"+"-"+iface_field_mgmt_view[i]+"_view",'<input type="checkbox" value="0" '+is_disabled+' '+is_check+'  name="'+name+'" >');
            $("[id='wifix_ssid_management_"+<%=i%>+"_2']").css("display","none");
            break;
<% end %>
<% if uci:get('functionlist','vendorlist','MANAGEMENT_SUPPORT_RADIO') == '2' then %>
        case '5g':
            var name = "wireless.wifi1_ssid_management<%=i%>.disabled";
            var is_check = '<%=uci:get("wireless","wifi1_mgmt","disabled")%>'=="0"?"checked":"";
            var is_disabled = '';
            var opmode = '<%=uci:get("wireless","wifi1","opmode")%>';

            if ( opmode != "ap" && opmode != "wds_ap" )
            {
                is_check = "";
                is_disabled = 'disabled="disabled'+'"';
            }

            myTable.newElement("cbi-wireless-wifix_ssid_management_"+"<%=i%>"+"-"+iface_field_mgmt_view[i]+"_view",'<input type="hidden" value="1" >');
            myTable.newElement("cbi-wireless-wifix_ssid_management_"+"<%=i%>"+"-"+iface_field_mgmt_view[i]+"_view",'<input type="checkbox" value="0" '+is_check+'  name="'+name+'" >');
            $("[id='wifix_ssid_management_"+<%=i%>+"_2']").css("display","none");
            break;
<% end %>
    }
}
bindFuncInterface(iface_bindfunc_array3);
<% end %>
<% end --[[####SUPPORT_MANAGEMENT_SSID END #### --]] %>

<% end %>
</script> 
<%       -- network list --
    if #nets > 0 then 
        for i, net in ipairs(nets) do 
               --luci.cbi.load("admin_network/wifi_iface1",net:id())[1]:render()
            local networkName = net:name()
            if filterRadio and string.find(networkName, filterRadio) then --[[ #### filter Radio ### --]]
            else
                if not string.find(networkName, "mesh") then
%>
<script type="text/javascript">
/*ex iface_name  = cfg033579*/
var iface_name =  '<%= networkName%>';
//ifaceTable['<%=dev:name()%>']['<%=opmode%>'].push(iface_name);
var  tmpTable={};
/*ex netId = wifi0.network1 */
var  netId = '<%= net:id()%>';
rtsTable['<%=dev:name()%>'].push(iface_name);
/*wds link infterface*/
if(!wds_net.hasOwnProperty(netId)&&!repeater_net.hasOwnProperty(netId)&&!iface_name.match("enjet")&&!iface_name.match("mgmt")
<% if uci:get('functionlist','functionlist','SUPPORT_GUEST_NETWORK_BY_SSID') == '1' then --[[ #### SUPPORT_GUEST_NETWORK_BY_SSID START ### --]] %>
&& (iface_name.indexOf("guest")<=-1)
<% end %>
    ){
    var _view = (iface_name.indexOf("guest")>-1)?gn_field_view:iface_field_wds_view;
    var _field = (iface_name.indexOf("guest")>-1)?gn_field:iface_field_wds;
    var dev_name = (iface_name.indexOf("guest")>-1)?"gn":"<%=dev:name()%>";
    myTable.newTr([],dev_name+"_tbl",iface_name);
    var iface =  "cbi-wireless-"+iface_name;

    /*for layout view*/
    for(var i in _view){
        var tmpView = iface+"-"+_view[i]+"_view";
        var tmpElement = iface+"-"+_view[i]
        var mode = '<%=uci:get("wireless",networkName,"mode")%>'
        myTable.newTd([],iface_name,iface_name+"_"+i);
        myTable.newDiv(tmpView,iface_name+"_"+i);

    switch(mode+"-"+_view[i]){
        case 'ap-ssid':
        case 'sta-ssid':
            // if(_view[i].indexOf("ssid")>-1){
            var name = "cbid.wireless."+iface_name+".ssid";
    <%
            local ssid = luci.util.repSpec(tostring(uci:get("wireless",networkName,"ssid") or ""))
    %>
            var ssid = repSpecHTML("<%=ssid%>",1);
<% if uci:get('functionlist','functionlist','SUPPORT_AP_RP_SETUP_WIZARD') == "1" or uci:get('functionlist','functionlist','SUPPORT_RP_SSID_SETTING') == "1"  then %>
            if (mode=="sta")
                myTable.newElement(tmpView,"<input type='text' value='"+ssid+"'  name='"+name+"'  maxlength='32' style='width: 200px;' disabled='true'>");
            else
<% end %>
            myTable.newElement(tmpView,"<input type='text' value='"+ssid+"'  name='"+name+"'  maxlength='32' style='width: 200px;'>");
            break;
        case 'ap-encrEdit':
        case 'sta-encrEdit':
            // if(_view[i].indexOf("encrEdit")>-1){
                var btnName = tmpElement.replace("cbi","cbid").replace(/-/g,".");
                myTable.newElement(tmpView,'<input type="button" id="'+btnName +'"  name="'+btnName+'" value="<%:Edit%>" class="cbi-button" netId="'+netId+'" >');
            // }
            break;

        case 'ap-encryption':
        case 'sta-encryption':
            // if(_view[i].indexOf("encryption")>-1){
                var encryption = '<%=uci:get("wireless",networkName,"security") or uci:get("wireless",networkName,"encryption")%>';
                myTable.newElement(tmpView,encryption);
            // }     
            break;

    // if(mode == "ap"){
        case 'ap-disabled':
        // if(_view[i].indexOf("disabled")>-1){
            var name = "cbid.wireless."+iface_name+".disabled";
            var is_check = '<%=uci:get("wireless",networkName,"disabled")%>'=="0"?"checked":"";
            myTable.newElement(tmpView,'<input type="hidden" value="1" >');
            myTable.newElement(tmpView,'<input type="checkbox" value="0" '+is_check+'  name="'+name+'" >');
         // }
            break;

<% if uci:get('functionlist','functionlist','SUPPORT_GUEST_NETWORK_BY_SSID') == '1' then --[[ #### SUPPORT_GUEST_NETWORK_BY_SSID START ### --]] %>
        case 'ap-guest_network':
        // if(_view[i].indexOf("l2_isolatior")>-1){
            var gn_value = '<%=uci:get("wireless",networkName,"guest_network")%>' || "Disable"; 
            var is_check = gn_value == "Disable" ? "":"checked";
            var name = "cbid.wireless."+iface_name+".guest_network";
            myTable.newElement(tmpView,'<input type="hidden" value="0"  >');
            myTable.newElement(tmpView,'<input type="checkbox" value="1" '+is_check+'  name="'+name+'" >');
            $('input[type="checkbox"][name="'+ name+'"]').bind('click',gn_ip.checkEnable);
         // }
            break;
<% end --[[ #### SUPPORT_GUEST_NETWORK_BY_SSID END ### --]] %>
        case 'ap-vlan_id':
         // if(_view[i].indexOf("vlan_id")>-1){
            var name = "cbid.wireless."+iface_name+".vlan_id";
            var vlan_id = '<%=uci:get("wireless",networkName,"vlan_id")%>';
            var vlanid_isolation = '<%=uci:get("wireless",networkName,"isolation")%>';

            //here1
            if(vlanid_isolation == 0)
            {
               myTable.newElement(tmpView,'<div id="vlan_id" value="'+vlan_id+'"  name="'+name+'"  maxlength="4" style="width: 60px;">-</div>');
            }
            else
            {
                myTable.newElement(tmpView,'<div id="vlan_id" value="'+vlan_id+'"  name="'+name+'"  maxlength="4" style="width: 60px;">'+vlan_id+'</div>');
            }
            //myTable.newElement(tmpView,'<input type="text" value="'+vlan_id+'"  name="'+name+'"  maxlength="4" style="width: 60px;"  >');
         // }
            break;
            // }
<% if COMBINED_SSID == '1' then %>
<% if WLAN24G == '1' then %>
        case 'ap-24g':
            var name = "wireless.wifi0_ssid_<%=i%>.disabled";
            var is_check = '<%=uci:get("wireless","wifi0_ssid_"..i,"disabled")%>'=="0"?"checked":"";
            var is_disabled = '';

            if ( $('select[name$="wifi0.opmode"]').val() != "ap" && $('select[name$="wifi0.opmode"]').val() != "wds_ap" )
            {
                is_check = "";
                is_disabled = 'disabled="disabled'+'"';
            }
            else if ( $('select[name$="wifi0.opmode"]').val() == "wds_ap" )
            {
                is_check = "";
                is_disabled = 'disabled="disabled'+'"';
            }

            myTable.newElement(tmpView,'<input type="hidden" value="1" >');
            myTable.newElement(tmpView,'<input type="checkbox" value="0" '+is_disabled+' '+is_check+'  name="'+name+'" >');            
            break;
<% end %>
<% if WLAN5G == '1' then %>
        case 'ap-5g':
            var name = "wireless.wifi1_ssid_<%=i%>.disabled";
            var is_check = '<%=uci:get("wireless","wifi1_ssid_"..i,"disabled")%>'=="0"?"checked":"";
            myTable.newElement(tmpView,'<input type="hidden" value="1" >');
            myTable.newElement(tmpView,'<input type="checkbox" value="0" '+is_check+'  name="'+name+'" >');
            break;
<% if WLAN5G_2 == '1' then %>
        case 'ap-5g2':
            var name = "wireless.wifi2_ssid_<%=i%>.disabled";
            var is_check = '<%=uci:get("wireless","wifi2_ssid_"..i,"disabled")%>'=="0"?"checked":"";
            myTable.newElement(tmpView,'<input type="hidden" value="1" >');
            myTable.newElement(tmpView,'<input type="checkbox" value="0" '+is_check+'  name="'+name+'" >');
            break;
<% end %>
<% end %>
<% end %>
        }
    }
    /*for disable function control*/ 
    for(var i in _field){
        var tmpView = iface+"-"+_field[i]+"_view";
        var tmpElement = iface+"-"+_field[i]
        // layoutTableIface[tmpView] = tmpElement;
        tmpTable[tmpView] = tmpElement;
    }
}
iface_rematch_table[netId] = tmpTable;

</script>
<%
                end
%>
<script type="text/javascript">
<% if i == #nets then%>
   opmode_set_interface({devName:'<%=dev:name()%>',opmode:"<%=uci:get("wireless",dev:name(),"opmode")%>"});
<%end%>
</script> 
<%
            end     --[[ #### filter Radio end ### --]]
        end
    end 
            -- /network list --
end 
%>

<div class="cbi-page-actions"><br>
    <input type="hidden" id="submitType" name="submitType"/>
<%if luci.model.uci.cursor():get('functionlist','functionlist','HAS_ALL_APPLY') == '1' then%>       
	<input class="cbi-button cbi-button-save" type="button" myid="button_save" onclick='ajax_setCsrf(); checkmesh();checkRule.check(1);' value="<%:Apply%>"/>&nbsp;<span class="btn_desc"><%:Apply saved settings to take effect %></span>
<%else%>
    <input id="save" class="cbi-button cbi-button-save" type="button" myid="button_save" onclick='ajax_setCsrf(); checkmesh();checkRule.check(0)' value="<%:Save%>"/>&nbsp;<span class="btn_desc"><%:Save current setting(s)%></span>
<%end%>    
	<script type="text/javascript">cbi_d_update();</script>
</div>
</div>

</form>
<%+footer%>
